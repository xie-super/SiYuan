{"ID":"20240201214053-aoves9d","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240201214053-aoves9d","title":"h-1cdn","updated":"20240201214053"},"Children":[{"ID":"20240201214054-mrekpm1","Type":"NodeThematicBreak","Properties":{"id":"20240201214054-mrekpm1","updated":"20240201214054"}},{"ID":"20240201214055-4qa2wg4","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201214055-4qa2wg4","updated":"20240201214055"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"8.2 CDN(内容分发网络)"}]},{"ID":"20240201214056-46db5ei","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201214056-46db5ei","updated":"20240201214056"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"什么是 CDN ？"}]},{"ID":"20240201214057-cuyib6y","Type":"NodeParagraph","Properties":{"id":"20240201214057-cuyib6y","updated":"20240201214057"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"CDN"},{"Type":"NodeText","Data":" 全称是 Content Delivery Network/Content Distribution Network，翻译过的意思是 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"内容分发网络"},{"Type":"NodeText","Data":" 。"}]},{"ID":"20240201214058-7tqftnl","Type":"NodeParagraph","Properties":{"id":"20240201214058-7tqftnl","updated":"20240201214058"},"Children":[{"Type":"NodeText","Data":"我们可以将内容分发网络拆开来看："}]},{"ID":"20240201214059-pik3mzw","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201214059-pik3mzw","updated":"20240201214059"},"Children":[{"ID":"20240201214060-4noufyn","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201214060-4noufyn","updated":"20240201214060"},"Children":[{"ID":"20240201214061-hh82zl1","Type":"NodeParagraph","Properties":{"id":"20240201214061-hh82zl1","updated":"20240201214061"},"Children":[{"Type":"NodeText","Data":"内容 ：指的是静态资源比如图片、视频、文档、JS、CSS、HTML。"}]}]},{"ID":"20240201214062-ajdfvix","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201214062-ajdfvix","updated":"20240201214062"},"Children":[{"ID":"20240201214063-rnyhbe0","Type":"NodeParagraph","Properties":{"id":"20240201214063-rnyhbe0","updated":"20240201214063"},"Children":[{"Type":"NodeText","Data":"分发网络 ：指的是将这些静态资源分发到位于多个不同的地理位置机房中的服务器上，这样，就可以实现静态资源的就近访问比如北京的用户直接访问北京机房的数据。"}]}]}]},{"ID":"20240201214064-juxg358","Type":"NodeParagraph","Properties":{"id":"20240201214064-juxg358","updated":"20240201214064"},"Children":[{"Type":"NodeText","Data":"所以，简单来说，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"CDN 就是将静态资源分发到多个不同的地方以实现就近访问，进而加快静态资源的访问速度，减轻服务器以及带宽的负担。"}]},{"ID":"20240201214065-csps0qr","Type":"NodeParagraph","Properties":{"id":"20240201214065-csps0qr","updated":"20240201214065"},"Children":[{"Type":"NodeText","Data":"类似于京东建立的庞大的仓储运输体系，京东物流在全国拥有非常多的仓库，仓储网络几乎覆盖全国所有区县。这样的话，用户下单的第一时间，商品就从距离用户最近的仓库，直接发往对应的配送站，再由京东小哥送到你家。"}]},{"ID":"20240201214066-uzofzb8","Type":"NodeParagraph","Properties":{"id":"20240201214066-uzofzb8","updated":"20240201214066"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"京东仓配系统","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/github/javaguide/high-performance/cdn/jingdong-wuliu-cangpei.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201214067-a7d4o6d","Type":"NodeParagraph","Properties":{"id":"20240201214067-a7d4o6d","updated":"20240201214067"},"Children":[{"Type":"NodeText","Data":"你可以将 CDN 看作是服务上一层的特殊缓存服务，分布在全国各地，主要用来处理静态资源的请求。"}]},{"ID":"20240201214068-ag4wtpi","Type":"NodeParagraph","Properties":{"id":"20240201214068-ag4wtpi","updated":"20240201214068"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"CDN 简易示意图","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/github/javaguide/high-performance/cdn/cdn-101.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201214069-i7l5zzn","Type":"NodeParagraph","Properties":{"id":"20240201214069-i7l5zzn","updated":"20240201214069"},"Children":[{"Type":"NodeText","Data":"我们经常拿全站加速和内容分发网络做对比，不要把两者搞混了！全站加速（不同云服务商叫法不同，腾讯云叫 ECDN、阿里云叫 DCDN）既可以加速静态资源又可以加速动态资源，内容分发网络（CDN）主要针对的是 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"静态资源"},{"Type":"NodeText","Data":" 。"}]},{"ID":"20240201214070-noqg9ko","Type":"NodeParagraph","Properties":{"id":"20240201214070-noqg9ko","updated":"20240201214070"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"阿里云文档：https://help.aliyun.com/document_detail/64836.html","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/github/javaguide/high-performance/cdn/cdn-aliyun-dcdn.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201214071-k0qqe88","Type":"NodeParagraph","Properties":{"id":"20240201214071-k0qqe88","updated":"20240201214071"},"Children":[{"Type":"NodeText","Data":"绝大部分公司都会在项目开发中交使用 CDN 服务，但很少会有自建 CDN 服务的公司。基于成本、稳定性和易用性考虑，建议直接选择专业的云厂商（比如阿里云、腾讯云、华为云、青云）或者 CDN 厂商（比如网宿、蓝汛）提供的开箱即用的 CDN 服务。"}]},{"ID":"20240201214072-zepaiiy","Type":"NodeParagraph","Properties":{"id":"20240201214072-zepaiiy","updated":"20240201214072"},"Children":[{"Type":"NodeText","Data":"很多朋友可能要问了："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"既然是就近访问，为什么不直接将服务部署在多个不同的地方呢？"}]},{"ID":"20240201214073-4hvz84j","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201214073-4hvz84j","updated":"20240201214073"},"Children":[{"ID":"20240201214074-p07obzr","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201214074-p07obzr","updated":"20240201214074"},"Children":[{"ID":"20240201214075-vqhixt2","Type":"NodeParagraph","Properties":{"id":"20240201214075-vqhixt2","updated":"20240201214075"},"Children":[{"Type":"NodeText","Data":"成本太高，需要部署多份相同的服务。"}]}]},{"ID":"20240201214076-2xj9rs7","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201214076-2xj9rs7","updated":"20240201214076"},"Children":[{"ID":"20240201214077-t9qt9h8","Type":"NodeParagraph","Properties":{"id":"20240201214077-t9qt9h8","updated":"20240201214077"},"Children":[{"Type":"NodeText","Data":"静态资源通常占用空间比较大且经常会被访问到，如果直接使用服务器或者缓存来处理静态资源请求的话，对系统资源消耗非常大，可能会影响到系统其他服务的正常运行。"}]}]}]},{"ID":"20240201214078-n81mjqd","Type":"NodeParagraph","Properties":{"id":"20240201214078-n81mjqd","updated":"20240201214078"},"Children":[{"Type":"NodeText","Data":"同一个服务在在多个不同的地方部署多份（比如同城灾备、异地灾备、同城多活、异地多活）是为了实现系统的高可用而不是就近访问。"}]},{"ID":"20240201214079-hd9a12e","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201214079-hd9a12e","updated":"20240201214079"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"CDN 工作原理是什么？"}]},{"ID":"20240201214080-448rcmt","Type":"NodeParagraph","Properties":{"id":"20240201214080-448rcmt","updated":"20240201214080"},"Children":[{"Type":"NodeText","Data":"搞懂下面 3 个问题也就搞懂了 CDN 的工作原理："}]},{"ID":"20240201214081-bcewmhw","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201214081-bcewmhw","updated":"20240201214081"},"Children":[{"ID":"20240201214082-od719pq","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201214082-od719pq","updated":"20240201214082"},"Children":[{"ID":"20240201214083-7yns4bd","Type":"NodeParagraph","Properties":{"id":"20240201214083-7yns4bd","updated":"20240201214083"},"Children":[{"Type":"NodeText","Data":"静态资源是如何被缓存到 CDN 节点中的？"}]}]},{"ID":"20240201214084-rm1fhbx","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20240201214084-rm1fhbx","updated":"20240201214084"},"Children":[{"ID":"20240201214085-b737w5f","Type":"NodeParagraph","Properties":{"id":"20240201214085-b737w5f","updated":"20240201214085"},"Children":[{"Type":"NodeText","Data":"如何找到最合适的 CDN 节点？"}]}]},{"ID":"20240201214086-bhw2qm1","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20240201214086-bhw2qm1","updated":"20240201214086"},"Children":[{"ID":"20240201214087-l60rrqe","Type":"NodeParagraph","Properties":{"id":"20240201214087-l60rrqe","updated":"20240201214087"},"Children":[{"Type":"NodeText","Data":"如何防止静态资源被盗用？"}]}]}]},{"ID":"20240201214088-rn0wmcd","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240201214088-rn0wmcd","updated":"20240201214088"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"静态资源是如何被缓存到 CDN 节点中的？"}]},{"ID":"20240201214089-le7xfvr","Type":"NodeParagraph","Properties":{"id":"20240201214089-le7xfvr","updated":"20240201214089"},"Children":[{"Type":"NodeText","Data":"你可以通过预热的方式将源站的资源同步到 CDN 的节点中。这样的话，用户首次请求资源可以直接从 CDN 节点中取，无需回源。这样可以降低源站压力，提升用户体验。"}]},{"ID":"20240201214090-1cf5e56","Type":"NodeParagraph","Properties":{"id":"20240201214090-1cf5e56","updated":"20240201214090"},"Children":[{"Type":"NodeText","Data":"如果不预热的话，你访问的资源可能不再 CDN 节点中，这个时候 CDN 节点将请求源站获取资源，这个过程是大家经常说的 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"回源"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240201214091-9s0qfqw","Type":"NodeParagraph","Properties":{"id":"20240201214091-9s0qfqw","updated":"20240201214091"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"命中率"},{"Type":"NodeText","Data":" 和 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"回源率"},{"Type":"NodeText","Data":" 是衡量 CDN 服务质量两个重要指标。命中率越高越好，回源率越低越好。"}]},{"ID":"20240201214092-ghkntwf","Type":"NodeParagraph","Properties":{"id":"20240201214092-ghkntwf","updated":"20240201214092"},"Children":[{"Type":"NodeText","Data":"如果资源有更新的话，你也可以对其 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"刷新"},{"Type":"NodeText","Data":" ，删除 CDN 节点上缓存的资源，当用户访问对应的资源时直接回源获取最新的资源，并重新缓存。"}]},{"ID":"20240201214093-l6r36a1","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240201214093-l6r36a1","updated":"20240201214093"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"如何找到最合适的 CDN 节点？"}]},{"ID":"20240201214094-6xhjyd8","Type":"NodeParagraph","Properties":{"id":"20240201214094-6xhjyd8","updated":"20240201214094"},"Children":[{"Type":"NodeText","Data":"GSLB （Global Server Load Balance，全局负载均衡）是 CDN 的大脑，负责多个 CDN 节点之间相互协作，最常用的是基于 DNS 的 GSLB。"}]},{"ID":"20240201214095-62dyxxs","Type":"NodeParagraph","Properties":{"id":"20240201214095-62dyxxs","updated":"20240201214095"},"Children":[{"Type":"NodeText","Data":"CDN 会通过 GSLB 找到最合适的 CDN 节点，更具体点来说是下面这样的："}]},{"ID":"20240201214096-jegeu2n","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201214096-jegeu2n","updated":"20240201214096"},"Children":[{"ID":"20240201214097-moc6716","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201214097-moc6716","updated":"20240201214097"},"Children":[{"ID":"20240201214098-vr989ei","Type":"NodeParagraph","Properties":{"id":"20240201214098-vr989ei","updated":"20240201214098"},"Children":[{"Type":"NodeText","Data":"浏览器向 DNS 服务器发送域名请求；"}]}]},{"ID":"20240201214099-uq8ln2i","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20240201214099-uq8ln2i","updated":"20240201214099"},"Children":[{"ID":"20240201214100-z55u116","Type":"NodeParagraph","Properties":{"id":"20240201214100-z55u116","updated":"20240201214100"},"Children":[{"Type":"NodeText","Data":"DNS 服务器向根据 CNAME( Canonical Name ) 别名记录向 GSLB 发送请求；"}]}]},{"ID":"20240201214101-iq0q2tz","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20240201214101-iq0q2tz","updated":"20240201214101"},"Children":[{"ID":"20240201214102-jeafqc4","Type":"NodeParagraph","Properties":{"id":"20240201214102-jeafqc4","updated":"20240201214102"},"Children":[{"Type":"NodeText","Data":"GSLB 返回性能最好（通常距离请求地址最近）的 CDN 节点（边缘服务器，真正缓存内容的地方）的地址给浏览器；"}]}]},{"ID":"20240201214103-j3nv7de","Type":"NodeListItem","Data":"4","ListData":{"Typ":1,"Tight":true,"Start":4,"Delimiter":46,"Padding":3,"Marker":"NA==","Num":4},"Properties":{"id":"20240201214103-j3nv7de","updated":"20240201214103"},"Children":[{"ID":"20240201214104-kq288ep","Type":"NodeParagraph","Properties":{"id":"20240201214104-kq288ep","updated":"20240201214104"},"Children":[{"Type":"NodeText","Data":"浏览器直接访问指定的 CDN 节点。"}]}]}]},{"ID":"20240201214105-qqdbgx8","Type":"NodeParagraph","Properties":{"id":"20240201214105-qqdbgx8","updated":"20240201214105"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"CDN 原理示意图","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/github/javaguide/high-performance/cdn/cdn-overview.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201214106-unggvez","Type":"NodeParagraph","Properties":{"id":"20240201214106-unggvez","updated":"20240201214106"},"Children":[{"Type":"NodeText","Data":"为了方便理解，上图其实做了一点简化。GSLB 内部可以看作是 CDN 专用 DNS 服务器和负载均衡系统组合。CDN 专用 DNS 服务器会返回负载均衡系统 IP 地址给浏览器，浏览器使用 IP 地址请求负载均衡系统进而找到对应的 CDN 节点。"}]},{"ID":"20240201214107-nttwh25","Type":"NodeParagraph","Properties":{"id":"20240201214107-nttwh25","updated":"20240201214107"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"GSLB 是如何选择出最合适的 CDN 节点呢？"},{"Type":"NodeText","Data":" GSLB 会根据请求的 IP 地址、CDN 节点状态（比如负载情况、性能、响应时间、带宽）等指标来综合判断具体返回哪一个 CDN 节点的地址。"}]},{"ID":"20240201214108-fwjpflr","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240201214108-fwjpflr","updated":"20240201214108"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"如何防止资源被盗刷？"}]},{"ID":"20240201214109-bq1y4hp","Type":"NodeParagraph","Properties":{"id":"20240201214109-bq1y4hp","updated":"20240201214109"},"Children":[{"Type":"NodeText","Data":"如果我们的资源被其他用户或者网站非法盗刷的话，将会是一笔不小的开支。"}]},{"ID":"20240201214110-a7vp8sn","Type":"NodeParagraph","Properties":{"id":"20240201214110-a7vp8sn","updated":"20240201214110"},"Children":[{"Type":"NodeText","Data":"解决这个问题最常用最简单的办法设置 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Referer 防盗链"},{"Type":"NodeText","Data":"，具体来说就是根据 HTTP 请求的头信息里面的 Referer 字段对请求进行限制。我们可以通过 Referer 字段获取到当前请求页面的来源页面的网站地址，这样我们就能确定请求是否来自合法的网站。"}]},{"ID":"20240201214111-mdfn9ag","Type":"NodeParagraph","Properties":{"id":"20240201214111-mdfn9ag","updated":"20240201214111"},"Children":[{"Type":"NodeText","Data":"CDN 服务提供商几乎都提供了这种比较基础的防盗链机制。"}]},{"ID":"20240201214112-kui9yo4","Type":"NodeParagraph","Properties":{"id":"20240201214112-kui9yo4","updated":"20240201214112"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"腾讯云 CDN Referer 防盗链配置","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/github/javaguide/high-performance/cdn/cnd-tencent-cloud-anti-theft.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201214113-aqxi658","Type":"NodeParagraph","Properties":{"id":"20240201214113-aqxi658","updated":"20240201214113"},"Children":[{"Type":"NodeText","Data":"不过，如果站点的防盗链配置允许 Referer 为空的话，通过隐藏 Referer，可以直接绕开防盗链。"}]},{"ID":"20240201214114-668ct8a","Type":"NodeParagraph","Properties":{"id":"20240201214114-668ct8a","updated":"20240201214114"},"Children":[{"Type":"NodeText","Data":"通常情况下，我们会配合其他机制来确保静态资源被盗用，一种常用的机制是 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"时间戳防盗链"},{"Type":"NodeText","Data":" 。相比之下，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"时间戳防盗链"},{"Type":"NodeText","Data":" 的安全性更强一些。时间戳防盗链加密的 URL 具有时效性，过期之后就无法再被允许访问。"}]},{"ID":"20240201214115-4pq5pes","Type":"NodeParagraph","Properties":{"id":"20240201214115-4pq5pes","updated":"20240201214115"},"Children":[{"Type":"NodeText","Data":"时间戳防盗链的 URL 通常会有两个参数一个是签名字符串，一个是过期时间。签名字符串一般是通过对用户设定的加密字符串、请求路径、过期时间通过 MD5 哈希算法取哈希的方式获得。"}]},{"ID":"20240201214116-ge9q0hu","Type":"NodeParagraph","Properties":{"id":"20240201214116-ge9q0hu","updated":"20240201214116"},"Children":[{"Type":"NodeText","Data":"时间戳防盗链 URL 示例："}]},{"ID":"20240201214117-stsj8g7","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20240201214117-stsj8g7","updated":"20240201214117"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"http://cdn.wangsu.com/4/123.mp3? wsSecret=79aead3bd7b5db4adeffb93a010298b5\u0026wsTime=1601026312\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20240201214118-sk7dxj5","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201214118-sk7dxj5","updated":"20240201214118"},"Children":[{"ID":"20240201214119-l4o8po7","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201214119-l4o8po7","updated":"20240201214119"},"Children":[{"ID":"20240201214120-ezgqf7r","Type":"NodeParagraph","Properties":{"id":"20240201214120-ezgqf7r","updated":"20240201214120"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"wsSecret"},{"Type":"NodeText","Data":" ：签名字符串。"}]}]},{"ID":"20240201214121-476bk9v","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201214121-476bk9v","updated":"20240201214121"},"Children":[{"ID":"20240201214122-pbqkcpw","Type":"NodeParagraph","Properties":{"id":"20240201214122-pbqkcpw","updated":"20240201214122"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"wsTime"},{"Type":"NodeText","Data":": 过期时间。"}]}]}]},{"ID":"20240201214123-iddpapw","Type":"NodeParagraph","Properties":{"id":"20240201214123-iddpapw","updated":"20240201214123"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/github/javaguide/high-performance/cdn/timestamp-anti-theft.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201214124-c4zvn7g","Type":"NodeParagraph","Properties":{"id":"20240201214124-c4zvn7g","updated":"20240201214124"},"Children":[{"Type":"NodeText","Data":"时间戳防盗链的实现也比较简单，并且可靠性较高，推荐使用。并且，绝大部分 CDN 服务提供商都提供了开箱即用的时间戳防盗链机制。"}]},{"ID":"20240201214125-td9zvhv","Type":"NodeParagraph","Properties":{"id":"20240201214125-td9zvhv","updated":"20240201214125"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"七牛云时间戳防盗链配置","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/github/javaguide/high-performance/cdn/qiniuyun-timestamp-anti-theft.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201214126-gu0u5sn","Type":"NodeParagraph","Properties":{"id":"20240201214126-gu0u5sn","updated":"20240201214126"},"Children":[{"Type":"NodeText","Data":"除了 Referer 防盗链和时间戳防盗链之外，你还可以 IP 黑白名单配置、IP 访问限频配置等机制来防盗刷。"}]},{"ID":"20240201214127-3nwlopy","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201214127-3nwlopy","updated":"20240201214127"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"总结"}]},{"ID":"20240201214128-n78p1m3","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201214128-n78p1m3","updated":"20240201214128"},"Children":[{"ID":"20240201214129-1nqzv2e","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201214129-1nqzv2e","updated":"20240201214129"},"Children":[{"ID":"20240201214130-61v43ci","Type":"NodeParagraph","Properties":{"id":"20240201214130-61v43ci","updated":"20240201214130"},"Children":[{"Type":"NodeText","Data":"CDN 就是将静态资源分发到多个不同的地方以实现就近访问，进而加快静态资源的访问速度，减轻服务器以及带宽的负担。"}]}]},{"ID":"20240201214131-eo5777a","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201214131-eo5777a","updated":"20240201214131"},"Children":[{"ID":"20240201214132-rtwz939","Type":"NodeParagraph","Properties":{"id":"20240201214132-rtwz939","updated":"20240201214132"},"Children":[{"Type":"NodeText","Data":"基于成本、稳定性和易用性考虑，建议直接选择专业的云厂商（比如阿里云、腾讯云、华为云、青云）或者 CDN 厂商（比如网宿、蓝汛）提供的开箱即用的 CDN 服务。"}]}]},{"ID":"20240201214133-35iujo8","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201214133-35iujo8","updated":"20240201214133"},"Children":[{"ID":"20240201214134-4i2f7gs","Type":"NodeParagraph","Properties":{"id":"20240201214134-4i2f7gs","updated":"20240201214134"},"Children":[{"Type":"NodeText","Data":"GSLB （Global Server Load Balance，全局负载均衡）是 CDN 的大脑，负责多个 CDN 节点之间相互协作，最常用的是基于 DNS 的 GSLB。CDN 会通过 GSLB 找到最合适的 CDN 节点。"}]}]},{"ID":"20240201214135-ixtzi0w","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201214135-ixtzi0w","updated":"20240201214135"},"Children":[{"ID":"20240201214136-bum4opb","Type":"NodeParagraph","Properties":{"id":"20240201214136-bum4opb","updated":"20240201214136"},"Children":[{"Type":"NodeText","Data":"为了防止静态资源被盗用，我们可以利用 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Referer 防盗链"},{"Type":"NodeText","Data":" + "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"时间戳防盗链"},{"Type":"NodeText","Data":" 。"}]}]}]},{"ID":"20240201214137-kw8o6d6","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201214137-kw8o6d6","updated":"20240201214137"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"参考"}]},{"ID":"20240201214138-ujog2lr","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201214138-ujog2lr","updated":"20240201214138"},"Children":[{"ID":"20240201214139-71ucr2l","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201214139-71ucr2l","updated":"20240201214139"},"Children":[{"ID":"20240201214140-4uz5mlx","Type":"NodeParagraph","Properties":{"id":"20240201214140-4uz5mlx","updated":"20240201214140"},"Children":[{"Type":"NodeText","Data":"时间戳防盗链 - 七牛云 CDN：https://developer.qiniu.com/fusion/kb/1670/timestamp-hotlinking-prevention"}]}]},{"ID":"20240201214141-o46sy7l","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201214141-o46sy7l","updated":"20240201214141"},"Children":[{"ID":"20240201214142-0vq1inb","Type":"NodeParagraph","Properties":{"id":"20240201214142-0vq1inb","updated":"20240201214142"},"Children":[{"Type":"NodeText","Data":"CDN 是个啥玩意？一文说个明白：https://mp.weixin.qq.com/s/Pp0C8ALUXsmYCUkM5QnkQw"}]}]},{"ID":"20240201214143-37dcwhp","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201214143-37dcwhp","updated":"20240201214143"},"Children":[{"ID":"20240201214144-vyf8lbs","Type":"NodeParagraph","Properties":{"id":"20240201214144-vyf8lbs","updated":"20240201214144"},"Children":[{"Type":"NodeText","Data":"《透视 HTTP 协议》- 37 | CDN：加速我们的网络服务：http://gk.link/a/11yOG"}]}]}]}]}