{"ID":"20240201213458-6og1x9x","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240201213458-6og1x9x","title":"mysql-logs","updated":"20240201213458"},"Children":[{"ID":"20240201213459-5y3rbz7","Type":"NodeThematicBreak","Properties":{"id":"20240201213459-5y3rbz7","updated":"20240201213459"}},{"ID":"20240201213460-eru3ju1","Type":"NodeParagraph","Properties":{"id":"20240201213460-eru3ju1","updated":"20240201213460"},"Children":[{"Type":"NodeText","Data":"title: MySQL三大日志(binlog、redo log和undo log)详解"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"category: 数据库"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"tag:"}]},{"ID":"20240201213461-xv79agd","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"MarkerOffset":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213461-xv79agd","updated":"20240201213461"},"Children":[{"ID":"20240201213462-gswdqr1","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"MarkerOffset":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213462-gswdqr1","updated":"20240201213462"},"Children":[{"ID":"20240201213463-ra8n6u0","Type":"NodeParagraph","Properties":{"id":"20240201213463-ra8n6u0","updated":"20240201213463"},"Children":[{"Type":"NodeText","Data":"MySQL"}]}]}]},{"ID":"20240201213464-ynbtzbt","Type":"NodeThematicBreak","Properties":{"id":"20240201213464-ynbtzbt","updated":"20240201213464"}},{"ID":"20240201213465-n544ut8","Type":"NodeBlockquote","Properties":{"id":"20240201213465-n544ut8","updated":"20240201213465"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240201213466-5nyur0q","Type":"NodeParagraph","Properties":{"id":"20240201213466-5nyur0q","updated":"20240201213466"},"Children":[{"Type":"NodeText","Data":"本文来自公号程序猿阿星投稿，JavaGuide 对其做了补充完善。"}]}]},{"ID":"20240201213467-n748zp5","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213467-n748zp5","updated":"20240201213467"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"前言"}]},{"ID":"20240201213468-xub72p8","Type":"NodeParagraph","Properties":{"id":"20240201213468-xub72p8","updated":"20240201213468"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"MySQL"},{"Type":"NodeText","Data":" 日志 主要包括错误日志、查询日志、慢查询日志、事务日志、二进制日志几大类。其中，比较重要的还要属二进制日志 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"（归档日志）和事务日志 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":"（重做日志）和 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"undo log"},{"Type":"NodeText","Data":"（回滚日志）。"}]},{"ID":"20240201213469-2obwaoe","Type":"NodeParagraph","Properties":{"id":"20240201213469-2obwaoe","updated":"20240201213469"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/01.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213470-t1cdv3u","Type":"NodeParagraph","Properties":{"id":"20240201213470-t1cdv3u","updated":"20240201213470"},"Children":[{"Type":"NodeText","Data":"今天就来聊聊 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":"（重做日志）、"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"（归档日志）、两阶段提交、"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"undo log"},{"Type":"NodeText","Data":" （回滚日志）。"}]},{"ID":"20240201213471-u4gwusj","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213471-u4gwusj","updated":"20240201213471"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"redo log"}]},{"ID":"20240201213472-6h59nor","Type":"NodeParagraph","Properties":{"id":"20240201213472-6h59nor","updated":"20240201213472"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":"（重做日志）是"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"InnoDB"},{"Type":"NodeText","Data":"存储引擎独有的，它让"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"MySQL"},{"Type":"NodeText","Data":"拥有了崩溃恢复能力。"}]},{"ID":"20240201213473-iogx2i3","Type":"NodeParagraph","Properties":{"id":"20240201213473-iogx2i3","updated":"20240201213473"},"Children":[{"Type":"NodeText","Data":"比如 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"MySQL"},{"Type":"NodeText","Data":" 实例挂了或宕机了，重启时，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"InnoDB"},{"Type":"NodeText","Data":"存储引擎会使用"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":"恢复数据，保证数据的持久性与完整性。"}]},{"ID":"20240201213474-ul2zd0g","Type":"NodeParagraph","Properties":{"id":"20240201213474-ul2zd0g","updated":"20240201213474"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/02.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213475-bn7x1yw","Type":"NodeParagraph","Properties":{"id":"20240201213475-bn7x1yw","updated":"20240201213475"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"MySQL"},{"Type":"NodeText","Data":" 中数据是以页为单位，你查询一条记录，会从硬盘把一页的数据加载出来，加载出来的数据叫数据页，会放入到 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"Buffer Pool"},{"Type":"NodeText","Data":" 中。"}]},{"ID":"20240201213476-rt4kd1m","Type":"NodeParagraph","Properties":{"id":"20240201213476-rt4kd1m","updated":"20240201213476"},"Children":[{"Type":"NodeText","Data":"后续的查询都是先从 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"Buffer Pool"},{"Type":"NodeText","Data":" 中找，没有命中再去硬盘加载，减少硬盘 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"IO"},{"Type":"NodeText","Data":" 开销，提升性能。"}]},{"ID":"20240201213477-kmd235m","Type":"NodeParagraph","Properties":{"id":"20240201213477-kmd235m","updated":"20240201213477"},"Children":[{"Type":"NodeText","Data":"更新表数据的时候，也是如此，发现 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"Buffer Pool"},{"Type":"NodeText","Data":" 里存在要更新的数据，就直接在 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"Buffer Pool"},{"Type":"NodeText","Data":" 里更新。"}]},{"ID":"20240201213478-gawuafq","Type":"NodeParagraph","Properties":{"id":"20240201213478-gawuafq","updated":"20240201213478"},"Children":[{"Type":"NodeText","Data":"然后会把“在某个数据页上做了什么修改”记录到重做日志缓存（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log buffer"},{"Type":"NodeText","Data":"）里，接着刷盘到 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":" 文件里。"}]},{"ID":"20240201213479-tcpb42v","Type":"NodeParagraph","Properties":{"id":"20240201213479-tcpb42v","updated":"20240201213479"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/03.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213480-srwtvph","Type":"NodeBlockquote","Properties":{"id":"20240201213480-srwtvph","updated":"20240201213480"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240201213481-tv8fog8","Type":"NodeParagraph","Properties":{"id":"20240201213481-tv8fog8","updated":"20240201213481"},"Children":[{"Type":"NodeText","Data":"图片笔误提示：第 4 步 “清空 redo log buffe 刷盘到 redo 日志中”这句话中的 buffe 应该是 buffer。"}]}]},{"ID":"20240201213482-38tzpcs","Type":"NodeParagraph","Properties":{"id":"20240201213482-38tzpcs","updated":"20240201213482"},"Children":[{"Type":"NodeText","Data":"理想情况，事务一提交就会进行刷盘操作，但实际上，刷盘的时机是根据策略来进行的。"}]},{"ID":"20240201213483-stj1i1y","Type":"NodeBlockquote","Properties":{"id":"20240201213483-stj1i1y","updated":"20240201213483"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240201213484-di05ia4","Type":"NodeParagraph","Properties":{"id":"20240201213484-di05ia4","updated":"20240201213484"},"Children":[{"Type":"NodeText","Data":"小贴士：每条 redo 记录由“表空间号+数据页号+偏移量+修改数据长度+具体修改的数据”组成"}]}]},{"ID":"20240201213485-7me28sh","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213485-7me28sh","updated":"20240201213485"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"刷盘时机"}]},{"ID":"20240201213486-yrr8znr","Type":"NodeParagraph","Properties":{"id":"20240201213486-yrr8znr","updated":"20240201213486"},"Children":[{"Type":"NodeText","Data":"InnoDB 刷新重做日志的时机有几种情况："}]},{"ID":"20240201213487-3h4vcov","Type":"NodeParagraph","Properties":{"id":"20240201213487-3h4vcov","updated":"20240201213487"},"Children":[{"Type":"NodeText","Data":"InnoDB 将 redo log 刷到磁盘上有几种情况："}]},{"ID":"20240201213488-8gk6xjc","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213488-8gk6xjc","updated":"20240201213488"},"Children":[{"ID":"20240201213489-1kj3k1a","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213489-1kj3k1a","updated":"20240201213489"},"Children":[{"ID":"20240201213490-fzouf5m","Type":"NodeParagraph","Properties":{"id":"20240201213490-fzouf5m","updated":"20240201213490"},"Children":[{"Type":"NodeText","Data":"事务提交：当事务提交时，log buffer 里的 redo log 会被刷新到磁盘（可以通过"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"innodb_flush_log_at_trx_commit"},{"Type":"NodeText","Data":"参数控制，后文会提到）。"}]}]},{"ID":"20240201213491-sekfaqe","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20240201213491-sekfaqe","updated":"20240201213491"},"Children":[{"ID":"20240201213492-t3orr17","Type":"NodeParagraph","Properties":{"id":"20240201213492-t3orr17","updated":"20240201213492"},"Children":[{"Type":"NodeText","Data":"log buffer 空间不足时：log buffer 中缓存的 redo log 已经占满了 log buffer 总容量的大约一半左右，就需要把这些日志刷新到磁盘上。"}]}]},{"ID":"20240201213493-dr6oqw2","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20240201213493-dr6oqw2","updated":"20240201213493"},"Children":[{"ID":"20240201213494-ekh8cln","Type":"NodeParagraph","Properties":{"id":"20240201213494-ekh8cln","updated":"20240201213494"},"Children":[{"Type":"NodeText","Data":"事务日志缓冲区满：InnoDB 使用一个事务日志缓冲区（transaction log buffer）来暂时存储事务的重做日志条目。当缓冲区满时，会触发日志的刷新，将日志写入磁盘。"}]}]},{"ID":"20240201213495-2y5x2ps","Type":"NodeListItem","Data":"4","ListData":{"Typ":1,"Tight":true,"Start":4,"Delimiter":46,"Padding":3,"Marker":"NA==","Num":4},"Properties":{"id":"20240201213495-2y5x2ps","updated":"20240201213495"},"Children":[{"ID":"20240201213496-0txys98","Type":"NodeParagraph","Properties":{"id":"20240201213496-0txys98","updated":"20240201213496"},"Children":[{"Type":"NodeText","Data":"Checkpoint（检查点）：InnoDB 定期会执行检查点操作，将内存中的脏数据（已修改但尚未写入磁盘的数据）刷新到磁盘，并且会将相应的重做日志一同刷新，以确保数据的一致性。"}]}]},{"ID":"20240201213497-wtanim2","Type":"NodeListItem","Data":"5","ListData":{"Typ":1,"Tight":true,"Start":5,"Delimiter":46,"Padding":3,"Marker":"NQ==","Num":5},"Properties":{"id":"20240201213497-wtanim2","updated":"20240201213497"},"Children":[{"ID":"20240201213498-yxt6o7e","Type":"NodeParagraph","Properties":{"id":"20240201213498-yxt6o7e","updated":"20240201213498"},"Children":[{"Type":"NodeText","Data":"后台刷新线程：InnoDB 启动了一个后台线程，负责周期性（每隔 1 秒）地将脏页（已修改但尚未写入磁盘的数据页）刷新到磁盘，并将相关的重做日志一同刷新。"}]}]},{"ID":"20240201213499-zlue498","Type":"NodeListItem","Data":"6","ListData":{"Typ":1,"Tight":true,"Start":6,"Delimiter":46,"Padding":3,"Marker":"Ng==","Num":6},"Properties":{"id":"20240201213499-zlue498","updated":"20240201213499"},"Children":[{"ID":"20240201213500-6cuzfww","Type":"NodeParagraph","Properties":{"id":"20240201213500-6cuzfww","updated":"20240201213500"},"Children":[{"Type":"NodeText","Data":"正常关闭服务器：MySQL 关闭的时候，redo log 都会刷入到磁盘里去。"}]}]}]},{"ID":"20240201213501-7xjs983","Type":"NodeParagraph","Properties":{"id":"20240201213501-7xjs983","updated":"20240201213501"},"Children":[{"Type":"NodeText","Data":"总之，InnoDB 在多种情况下会刷新重做日志，以保证数据的持久性和一致性。"}]},{"ID":"20240201213502-a69ixfn","Type":"NodeParagraph","Properties":{"id":"20240201213502-a69ixfn","updated":"20240201213502"},"Children":[{"Type":"NodeText","Data":"我们要注意设置正确的刷盘策略"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"innodb_flush_log_at_trx_commit"},{"Type":"NodeText","Data":" 。根据 MySQL 配置的刷盘策略的不同，MySQL 宕机之后可能会存在轻微的数据丢失问题。"}]},{"ID":"20240201213503-aaxpl9i","Type":"NodeParagraph","Properties":{"id":"20240201213503-aaxpl9i","updated":"20240201213503"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"innodb_flush_log_at_trx_commit"},{"Type":"NodeText","Data":" 的值有 3 种，也就是共有 3 种刷盘策略："}]},{"ID":"20240201213504-fody1y4","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213504-fody1y4","updated":"20240201213504"},"Children":[{"ID":"20240201213505-lrav9rd","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213505-lrav9rd","updated":"20240201213505"},"Children":[{"ID":"20240201213506-qmuqf3u","Type":"NodeParagraph","Properties":{"id":"20240201213506-qmuqf3u","updated":"20240201213506"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"0"},{"Type":"NodeText","Data":"：设置为 0 的时候，表示每次事务提交时不进行刷盘操作。这种方式性能最高，但是也最不安全，因为如果 MySQL 挂了或宕机了，可能会丢失最近 1 秒内的事务。"}]}]},{"ID":"20240201213507-ugvsyl5","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213507-ugvsyl5","updated":"20240201213507"},"Children":[{"ID":"20240201213508-13wo9s2","Type":"NodeParagraph","Properties":{"id":"20240201213508-13wo9s2","updated":"20240201213508"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"1"},{"Type":"NodeText","Data":"：设置为 1 的时候，表示每次事务提交时都将进行刷盘操作。这种方式性能最低，但是也最安全，因为只要事务提交成功，redo log 记录就一定在磁盘里，不会有任何数据丢失。"}]}]},{"ID":"20240201213509-023o8k5","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213509-023o8k5","updated":"20240201213509"},"Children":[{"ID":"20240201213510-p555a78","Type":"NodeParagraph","Properties":{"id":"20240201213510-p555a78","updated":"20240201213510"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"2"},{"Type":"NodeText","Data":"：设置为 2 的时候，表示每次事务提交时都只把 log buffer 里的 redo log 内容写入 page cache（文件系统缓存）。page cache 是专门用来缓存文件的，这里被缓存的文件就是 redo log 文件。这种方式的性能和安全性都介于前两者中间。"}]}]}]},{"ID":"20240201213511-b1dmape","Type":"NodeParagraph","Properties":{"id":"20240201213511-b1dmape","updated":"20240201213511"},"Children":[{"Type":"NodeText","Data":"刷盘策略"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"innodb_flush_log_at_trx_commit"},{"Type":"NodeText","Data":" 的默认值为 1，设置为 1 的时候才不会丢失任何数据。为了保证事务的持久性，我们必须将其设置为 1。"}]},{"ID":"20240201213512-5j1dw6s","Type":"NodeParagraph","Properties":{"id":"20240201213512-5j1dw6s","updated":"20240201213512"},"Children":[{"Type":"NodeText","Data":"另外，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"InnoDB"},{"Type":"NodeText","Data":" 存储引擎有一个后台线程，每隔"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"1"},{"Type":"NodeText","Data":" 秒，就会把 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log buffer"},{"Type":"NodeText","Data":" 中的内容写到文件系统缓存（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"page cache"},{"Type":"NodeText","Data":"），然后调用 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"fsync"},{"Type":"NodeText","Data":" 刷盘。"}]},{"ID":"20240201213513-ujzayi1","Type":"NodeParagraph","Properties":{"id":"20240201213513-ujzayi1","updated":"20240201213513"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/04.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213514-y218p82","Type":"NodeParagraph","Properties":{"id":"20240201213514-y218p82","updated":"20240201213514"},"Children":[{"Type":"NodeText","Data":"也就是说，一个没有提交事务的 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":" 记录，也可能会刷盘。"}]},{"ID":"20240201213515-j02gkml","Type":"NodeParagraph","Properties":{"id":"20240201213515-j02gkml","updated":"20240201213515"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"为什么呢？"}]},{"ID":"20240201213516-yjp9tk2","Type":"NodeParagraph","Properties":{"id":"20240201213516-yjp9tk2","updated":"20240201213516"},"Children":[{"Type":"NodeText","Data":"因为在事务执行过程 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":" 记录是会写入"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log buffer"},{"Type":"NodeText","Data":" 中，这些 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":" 记录会被后台线程刷盘。"}]},{"ID":"20240201213517-fs1gj8t","Type":"NodeParagraph","Properties":{"id":"20240201213517-fs1gj8t","updated":"20240201213517"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/05.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213518-l61bmob","Type":"NodeParagraph","Properties":{"id":"20240201213518-l61bmob","updated":"20240201213518"},"Children":[{"Type":"NodeText","Data":"除了后台线程每秒"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"1"},{"Type":"NodeText","Data":"次的轮询操作，还有一种情况，当 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log buffer"},{"Type":"NodeText","Data":" 占用的空间即将达到 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"innodb_log_buffer_size"},{"Type":"NodeText","Data":" 一半的时候，后台线程会主动刷盘。"}]},{"ID":"20240201213519-uwszty7","Type":"NodeParagraph","Properties":{"id":"20240201213519-uwszty7","updated":"20240201213519"},"Children":[{"Type":"NodeText","Data":"下面是不同刷盘策略的流程图。"}]},{"ID":"20240201213520-q1tqwmj","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240201213520-q1tqwmj","updated":"20240201213520"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"innodb_flush_log_at_trx_commit=0"}]},{"ID":"20240201213521-utexmfm","Type":"NodeParagraph","Properties":{"id":"20240201213521-utexmfm","updated":"20240201213521"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/06.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213522-c7fpy8f","Type":"NodeParagraph","Properties":{"id":"20240201213522-c7fpy8f","updated":"20240201213522"},"Children":[{"Type":"NodeText","Data":"为"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"0"},{"Type":"NodeText","Data":"时，如果"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"MySQL"},{"Type":"NodeText","Data":"挂了或宕机可能会有"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"1"},{"Type":"NodeText","Data":"秒数据的丢失。"}]},{"ID":"20240201213523-wfb91hi","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240201213523-wfb91hi","updated":"20240201213523"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"innodb_flush_log_at_trx_commit=1"}]},{"ID":"20240201213524-1ate8q7","Type":"NodeParagraph","Properties":{"id":"20240201213524-1ate8q7","updated":"20240201213524"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/07.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213525-ww6hhcq","Type":"NodeParagraph","Properties":{"id":"20240201213525-ww6hhcq","updated":"20240201213525"},"Children":[{"Type":"NodeText","Data":"为"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"1"},{"Type":"NodeText","Data":"时， 只要事务提交成功，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":"记录就一定在硬盘里，不会有任何数据丢失。"}]},{"ID":"20240201213526-w3koleo","Type":"NodeParagraph","Properties":{"id":"20240201213526-w3koleo","updated":"20240201213526"},"Children":[{"Type":"NodeText","Data":"如果事务执行期间"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"MySQL"},{"Type":"NodeText","Data":"挂了或宕机，这部分日志丢了，但是事务并没有提交，所以日志丢了也不会有损失。"}]},{"ID":"20240201213527-w368ui8","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240201213527-w368ui8","updated":"20240201213527"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"innodb_flush_log_at_trx_commit=2"}]},{"ID":"20240201213528-ib3zwmx","Type":"NodeParagraph","Properties":{"id":"20240201213528-ib3zwmx","updated":"20240201213528"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/09.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213529-apuudm5","Type":"NodeParagraph","Properties":{"id":"20240201213529-apuudm5","updated":"20240201213529"},"Children":[{"Type":"NodeText","Data":"为"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"2"},{"Type":"NodeText","Data":"时， 只要事务提交成功，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log buffer"},{"Type":"NodeText","Data":"中的内容只写入文件系统缓存（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"page cache"},{"Type":"NodeText","Data":"）。"}]},{"ID":"20240201213530-2eddjdw","Type":"NodeParagraph","Properties":{"id":"20240201213530-2eddjdw","updated":"20240201213530"},"Children":[{"Type":"NodeText","Data":"如果仅仅只是"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"MySQL"},{"Type":"NodeText","Data":"挂了不会有任何数据丢失，但是宕机可能会有"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"1"},{"Type":"NodeText","Data":"秒数据的丢失。"}]},{"ID":"20240201213531-p4v49pt","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213531-p4v49pt","updated":"20240201213531"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"日志文件组"}]},{"ID":"20240201213532-fmgt8pm","Type":"NodeParagraph","Properties":{"id":"20240201213532-fmgt8pm","updated":"20240201213532"},"Children":[{"Type":"NodeText","Data":"硬盘上存储的 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":" 日志文件不只一个，而是以一个"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"日志文件组"},{"Type":"NodeText","Data":"的形式出现的，每个的"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo"},{"Type":"NodeText","Data":"日志文件大小都是一样的。"}]},{"ID":"20240201213533-ti9165x","Type":"NodeParagraph","Properties":{"id":"20240201213533-ti9165x","updated":"20240201213533"},"Children":[{"Type":"NodeText","Data":"比如可以配置为一组"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"4"},{"Type":"NodeText","Data":"个文件，每个文件的大小是 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"1GB"},{"Type":"NodeText","Data":"，整个 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":" 日志文件组可以记录"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"4G"},{"Type":"NodeText","Data":"的内容。"}]},{"ID":"20240201213534-fip1nll","Type":"NodeParagraph","Properties":{"id":"20240201213534-fip1nll","updated":"20240201213534"},"Children":[{"Type":"NodeText","Data":"它采用的是环形数组形式，从头开始写，写到末尾又回到头循环写，如下图所示。"}]},{"ID":"20240201213535-efvqlc9","Type":"NodeParagraph","Properties":{"id":"20240201213535-efvqlc9","updated":"20240201213535"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/10.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213536-zt5wf81","Type":"NodeParagraph","Properties":{"id":"20240201213536-zt5wf81","updated":"20240201213536"},"Children":[{"Type":"NodeText","Data":"在个"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"日志文件组"},{"Type":"NodeText","Data":"中还有两个重要的属性，分别是 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"write pos、checkpoint"}]},{"ID":"20240201213537-jt0kha2","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213537-jt0kha2","updated":"20240201213537"},"Children":[{"ID":"20240201213538-imoy661","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213538-imoy661","updated":"20240201213538"},"Children":[{"ID":"20240201213539-desbags","Type":"NodeParagraph","Properties":{"id":"20240201213539-desbags","updated":"20240201213539"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"write pos"},{"Type":"NodeText","Data":" 是当前记录的位置，一边写一边后移"}]}]},{"ID":"20240201213540-afvp054","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213540-afvp054","updated":"20240201213540"},"Children":[{"ID":"20240201213541-0vf8zdj","Type":"NodeParagraph","Properties":{"id":"20240201213541-0vf8zdj","updated":"20240201213541"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"checkpoint"},{"Type":"NodeText","Data":" 是当前要擦除的位置，也是往后推移"}]}]}]},{"ID":"20240201213542-tpaipzp","Type":"NodeParagraph","Properties":{"id":"20240201213542-tpaipzp","updated":"20240201213542"},"Children":[{"Type":"NodeText","Data":"每次刷盘 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":" 记录到"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"日志文件组"},{"Type":"NodeText","Data":"中，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"write pos"},{"Type":"NodeText","Data":" 位置就会后移更新。"}]},{"ID":"20240201213543-f7o9ww2","Type":"NodeParagraph","Properties":{"id":"20240201213543-f7o9ww2","updated":"20240201213543"},"Children":[{"Type":"NodeText","Data":"每次 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"MySQL"},{"Type":"NodeText","Data":" 加载"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"日志文件组"},{"Type":"NodeText","Data":"恢复数据时，会清空加载过的 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":" 记录，并把 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"checkpoint"},{"Type":"NodeText","Data":" 后移更新。"}]},{"ID":"20240201213544-qyh6w47","Type":"NodeParagraph","Properties":{"id":"20240201213544-qyh6w47","updated":"20240201213544"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"write pos"},{"Type":"NodeText","Data":" 和 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"checkpoint"},{"Type":"NodeText","Data":" 之间的还空着的部分可以用来写入新的 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":" 记录。"}]},{"ID":"20240201213545-ceh5ify","Type":"NodeParagraph","Properties":{"id":"20240201213545-ceh5ify","updated":"20240201213545"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/11.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213546-nddic5m","Type":"NodeParagraph","Properties":{"id":"20240201213546-nddic5m","updated":"20240201213546"},"Children":[{"Type":"NodeText","Data":"如果 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"write pos"},{"Type":"NodeText","Data":" 追上 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"checkpoint"},{"Type":"NodeText","Data":" ，表示"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"日志文件组"},{"Type":"NodeText","Data":"满了，这时候不能再写入新的 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":" 记录，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"MySQL"},{"Type":"NodeText","Data":" 得停下来，清空一些记录，把 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"checkpoint"},{"Type":"NodeText","Data":" 推进一下。"}]},{"ID":"20240201213547-lcmogwo","Type":"NodeParagraph","Properties":{"id":"20240201213547-lcmogwo","updated":"20240201213547"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/12.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213548-e2jacrn","Type":"NodeParagraph","Properties":{"id":"20240201213548-e2jacrn","updated":"20240201213548"},"Children":[{"Type":"NodeText","Data":"注意从 MySQL 8.0.30 开始，日志文件组有了些许变化："}]},{"ID":"20240201213549-s82n15o","Type":"NodeBlockquote","Properties":{"id":"20240201213549-s82n15o","updated":"20240201213549"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240201213550-pea7hdr","Type":"NodeParagraph","Properties":{"id":"20240201213550-pea7hdr","updated":"20240201213550"},"Children":[{"Type":"NodeText","Data":"The innodb_redo_log_capacity variable supersedes the innodb_log_files_in_group and innodb_log_file_size variables, which are deprecated. When the innodb_redo_log_capacity setting is defined, the innodb_log_files_in_group and innodb_log_file_size settings are ignored; otherwise, these settings are used to compute the innodb_redo_log_capacity setting (innodb_log_files_in_group "},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"*","Properties":{"id":""}}]},{"Type":"NodeText","Data":" innodb_log_file_size = innodb_redo_log_capacity). If none of those variables are set, redo log capacity is set to the innodb_redo_log_capacity default value, which is 104857600 bytes (100MB). The maximum redo log capacity is 128GB."}]}]},{"ID":"20240201213551-63reg03","Type":"NodeBlockquote","Properties":{"id":"20240201213551-63reg03","updated":"20240201213551"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240201213552-4tjuwtv","Type":"NodeParagraph","Properties":{"id":"20240201213552-4tjuwtv","updated":"20240201213552"},"Children":[{"Type":"NodeText","Data":"Redo log files reside in the "},{"Type":"NodeTextMark","TextMarkType":"tag","TextMarkTextContent":"innodb_redo"},{"Type":"NodeText","Data":" directory in the data directory unless a different directory was specified by the innodb_log_group_home_dir variable. If innodb_log_group_home_dir was defined, the redo log files reside in the "},{"Type":"NodeTextMark","TextMarkType":"tag","TextMarkTextContent":"innodb_redo"},{"Type":"NodeText","Data":" directory in that directory. There are two types of redo log files, ordinary and spare. Ordinary redo log files are those being used. Spare redo log files are those waiting to be used. InnoDB tries to maintain 32 redo log files in total, with each file equal in size to 1/32 "},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"*","Properties":{"id":""}}]},{"Type":"NodeText","Data":" innodb_redo_log_capacity; however, file sizes may differ for a time after modifying the innodb_redo_log_capacity setting."}]}]},{"ID":"20240201213553-32iz610","Type":"NodeParagraph","Properties":{"id":"20240201213553-32iz610","updated":"20240201213553"},"Children":[{"Type":"NodeText","Data":"意思是在 MySQL 8.0.30 之前可以通过 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"innodb_log_files_in_group"},{"Type":"NodeText","Data":" 和 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"innodb_log_file_size"},{"Type":"NodeText","Data":" 配置日志文件组的文件数和文件大小，但在 MySQL 8.0.30 及之后的版本中，这两个变量已被废弃，即使被指定也是用来计算 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"innodb_redo_log_capacity"},{"Type":"NodeText","Data":" 的值。而日志文件组的文件数则固定为 32，文件大小则为 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"innodb_redo_log_capacity / 32"},{"Type":"NodeText","Data":" 。"}]},{"ID":"20240201213554-uercg9m","Type":"NodeParagraph","Properties":{"id":"20240201213554-uercg9m","updated":"20240201213554"},"Children":[{"Type":"NodeText","Data":"关于这一点变化，我们可以验证一下。"}]},{"ID":"20240201213555-fgxo7sh","Type":"NodeParagraph","Properties":{"id":"20240201213555-fgxo7sh","updated":"20240201213555"},"Children":[{"Type":"NodeText","Data":"首先创建一个配置文件，里面配置一下 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"innodb_log_files_in_group"},{"Type":"NodeText","Data":" 和 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"innodb_log_file_size"},{"Type":"NodeText","Data":" 的值："}]},{"ID":"20240201213556-heiv3s0","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"cHJvcGVydGllcw==","CodeBlockCloseFence":"YGBg","Properties":{"id":"20240201213556-heiv3s0","updated":"20240201213556"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHJvcGVydGllcw==","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[mysqld]\ninnodb_log_file_size = 10485760\ninnodb_log_files_in_group = 64\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20240201213557-4a3l6o5","Type":"NodeParagraph","Properties":{"id":"20240201213557-4a3l6o5","updated":"20240201213557"},"Children":[{"Type":"NodeText","Data":"docker 启动一个 MySQL 8.0.32 的容器："}]},{"ID":"20240201213558-hicxjuu","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"YmFzaA==","CodeBlockCloseFence":"YGBg","Properties":{"id":"20240201213558-hicxjuu","updated":"20240201213558"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA==","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"docker run -d -p 3312:3309 -e MYSQL_ROOT_PASSWORD=your-password -v /path/to/your/conf:/etc/mysql/conf.d --name\nMySQL830 mysql:8.0.32\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20240201213559-2h65dux","Type":"NodeParagraph","Properties":{"id":"20240201213559-2h65dux","updated":"20240201213559"},"Children":[{"Type":"NodeText","Data":"现在我们来看一下启动日志："}]},{"ID":"20240201213560-gxnlf0y","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"cGxhaW4=","CodeBlockCloseFence":"YGBg","Properties":{"id":"20240201213560-gxnlf0y","updated":"20240201213560"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cGxhaW4=","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"2023-08-03T02:05:11.720357Z 0 [Warning] [MY-013907] [InnoDB] Deprecated configuration parameters innodb_log_file_size and/or innodb_log_files_in_group have been used to compute innodb_redo_log_capacity=671088640. Please use innodb_redo_log_capacity instead.\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20240201213561-kwzw59t","Type":"NodeParagraph","Properties":{"id":"20240201213561-kwzw59t","updated":"20240201213561"},"Children":[{"Type":"NodeText","Data":"这里也表明了 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"innodb_log_files_in_group"},{"Type":"NodeText","Data":" 和 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"innodb_log_file_size"},{"Type":"NodeText","Data":" 这两个变量是用来计算 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"innodb_redo_log_capacity"},{"Type":"NodeText","Data":" ，且已经被废弃。"}]},{"ID":"20240201213562-92ixny1","Type":"NodeParagraph","Properties":{"id":"20240201213562-92ixny1","updated":"20240201213562"},"Children":[{"Type":"NodeText","Data":"我们再看下日志文件组的文件数是多少："}]},{"ID":"20240201213563-clc5lhz","Type":"NodeParagraph","Properties":{"id":"20240201213563-clc5lhz","updated":"20240201213563"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/redo-log-20240201213826-78e0g4w.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213564-040t9j7","Type":"NodeParagraph","Properties":{"id":"20240201213564-040t9j7","updated":"20240201213564"},"Children":[{"Type":"NodeText","Data":"可以看到刚好是 32 个，并且每个日志文件的大小是 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"671088640 / 32 = 20971520"}]},{"ID":"20240201213565-jnkahx7","Type":"NodeParagraph","Properties":{"id":"20240201213565-jnkahx7","updated":"20240201213565"},"Children":[{"Type":"NodeText","Data":"所以在使用 MySQL 8.0.30 及之后的版本时，推荐使用 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"innodb_redo_log_capacity"},{"Type":"NodeText","Data":" 变量配置日志文件组"}]},{"ID":"20240201213566-s51hfh6","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213566-s51hfh6","updated":"20240201213566"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"redo log 小结"}]},{"ID":"20240201213567-4b5uj6z","Type":"NodeParagraph","Properties":{"id":"20240201213567-4b5uj6z","updated":"20240201213567"},"Children":[{"Type":"NodeText","Data":"相信大家都知道 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":" 的作用和它的刷盘时机、存储形式。"}]},{"ID":"20240201213568-8b8hcfj","Type":"NodeParagraph","Properties":{"id":"20240201213568-8b8hcfj","updated":"20240201213568"},"Children":[{"Type":"NodeText","Data":"现在我们来思考一个问题："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"只要每次把修改后的数据页直接刷盘不就好了，还有 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong code","TextMarkTextContent":"redo log"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":" 什么事？"}]},{"ID":"20240201213569-m49fivg","Type":"NodeParagraph","Properties":{"id":"20240201213569-m49fivg","updated":"20240201213569"},"Children":[{"Type":"NodeText","Data":"它们不都是刷盘么？差别在哪里？"}]},{"ID":"20240201213570-ew4cx8i","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"amF2YQ==","CodeBlockCloseFence":"YGBg","Properties":{"id":"20240201213570-ew4cx8i","updated":"20240201213570"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ==","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"1 Byte = 8bit\n1 KB = 1024 Byte\n1 MB = 1024 KB\n1 GB = 1024 MB\n1 TB = 1024 GB\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20240201213571-6ho933f","Type":"NodeParagraph","Properties":{"id":"20240201213571-6ho933f","updated":"20240201213571"},"Children":[{"Type":"NodeText","Data":"实际上，数据页大小是"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"16KB"},{"Type":"NodeText","Data":"，刷盘比较耗时，可能就修改了数据页里的几 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"Byte"},{"Type":"NodeText","Data":" 数据，有必要把完整的数据页刷盘吗？"}]},{"ID":"20240201213572-xq7zdae","Type":"NodeParagraph","Properties":{"id":"20240201213572-xq7zdae","updated":"20240201213572"},"Children":[{"Type":"NodeText","Data":"而且数据页刷盘是随机写，因为一个数据页对应的位置可能在硬盘文件的随机位置，所以性能是很差。"}]},{"ID":"20240201213573-wgue5us","Type":"NodeParagraph","Properties":{"id":"20240201213573-wgue5us","updated":"20240201213573"},"Children":[{"Type":"NodeText","Data":"如果是写 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":"，一行记录可能就占几十 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"Byte"},{"Type":"NodeText","Data":"，只包含表空间号、数据页号、磁盘文件偏移"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"量、更新值，再加上是顺序写，所以刷盘速度很快。"}]},{"ID":"20240201213574-ohxkmbf","Type":"NodeParagraph","Properties":{"id":"20240201213574-ohxkmbf","updated":"20240201213574"},"Children":[{"Type":"NodeText","Data":"所以用 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":" 形式记录修改内容，性能会远远超过刷数据页的方式，这也让数据库的并发能力更强。"}]},{"ID":"20240201213575-a59lx0b","Type":"NodeBlockquote","Properties":{"id":"20240201213575-a59lx0b","updated":"20240201213575"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240201213576-t3rciwr","Type":"NodeParagraph","Properties":{"id":"20240201213576-t3rciwr","updated":"20240201213576"},"Children":[{"Type":"NodeText","Data":"其实内存的数据页在一定时机也会刷盘，我们把这称为页合并，讲 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"Buffer Pool"},{"Type":"NodeText","Data":"的时候会对这块细说"}]}]},{"ID":"20240201213577-wn9ai45","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213577-wn9ai45","updated":"20240201213577"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"binlog"}]},{"ID":"20240201213578-ojs8fg1","Type":"NodeParagraph","Properties":{"id":"20240201213578-ojs8fg1","updated":"20240201213578"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":" 它是物理日志，记录内容是“在某个数据页上做了什么修改”，属于 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"InnoDB"},{"Type":"NodeText","Data":" 存储引擎。"}]},{"ID":"20240201213579-pwcwe8m","Type":"NodeParagraph","Properties":{"id":"20240201213579-pwcwe8m","updated":"20240201213579"},"Children":[{"Type":"NodeText","Data":"而 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":" 是逻辑日志，记录内容是语句的原始逻辑，类似于“给 ID=2 这一行的 c 字段加 1”，属于"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"MySQL Server"},{"Type":"NodeText","Data":" 层。"}]},{"ID":"20240201213580-d9cb8y9","Type":"NodeParagraph","Properties":{"id":"20240201213580-d9cb8y9","updated":"20240201213580"},"Children":[{"Type":"NodeText","Data":"不管用什么存储引擎，只要发生了表数据更新，都会产生 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":" 日志。"}]},{"ID":"20240201213581-14s927u","Type":"NodeParagraph","Properties":{"id":"20240201213581-14s927u","updated":"20240201213581"},"Children":[{"Type":"NodeText","Data":"那 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":" 到底是用来干嘛的？"}]},{"ID":"20240201213582-qaw5e22","Type":"NodeParagraph","Properties":{"id":"20240201213582-qaw5e22","updated":"20240201213582"},"Children":[{"Type":"NodeText","Data":"可以说"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"MySQL"},{"Type":"NodeText","Data":"数据库的"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"数据备份、主备、主主、主从"},{"Type":"NodeText","Data":"都离不开"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"，需要依靠"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"来同步数据，保证数据一致性。"}]},{"ID":"20240201213583-um05b6r","Type":"NodeParagraph","Properties":{"id":"20240201213583-um05b6r","updated":"20240201213583"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/01-20220305234724956.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213584-d76xa4m","Type":"NodeParagraph","Properties":{"id":"20240201213584-d76xa4m","updated":"20240201213584"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"会记录所有涉及更新数据的逻辑操作，并且是顺序写。"}]},{"ID":"20240201213585-m98fgud","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213585-m98fgud","updated":"20240201213585"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"记录格式"}]},{"ID":"20240201213586-5hgoes7","Type":"NodeParagraph","Properties":{"id":"20240201213586-5hgoes7","updated":"20240201213586"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":" 日志有三种格式，可以通过"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog_format"},{"Type":"NodeText","Data":"参数指定。"}]},{"ID":"20240201213587-z75we4b","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213587-z75we4b","updated":"20240201213587"},"Children":[{"ID":"20240201213588-2711b5k","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213588-2711b5k","updated":"20240201213588"},"Children":[{"ID":"20240201213589-43dsuts","Type":"NodeParagraph","Properties":{"id":"20240201213589-43dsuts","updated":"20240201213589"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"statement"}]}]},{"ID":"20240201213590-ayit46i","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213590-ayit46i","updated":"20240201213590"},"Children":[{"ID":"20240201213591-8xrj7lt","Type":"NodeParagraph","Properties":{"id":"20240201213591-8xrj7lt","updated":"20240201213591"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"row"}]}]},{"ID":"20240201213592-4nixpys","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213592-4nixpys","updated":"20240201213592"},"Children":[{"ID":"20240201213593-uvd6gu8","Type":"NodeParagraph","Properties":{"id":"20240201213593-uvd6gu8","updated":"20240201213593"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"mixed"}]}]}]},{"ID":"20240201213594-hzmz2ja","Type":"NodeParagraph","Properties":{"id":"20240201213594-hzmz2ja","updated":"20240201213594"},"Children":[{"Type":"NodeText","Data":"指定"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"statement"},{"Type":"NodeText","Data":"，记录的内容是"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"SQL"},{"Type":"NodeText","Data":"语句原文，比如执行一条"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"update T set update_time=now() where id=1"},{"Type":"NodeText","Data":"，记录的内容如下。"}]},{"ID":"20240201213595-39xucyt","Type":"NodeParagraph","Properties":{"id":"20240201213595-39xucyt","updated":"20240201213595"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/02-20220305234738688.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213596-x42vhj1","Type":"NodeParagraph","Properties":{"id":"20240201213596-x42vhj1","updated":"20240201213596"},"Children":[{"Type":"NodeText","Data":"同步数据时，会执行记录的"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"SQL"},{"Type":"NodeText","Data":"语句，但是有个问题，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"update_time=now()"},{"Type":"NodeText","Data":"这里会获取当前系统时间，直接执行会导致与原库的数据不一致。"}]},{"ID":"20240201213597-cesvhcm","Type":"NodeParagraph","Properties":{"id":"20240201213597-cesvhcm","updated":"20240201213597"},"Children":[{"Type":"NodeText","Data":"为了解决这种问题，我们需要指定为"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"row"},{"Type":"NodeText","Data":"，记录的内容不再是简单的"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"SQL"},{"Type":"NodeText","Data":"语句了，还包含操作的具体数据，记录内容如下。"}]},{"ID":"20240201213598-5t70x57","Type":"NodeParagraph","Properties":{"id":"20240201213598-5t70x57","updated":"20240201213598"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/03-20220305234742460.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213599-80aye1n","Type":"NodeParagraph","Properties":{"id":"20240201213599-80aye1n","updated":"20240201213599"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"row"},{"Type":"NodeText","Data":"格式记录的内容看不到详细信息，要通过"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"mysqlbinlog"},{"Type":"NodeText","Data":"工具解析出来。"}]},{"ID":"20240201213600-pdn4cy1","Type":"NodeParagraph","Properties":{"id":"20240201213600-pdn4cy1","updated":"20240201213600"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"update_time=now()"},{"Type":"NodeText","Data":"变成了具体的时间"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"update_time=1627112756247"},{"Type":"NodeText","Data":"，条件后面的@1、@2、@3 都是该行数据第 1 个~3 个字段的原始值（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"假设这张表只有 3 个字段"},{"Type":"NodeText","Data":"）。"}]},{"ID":"20240201213601-00ycgn7","Type":"NodeParagraph","Properties":{"id":"20240201213601-00ycgn7","updated":"20240201213601"},"Children":[{"Type":"NodeText","Data":"这样就能保证同步数据的一致性，通常情况下都是指定为"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"row"},{"Type":"NodeText","Data":"，这样可以为数据库的恢复与同步带来更好的可靠性。"}]},{"ID":"20240201213602-47nyw59","Type":"NodeParagraph","Properties":{"id":"20240201213602-47nyw59","updated":"20240201213602"},"Children":[{"Type":"NodeText","Data":"但是这种格式，需要更大的容量来记录，比较占用空间，恢复与同步时会更消耗"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"IO"},{"Type":"NodeText","Data":"资源，影响执行速度。"}]},{"ID":"20240201213603-w4jk2oq","Type":"NodeParagraph","Properties":{"id":"20240201213603-w4jk2oq","updated":"20240201213603"},"Children":[{"Type":"NodeText","Data":"所以就有了一种折中的方案，指定为"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"mixed"},{"Type":"NodeText","Data":"，记录的内容是前两者的混合。"}]},{"ID":"20240201213604-rua8h93","Type":"NodeParagraph","Properties":{"id":"20240201213604-rua8h93","updated":"20240201213604"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"MySQL"},{"Type":"NodeText","Data":"会判断这条"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"SQL"},{"Type":"NodeText","Data":"语句是否可能引起数据不一致，如果是，就用"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"row"},{"Type":"NodeText","Data":"格式，否则就用"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"statement"},{"Type":"NodeText","Data":"格式。"}]},{"ID":"20240201213605-0mdvw2s","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213605-0mdvw2s","updated":"20240201213605"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"写入机制"}]},{"ID":"20240201213606-2gojh36","Type":"NodeParagraph","Properties":{"id":"20240201213606-2gojh36","updated":"20240201213606"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"的写入时机也非常简单，事务执行过程中，先把日志写到"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog cache"},{"Type":"NodeText","Data":"，事务提交的时候，再把"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog cache"},{"Type":"NodeText","Data":"写到"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"文件中。"}]},{"ID":"20240201213607-rsatlzj","Type":"NodeParagraph","Properties":{"id":"20240201213607-rsatlzj","updated":"20240201213607"},"Children":[{"Type":"NodeText","Data":"因为一个事务的"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"不能被拆开，无论这个事务多大，也要确保一次性写入，所以系统会给每个线程分配一个块内存作为"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog cache"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240201213608-q721vet","Type":"NodeParagraph","Properties":{"id":"20240201213608-q721vet","updated":"20240201213608"},"Children":[{"Type":"NodeText","Data":"我们可以通过"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog_cache_size"},{"Type":"NodeText","Data":"参数控制单个线程 binlog cache 大小，如果存储内容超过了这个参数，就要暂存到磁盘（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"Swap"},{"Type":"NodeText","Data":"）。"}]},{"ID":"20240201213609-0r8aivn","Type":"NodeParagraph","Properties":{"id":"20240201213609-0r8aivn","updated":"20240201213609"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"日志刷盘流程如下"}]},{"ID":"20240201213610-nhggraw","Type":"NodeParagraph","Properties":{"id":"20240201213610-nhggraw","updated":"20240201213610"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/04-20220305234747840.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213611-xv6grch","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213611-xv6grch","updated":"20240201213611"},"Children":[{"ID":"20240201213612-s4hx2hm","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213612-s4hx2hm","updated":"20240201213612"},"Children":[{"ID":"20240201213613-ebpphep","Type":"NodeParagraph","Properties":{"id":"20240201213613-ebpphep","updated":"20240201213613"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"上图的 write，是指把日志写入到文件系统的 page cache，并没有把数据持久化到磁盘，所以速度比较快"}]}]},{"ID":"20240201213614-m4tac8s","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213614-m4tac8s","updated":"20240201213614"},"Children":[{"ID":"20240201213615-28t4lwn","Type":"NodeParagraph","Properties":{"id":"20240201213615-28t4lwn","updated":"20240201213615"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"上图的 fsync，才是将数据持久化到磁盘的操作"}]}]}]},{"ID":"20240201213616-w8dmuxp","Type":"NodeParagraph","Properties":{"id":"20240201213616-w8dmuxp","updated":"20240201213616"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"write"},{"Type":"NodeText","Data":"和"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"fsync"},{"Type":"NodeText","Data":"的时机，可以由参数"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"sync_binlog"},{"Type":"NodeText","Data":"控制，默认是"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"1"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240201213617-83ic2bb","Type":"NodeParagraph","Properties":{"id":"20240201213617-83ic2bb","updated":"20240201213617"},"Children":[{"Type":"NodeText","Data":"为"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"0"},{"Type":"NodeText","Data":"的时候，表示每次提交事务都只"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"write"},{"Type":"NodeText","Data":"，由系统自行判断什么时候执行"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"fsync"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240201213618-a6ssyte","Type":"NodeParagraph","Properties":{"id":"20240201213618-a6ssyte","updated":"20240201213618"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/05-20220305234754405.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213619-k9b71hh","Type":"NodeParagraph","Properties":{"id":"20240201213619-k9b71hh","updated":"20240201213619"},"Children":[{"Type":"NodeText","Data":"虽然性能得到提升，但是机器宕机，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"page cache"},{"Type":"NodeText","Data":"里面的 binlog 会丢失。"}]},{"ID":"20240201213620-gvp56ci","Type":"NodeParagraph","Properties":{"id":"20240201213620-gvp56ci","updated":"20240201213620"},"Children":[{"Type":"NodeText","Data":"为了安全起见，可以设置为"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"1"},{"Type":"NodeText","Data":"，表示每次提交事务都会执行"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"fsync"},{"Type":"NodeText","Data":"，就如同 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"redo log 日志刷盘流程"},{"Type":"NodeText","Data":" 一样。"}]},{"ID":"20240201213621-l29gqnn","Type":"NodeParagraph","Properties":{"id":"20240201213621-l29gqnn","updated":"20240201213621"},"Children":[{"Type":"NodeText","Data":"最后还有一种折中方式，可以设置为"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"N(N\u0026gt;1)"},{"Type":"NodeText","Data":"，表示每次提交事务都"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"write"},{"Type":"NodeText","Data":"，但累积"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"N"},{"Type":"NodeText","Data":"个事务后才"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"fsync"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240201213622-f3r8qbq","Type":"NodeParagraph","Properties":{"id":"20240201213622-f3r8qbq","updated":"20240201213622"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/06-20220305234801592.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213623-pasw2el","Type":"NodeParagraph","Properties":{"id":"20240201213623-pasw2el","updated":"20240201213623"},"Children":[{"Type":"NodeText","Data":"在出现"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"IO"},{"Type":"NodeText","Data":"瓶颈的场景里，将"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"sync_binlog"},{"Type":"NodeText","Data":"设置成一个比较大的值，可以提升性能。"}]},{"ID":"20240201213624-tkfw836","Type":"NodeParagraph","Properties":{"id":"20240201213624-tkfw836","updated":"20240201213624"},"Children":[{"Type":"NodeText","Data":"同样的，如果机器宕机，会丢失最近"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"N"},{"Type":"NodeText","Data":"个事务的"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"日志。"}]},{"ID":"20240201213625-0lc1lcb","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213625-0lc1lcb","updated":"20240201213625"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"两阶段提交"}]},{"ID":"20240201213626-hpm3c5w","Type":"NodeParagraph","Properties":{"id":"20240201213626-hpm3c5w","updated":"20240201213626"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":"（重做日志）让"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"InnoDB"},{"Type":"NodeText","Data":"存储引擎拥有了崩溃恢复能力。"}]},{"ID":"20240201213627-n28wlc6","Type":"NodeParagraph","Properties":{"id":"20240201213627-n28wlc6","updated":"20240201213627"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"（归档日志）保证了"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"MySQL"},{"Type":"NodeText","Data":"集群架构的数据一致性。"}]},{"ID":"20240201213628-9ijwjdn","Type":"NodeParagraph","Properties":{"id":"20240201213628-9ijwjdn","updated":"20240201213628"},"Children":[{"Type":"NodeText","Data":"虽然它们都属于持久化的保证，但是侧重点不同。"}]},{"ID":"20240201213629-a6xj0rv","Type":"NodeParagraph","Properties":{"id":"20240201213629-a6xj0rv","updated":"20240201213629"},"Children":[{"Type":"NodeText","Data":"在执行更新语句过程，会记录"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":"与"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"两块日志，以基本的事务为单位，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":"在事务执行过程中可以不断写入，而"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"只有在提交事务时才写入，所以"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":"与"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"的写入时机不一样。"}]},{"ID":"20240201213630-2xdlz1h","Type":"NodeParagraph","Properties":{"id":"20240201213630-2xdlz1h","updated":"20240201213630"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/01-20220305234816065.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213631-bkl721x","Type":"NodeParagraph","Properties":{"id":"20240201213631-bkl721x","updated":"20240201213631"},"Children":[{"Type":"NodeText","Data":"回到正题，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":"与"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"两份日志之间的逻辑不一致，会出现什么问题？"}]},{"ID":"20240201213632-2qlr5oc","Type":"NodeParagraph","Properties":{"id":"20240201213632-2qlr5oc","updated":"20240201213632"},"Children":[{"Type":"NodeText","Data":"我们以"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"update"},{"Type":"NodeText","Data":"语句为例，假设"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"id=2"},{"Type":"NodeText","Data":"的记录，字段"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"c"},{"Type":"NodeText","Data":"值是"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"0"},{"Type":"NodeText","Data":"，把字段"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"c"},{"Type":"NodeText","Data":"值更新成"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"1"},{"Type":"NodeText","Data":"，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"SQL"},{"Type":"NodeText","Data":"语句为"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"update T set c=1 where id=2"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240201213633-0n4vuvt","Type":"NodeParagraph","Properties":{"id":"20240201213633-0n4vuvt","updated":"20240201213633"},"Children":[{"Type":"NodeText","Data":"假设执行过程中写完"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":"日志后，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"日志写期间发生了异常，会出现什么情况呢？"}]},{"ID":"20240201213634-vn4g632","Type":"NodeParagraph","Properties":{"id":"20240201213634-vn4g632","updated":"20240201213634"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/02-20220305234828662.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213635-n5ktv2f","Type":"NodeParagraph","Properties":{"id":"20240201213635-n5ktv2f","updated":"20240201213635"},"Children":[{"Type":"NodeText","Data":"由于"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"没写完就异常，这时候"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"里面没有对应的修改记录。因此，之后用"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"日志恢复数据时，就会少这一次更新，恢复出来的这一行"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"c"},{"Type":"NodeText","Data":"值是"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"0"},{"Type":"NodeText","Data":"，而原库因为"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":"日志恢复，这一行"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"c"},{"Type":"NodeText","Data":"值是"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"1"},{"Type":"NodeText","Data":"，最终数据不一致。"}]},{"ID":"20240201213636-4707w77","Type":"NodeParagraph","Properties":{"id":"20240201213636-4707w77","updated":"20240201213636"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/03-20220305235104445.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213637-l6ukf2g","Type":"NodeParagraph","Properties":{"id":"20240201213637-l6ukf2g","updated":"20240201213637"},"Children":[{"Type":"NodeText","Data":"为了解决两份日志之间的逻辑一致问题，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"InnoDB"},{"Type":"NodeText","Data":"存储引擎使用"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"两阶段提交"},{"Type":"NodeText","Data":"方案。"}]},{"ID":"20240201213638-54wonwm","Type":"NodeParagraph","Properties":{"id":"20240201213638-54wonwm","updated":"20240201213638"},"Children":[{"Type":"NodeText","Data":"原理很简单，将"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":"的写入拆成了两个步骤"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"prepare"},{"Type":"NodeText","Data":"和"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"commit"},{"Type":"NodeText","Data":"，这就是"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"两阶段提交"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240201213639-zyq3drt","Type":"NodeParagraph","Properties":{"id":"20240201213639-zyq3drt","updated":"20240201213639"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/04-20220305234956774.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213640-96ujmnc","Type":"NodeParagraph","Properties":{"id":"20240201213640-96ujmnc","updated":"20240201213640"},"Children":[{"Type":"NodeText","Data":"使用"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"两阶段提交"},{"Type":"NodeText","Data":"后，写入"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"时发生异常也不会有影响，因为"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"MySQL"},{"Type":"NodeText","Data":"根据"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":"日志恢复数据时，发现"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":"还处于"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"prepare"},{"Type":"NodeText","Data":"阶段，并且没有对应"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"日志，就会回滚该事务。"}]},{"ID":"20240201213641-2atyprv","Type":"NodeParagraph","Properties":{"id":"20240201213641-2atyprv","updated":"20240201213641"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/05-20220305234937243.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213642-jyg2avb","Type":"NodeParagraph","Properties":{"id":"20240201213642-jyg2avb","updated":"20240201213642"},"Children":[{"Type":"NodeText","Data":"再看一个场景，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":"设置"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"commit"},{"Type":"NodeText","Data":"阶段发生异常，那会不会回滚事务呢？"}]},{"ID":"20240201213643-zvk684k","Type":"NodeParagraph","Properties":{"id":"20240201213643-zvk684k","updated":"20240201213643"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/06-20220305234907651.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213644-uyq98p1","Type":"NodeParagraph","Properties":{"id":"20240201213644-uyq98p1","updated":"20240201213644"},"Children":[{"Type":"NodeText","Data":"并不会回滚事务，它会执行上图框住的逻辑，虽然"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"redo log"},{"Type":"NodeText","Data":"是处于"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"prepare"},{"Type":"NodeText","Data":"阶段，但是能通过事务"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"id"},{"Type":"NodeText","Data":"找到对应的"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"日志，所以"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"MySQL"},{"Type":"NodeText","Data":"认为是完整的，就会提交事务恢复数据。"}]},{"ID":"20240201213645-44ek2ve","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213645-44ek2ve","updated":"20240201213645"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"undo log"}]},{"ID":"20240201213646-4nuep67","Type":"NodeBlockquote","Properties":{"id":"20240201213646-4nuep67","updated":"20240201213646"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240201213647-kznr05w","Type":"NodeParagraph","Properties":{"id":"20240201213647-kznr05w","updated":"20240201213647"},"Children":[{"Type":"NodeText","Data":"这部分内容为 JavaGuide 的补充："}]}]},{"ID":"20240201213648-qd3ahaf","Type":"NodeParagraph","Properties":{"id":"20240201213648-qd3ahaf","updated":"20240201213648"},"Children":[{"Type":"NodeText","Data":"我们知道如果想要保证事务的原子性，就需要在异常发生时，对已经执行的操作进行"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"回滚"},{"Type":"NodeText","Data":"，在 MySQL 中，恢复机制是通过 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"回滚日志（undo log）"},{"Type":"NodeText","Data":" 实现的，所有事务进行的修改都会先记录到这个回滚日志中，然后再执行相关的操作。如果执行过程中遇到异常的话，我们直接利用 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"回滚日志"},{"Type":"NodeText","Data":" 中的信息将数据回滚到修改之前的样子即可！并且，回滚日志会先于数据持久化到磁盘上。这样就保证了即使遇到数据库突然宕机等情况，当用户再次启动数据库的时候，数据库还能够通过查询回滚日志来回滚将之前未完成的事务。"}]},{"ID":"20240201213649-wkaljd7","Type":"NodeParagraph","Properties":{"id":"20240201213649-wkaljd7","updated":"20240201213649"},"Children":[{"Type":"NodeText","Data":"另外，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"MVCC"},{"Type":"NodeText","Data":" 的实现依赖于："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"隐藏字段、Read View、undo log"},{"Type":"NodeText","Data":"。在内部实现中，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"InnoDB"},{"Type":"NodeText","Data":" 通过数据行的 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"DB_TRX_ID"},{"Type":"NodeText","Data":" 和 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"Read View"},{"Type":"NodeText","Data":" 来判断数据的可见性，如不可见，则通过数据行的 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"DB_ROLL_PTR"},{"Type":"NodeText","Data":" 找到 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"undo log"},{"Type":"NodeText","Data":" 中的历史版本。每个事务读到的数据版本可能是不一样的，在同一个事务中，用户只能看到该事务创建 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"Read View"},{"Type":"NodeText","Data":" 之前已经提交的修改和该事务本身做的修改"}]},{"ID":"20240201213650-z7hog3b","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213650-z7hog3b","updated":"20240201213650"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"总结"}]},{"ID":"20240201213651-j4h6zrg","Type":"NodeBlockquote","Properties":{"id":"20240201213651-j4h6zrg","updated":"20240201213651"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240201213652-5rwduck","Type":"NodeParagraph","Properties":{"id":"20240201213652-5rwduck","updated":"20240201213652"},"Children":[{"Type":"NodeText","Data":"这部分内容为 JavaGuide 的补充："}]}]},{"ID":"20240201213653-ereh8ju","Type":"NodeParagraph","Properties":{"id":"20240201213653-ereh8ju","updated":"20240201213653"},"Children":[{"Type":"NodeText","Data":"MySQL InnoDB 引擎使用 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"redo log(重做日志)"},{"Type":"NodeText","Data":" 保证事务的"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"持久性"},{"Type":"NodeText","Data":"，使用 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"undo log(回滚日志)"},{"Type":"NodeText","Data":" 来保证事务的"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"原子性"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240201213654-xs3havo","Type":"NodeParagraph","Properties":{"id":"20240201213654-xs3havo","updated":"20240201213654"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"MySQL"},{"Type":"NodeText","Data":"数据库的"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"数据备份、主备、主主、主从"},{"Type":"NodeText","Data":"都离不开"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"，需要依靠"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"binlog"},{"Type":"NodeText","Data":"来同步数据，保证数据一致性。"}]},{"ID":"20240201213655-bvvs4p0","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213655-bvvs4p0","updated":"20240201213655"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"参考"}]},{"ID":"20240201213656-7oryowx","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213656-7oryowx","updated":"20240201213656"},"Children":[{"ID":"20240201213657-k8grmpm","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213657-k8grmpm","updated":"20240201213657"},"Children":[{"ID":"20240201213658-f9kg6le","Type":"NodeParagraph","Properties":{"id":"20240201213658-f9kg6le","updated":"20240201213658"},"Children":[{"Type":"NodeText","Data":"《MySQL 实战 45 讲》"}]}]},{"ID":"20240201213659-dlsmrzo","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213659-dlsmrzo","updated":"20240201213659"},"Children":[{"ID":"20240201213660-mnl19ib","Type":"NodeParagraph","Properties":{"id":"20240201213660-mnl19ib","updated":"20240201213660"},"Children":[{"Type":"NodeText","Data":"《从零开始带你成为 MySQL 实战优化高手》"}]}]},{"ID":"20240201213661-je3qbsl","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213661-je3qbsl","updated":"20240201213661"},"Children":[{"ID":"20240201213662-o1fm3du","Type":"NodeParagraph","Properties":{"id":"20240201213662-o1fm3du","updated":"20240201213662"},"Children":[{"Type":"NodeText","Data":"《MySQL 是怎样运行的：从根儿上理解 MySQL》"}]}]},{"ID":"20240201213663-q24i65j","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213663-q24i65j","updated":"20240201213663"},"Children":[{"ID":"20240201213664-0m1vxq1","Type":"NodeParagraph","Properties":{"id":"20240201213664-0m1vxq1","updated":"20240201213664"},"Children":[{"Type":"NodeText","Data":"《MySQL 技术 Innodb 存储引擎》"}]}]}]},{"ID":"20240201213665-gnspkkj","Type":"NodeHTMLBlock","Data":"\u003cdiv\u003e\n\u003c!-- @include: @article-footer.snippet.md --\u003e\n\u003c/div\u003e","HtmlBlockType":2,"Properties":{"id":"20240201213665-gnspkkj","updated":"20240201213665"}}]}