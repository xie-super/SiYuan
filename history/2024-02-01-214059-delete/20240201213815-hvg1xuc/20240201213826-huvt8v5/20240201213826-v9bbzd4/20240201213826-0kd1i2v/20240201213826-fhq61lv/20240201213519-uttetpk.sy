{"ID":"20240201213519-uttetpk","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240201213519-uttetpk","title":"mysql-query-cache","updated":"20240201213519"},"Children":[{"ID":"20240201213520-98qyk56","Type":"NodeThematicBreak","Properties":{"id":"20240201213520-98qyk56","updated":"20240201213520"}},{"ID":"20240201213521-qba9zem","Type":"NodeParagraph","Properties":{"id":"20240201213521-qba9zem","updated":"20240201213521"},"Children":[{"Type":"NodeText","Data":"title: MySQL查询缓存详解"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"category: 数据库"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"tag:"}]},{"ID":"20240201213522-orflblx","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"MarkerOffset":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213522-orflblx","updated":"20240201213522"},"Children":[{"ID":"20240201213523-2t2q89s","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"MarkerOffset":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213523-2t2q89s","updated":"20240201213523"},"Children":[{"ID":"20240201213524-sfqkcay","Type":"NodeParagraph","Properties":{"id":"20240201213524-sfqkcay","updated":"20240201213524"},"Children":[{"Type":"NodeText","Data":"MySQL"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"head:"}]}]},{"ID":"20240201213525-uchoo99","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"MarkerOffset":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213525-uchoo99","updated":"20240201213525"},"Children":[{"ID":"20240201213526-rij2xfs","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213526-rij2xfs","updated":"20240201213526"},"Children":[{"ID":"20240201213527-rdwhoqy","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213527-rdwhoqy","updated":"20240201213527"},"Children":[{"ID":"20240201213528-ckl79p6","Type":"NodeParagraph","Properties":{"id":"20240201213528-ckl79p6","updated":"20240201213528"},"Children":[{"Type":"NodeText","Data":"meta"}]}]},{"ID":"20240201213529-ju4k0qz","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213529-ju4k0qz","updated":"20240201213529"},"Children":[{"ID":"20240201213530-men2yvo","Type":"NodeParagraph","Properties":{"id":"20240201213530-men2yvo","updated":"20240201213530"},"Children":[{"Type":"NodeText","Data":"name: keywords"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"content: MySQL查询缓存,MySQL缓存机制中的内存管理"}]}]}]}]},{"ID":"20240201213531-zbixadr","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"MarkerOffset":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213531-zbixadr","updated":"20240201213531"},"Children":[{"ID":"20240201213532-fvo415w","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213532-fvo415w","updated":"20240201213532"},"Children":[{"ID":"20240201213533-j1wabk8","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213533-j1wabk8","updated":"20240201213533"},"Children":[{"ID":"20240201213534-fwpx85u","Type":"NodeParagraph","Properties":{"id":"20240201213534-fwpx85u","updated":"20240201213534"},"Children":[{"Type":"NodeText","Data":"meta"}]}]},{"ID":"20240201213535-3grrw9i","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213535-3grrw9i","updated":"20240201213535"},"Children":[{"ID":"20240201213536-8xmdjue","Type":"NodeParagraph","Properties":{"id":"20240201213536-8xmdjue","updated":"20240201213536"},"Children":[{"Type":"NodeText","Data":"name: description"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"content: 为了提高完全相同的查询语句的响应速度，MySQL Server 会对查询语句进行 Hash 计算得到一个 Hash 值。MySQL Server 不会对 SQL 做任何处理，SQL 必须完全一致 Hash 值才会一样。得到 Hash 值之后，通过该 Hash 值到查询缓存中匹配该查询的结果。MySQL 中的查询缓存虽然能够提升数据库的查询性能，但是查询同时也带来了额外的开销，每次查询后都要做一次缓存操作，失效后还要销毁。"}]}]}]}]}]},{"ID":"20240201213537-08jnqle","Type":"NodeThematicBreak","Properties":{"id":"20240201213537-08jnqle","updated":"20240201213537"}},{"ID":"20240201213538-in2b79k","Type":"NodeParagraph","Properties":{"id":"20240201213538-in2b79k","updated":"20240201213538"},"Children":[{"Type":"NodeText","Data":"缓存是一个有效且实用的系统性能优化的手段，不论是操作系统还是各种软件和网站或多或少都用到了缓存。"}]},{"ID":"20240201213539-717ayrh","Type":"NodeParagraph","Properties":{"id":"20240201213539-717ayrh","updated":"20240201213539"},"Children":[{"Type":"NodeText","Data":"然而，有经验的 DBA 都建议生产环境中把 MySQL 自带的 Query Cache（查询缓存）给关掉。而且，从 MySQL 5.7.20 开始，就已经默认弃用查询缓存了。在 MySQL 8.0 及之后，更是直接删除了查询缓存的功能。"}]},{"ID":"20240201213540-p5uo2zb","Type":"NodeParagraph","Properties":{"id":"20240201213540-p5uo2zb","updated":"20240201213540"},"Children":[{"Type":"NodeText","Data":"这又是为什么呢？查询缓存真就这么鸡肋么?"}]},{"ID":"20240201213541-30vzxc9","Type":"NodeParagraph","Properties":{"id":"20240201213541-30vzxc9","updated":"20240201213541"},"Children":[{"Type":"NodeText","Data":"带着如下几个问题，我们正式进入本文。"}]},{"ID":"20240201213542-rwnye3c","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213542-rwnye3c","updated":"20240201213542"},"Children":[{"ID":"20240201213543-qg45pj6","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213543-qg45pj6","updated":"20240201213543"},"Children":[{"ID":"20240201213544-nmq35rr","Type":"NodeParagraph","Properties":{"id":"20240201213544-nmq35rr","updated":"20240201213544"},"Children":[{"Type":"NodeText","Data":"MySQL 查询缓存是什么？适用范围？"}]}]},{"ID":"20240201213545-crn1afg","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213545-crn1afg","updated":"20240201213545"},"Children":[{"ID":"20240201213546-ovhojw9","Type":"NodeParagraph","Properties":{"id":"20240201213546-ovhojw9","updated":"20240201213546"},"Children":[{"Type":"NodeText","Data":"MySQL 缓存规则是什么？"}]}]},{"ID":"20240201213547-2ji4fx1","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213547-2ji4fx1","updated":"20240201213547"},"Children":[{"ID":"20240201213548-05c44tw","Type":"NodeParagraph","Properties":{"id":"20240201213548-05c44tw","updated":"20240201213548"},"Children":[{"Type":"NodeText","Data":"MySQL 缓存的优缺点是什么？"}]}]},{"ID":"20240201213549-xsd907t","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213549-xsd907t","updated":"20240201213549"},"Children":[{"ID":"20240201213550-lbgl5b1","Type":"NodeParagraph","Properties":{"id":"20240201213550-lbgl5b1","updated":"20240201213550"},"Children":[{"Type":"NodeText","Data":"MySQL 缓存对性能有什么影响？"}]}]}]},{"ID":"20240201213551-0ylfktc","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213551-0ylfktc","updated":"20240201213551"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"MySQL 查询缓存介绍"}]},{"ID":"20240201213552-81q7eh8","Type":"NodeParagraph","Properties":{"id":"20240201213552-81q7eh8","updated":"20240201213552"},"Children":[{"Type":"NodeText","Data":"MySQL 体系架构如下图所示："}]},{"ID":"20240201213553-xfaboyv","Type":"NodeParagraph","Properties":{"id":"20240201213553-xfaboyv","updated":"20240201213553"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/mysql/mysql-architecture.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213554-a0p00ak","Type":"NodeParagraph","Properties":{"id":"20240201213554-a0p00ak","updated":"20240201213554"},"Children":[{"Type":"NodeText","Data":"为了提高完全相同的查询语句的响应速度，MySQL Server 会对查询语句进行 Hash 计算得到一个 Hash 值。MySQL Server 不会对 SQL 做任何处理，SQL 必须完全一致 Hash 值才会一样。得到 Hash 值之后，通过该 Hash 值到查询缓存中匹配该查询的结果。"}]},{"ID":"20240201213555-zojmfdg","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213555-zojmfdg","updated":"20240201213555"},"Children":[{"ID":"20240201213556-zrwy11z","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213556-zrwy11z","updated":"20240201213556"},"Children":[{"ID":"20240201213557-whda9yi","Type":"NodeParagraph","Properties":{"id":"20240201213557-whda9yi","updated":"20240201213557"},"Children":[{"Type":"NodeText","Data":"如果匹配（命中），则将查询的结果集直接返回给客户端，不必再解析、执行查询。"}]}]},{"ID":"20240201213558-jinzsve","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213558-jinzsve","updated":"20240201213558"},"Children":[{"ID":"20240201213559-kcbesl6","Type":"NodeParagraph","Properties":{"id":"20240201213559-kcbesl6","updated":"20240201213559"},"Children":[{"Type":"NodeText","Data":"如果没有匹配（未命中），则将 Hash 值和结果集保存在查询缓存中，以便以后使用。"}]}]}]},{"ID":"20240201213560-3w4xj1o","Type":"NodeParagraph","Properties":{"id":"20240201213560-3w4xj1o","updated":"20240201213560"},"Children":[{"Type":"NodeText","Data":"也就是说，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"一个查询语句（select）到了 MySQL Server 之后，会先到查询缓存看看，如果曾经执行过的话，就直接返回结果集给客户端。"}]},{"ID":"20240201213561-0ph5yyn","Type":"NodeParagraph","Properties":{"id":"20240201213561-0ph5yyn","updated":"20240201213561"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/javaguide/13526879-3037b144ed09eb88.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213562-5s9fz29","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213562-5s9fz29","updated":"20240201213562"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"MySQL 查询缓存管理和配置"}]},{"ID":"20240201213563-zypexeu","Type":"NodeParagraph","Properties":{"id":"20240201213563-zypexeu","updated":"20240201213563"},"Children":[{"Type":"NodeText","Data":"通过 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"show variables like '%query_cache%'"},{"Type":"NodeText","Data":"命令可以查看查询缓存相关的信息。"}]},{"ID":"20240201213564-togyllt","Type":"NodeParagraph","Properties":{"id":"20240201213564-togyllt","updated":"20240201213564"},"Children":[{"Type":"NodeText","Data":"8.0 版本之前的话，打印的信息可能是下面这样的："}]},{"ID":"20240201213565-gt5qn6g","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"YmFzaA==","CodeBlockCloseFence":"YGBg","Properties":{"id":"20240201213565-gt5qn6g","updated":"20240201213565"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA==","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"mysql\u003e show variables like '%query_cache%';\n+------------------------------+---------+\n| Variable_name                | Value   |\n+------------------------------+---------+\n| have_query_cache             | YES     |\n| query_cache_limit            | 1048576 |\n| query_cache_min_res_unit     | 4096    |\n| query_cache_size             | 599040  |\n| query_cache_type             | ON      |\n| query_cache_wlock_invalidate | OFF     |\n+------------------------------+---------+\n6 rows in set (0.02 sec)\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20240201213566-ns5ga00","Type":"NodeParagraph","Properties":{"id":"20240201213566-ns5ga00","updated":"20240201213566"},"Children":[{"Type":"NodeText","Data":"8.0 以及之后版本之后，打印的信息是下面这样的："}]},{"ID":"20240201213567-mr1eopd","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"YmFzaA==","CodeBlockCloseFence":"YGBg","Properties":{"id":"20240201213567-mr1eopd","updated":"20240201213567"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA==","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"mysql\u003e show variables like '%query_cache%';\n+------------------+-------+\n| Variable_name    | Value |\n+------------------+-------+\n| have_query_cache | NO    |\n+------------------+-------+\n1 row in set (0.01 sec)\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20240201213568-kvjgg9d","Type":"NodeParagraph","Properties":{"id":"20240201213568-kvjgg9d","updated":"20240201213568"},"Children":[{"Type":"NodeText","Data":"我们这里对 8.0 版本之前"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"show variables like '%query_cache%';"},{"Type":"NodeText","Data":"命令打印出来的信息进行解释。"}]},{"ID":"20240201213569-ku08z4z","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213569-ku08z4z","updated":"20240201213569"},"Children":[{"ID":"20240201213570-fg1kaaz","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213570-fg1kaaz","updated":"20240201213570"},"Children":[{"ID":"20240201213571-66pq9e4","Type":"NodeParagraph","Properties":{"id":"20240201213571-66pq9e4","updated":"20240201213571"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong code","TextMarkTextContent":"have_query_cache"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"："},{"Type":"NodeText","Data":" 该 MySQL Server 是否支持查询缓存，如果是 YES 表示支持，否则则是不支持。"}]}]},{"ID":"20240201213572-drnztzj","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213572-drnztzj","updated":"20240201213572"},"Children":[{"ID":"20240201213573-hdwfeq7","Type":"NodeParagraph","Properties":{"id":"20240201213573-hdwfeq7","updated":"20240201213573"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong code","TextMarkTextContent":"query_cache_limit"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"："},{"Type":"NodeText","Data":" MySQL 查询缓存的最大查询结果，查询结果大于该值时不会被缓存。"}]}]},{"ID":"20240201213574-llx1t8u","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213574-llx1t8u","updated":"20240201213574"},"Children":[{"ID":"20240201213575-qixfpsk","Type":"NodeParagraph","Properties":{"id":"20240201213575-qixfpsk","updated":"20240201213575"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong code","TextMarkTextContent":"query_cache_min_res_unit"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"："},{"Type":"NodeText","Data":" 查询缓存分配的最小块的大小(字节)。当查询进行的时候，MySQL 把查询结果保存在查询缓存中，但如果要保存的结果比较大，超过 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"query_cache_min_res_unit"},{"Type":"NodeText","Data":" 的值 ，这时候 MySQL 将一边检索结果，一边进行保存结果，也就是说，有可能在一次查询中，MySQL 要进行多次内存分配的操作。适当的调节 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"query_cache_min_res_unit"},{"Type":"NodeText","Data":" 可以优化内存。"}]}]},{"ID":"20240201213576-ohun3lf","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213576-ohun3lf","updated":"20240201213576"},"Children":[{"ID":"20240201213577-em4k8rt","Type":"NodeParagraph","Properties":{"id":"20240201213577-em4k8rt","updated":"20240201213577"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong code","TextMarkTextContent":"query_cache_size"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"："},{"Type":"NodeText","Data":" 为缓存查询结果分配的内存的数量，单位是字节，且数值必须是 1024 的整数倍。默认值是 0，即禁用查询缓存。"}]}]},{"ID":"20240201213578-g8iab62","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213578-g8iab62","updated":"20240201213578"},"Children":[{"ID":"20240201213579-19d230z","Type":"NodeParagraph","Properties":{"id":"20240201213579-19d230z","updated":"20240201213579"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong code","TextMarkTextContent":"query_cache_type"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"："},{"Type":"NodeText","Data":" 设置查询缓存类型，默认为 ON。设置 GLOBAL 值可以设置后面的所有客户端连接的类型。客户端可以设置 SESSION 值以影响他们自己对查询缓存的使用。"}]}]},{"ID":"20240201213580-iscptl5","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213580-iscptl5","updated":"20240201213580"},"Children":[{"ID":"20240201213581-wrth2i1","Type":"NodeParagraph","Properties":{"id":"20240201213581-wrth2i1","updated":"20240201213581"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong code","TextMarkTextContent":"query_cache_wlock_invalidate"},{"Type":"NodeText","Data":"：如果某个表被锁住，是否返回缓存中的数据，默认关闭，也是建议的。"}]}]}]},{"ID":"20240201213582-t5hl1cw","Type":"NodeParagraph","Properties":{"id":"20240201213582-t5hl1cw","updated":"20240201213582"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"query_cache_type"},{"Type":"NodeText","Data":" 可能的值(修改 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"query_cache_type"},{"Type":"NodeText","Data":" 需要重启 MySQL Server)："}]},{"ID":"20240201213583-4ss60y5","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213583-4ss60y5","updated":"20240201213583"},"Children":[{"ID":"20240201213584-n15kue9","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213584-n15kue9","updated":"20240201213584"},"Children":[{"ID":"20240201213585-qcx28uk","Type":"NodeParagraph","Properties":{"id":"20240201213585-qcx28uk","updated":"20240201213585"},"Children":[{"Type":"NodeText","Data":"0 或 OFF：关闭查询功能。"}]}]},{"ID":"20240201213586-sy7eezt","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213586-sy7eezt","updated":"20240201213586"},"Children":[{"ID":"20240201213587-1t67u1o","Type":"NodeParagraph","Properties":{"id":"20240201213587-1t67u1o","updated":"20240201213587"},"Children":[{"Type":"NodeText","Data":"1 或 ON：开启查询缓存功能，但不缓存 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"Select SQL_NO_CACHE"},{"Type":"NodeText","Data":" 开头的查询。"}]}]},{"ID":"20240201213588-itmhbe7","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213588-itmhbe7","updated":"20240201213588"},"Children":[{"ID":"20240201213589-3ejxksa","Type":"NodeParagraph","Properties":{"id":"20240201213589-3ejxksa","updated":"20240201213589"},"Children":[{"Type":"NodeText","Data":"2 或 DEMAND：开启查询缓存功能，但仅缓存 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"Select SQL_CACHE"},{"Type":"NodeText","Data":" 开头的查询。"}]}]}]},{"ID":"20240201213590-yg6vfwi","Type":"NodeParagraph","Properties":{"id":"20240201213590-yg6vfwi","updated":"20240201213590"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"建议"},{"Type":"NodeText","Data":"："}]},{"ID":"20240201213591-0avp6vd","Type":"NodeList","ListData":{"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213591-0avp6vd","updated":"20240201213591"},"Children":[{"ID":"20240201213592-t3109p4","Type":"NodeListItem","Data":"-","ListData":{"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213592-t3109p4","updated":"20240201213592"},"Children":[{"ID":"20240201213593-chxxz85","Type":"NodeParagraph","Properties":{"id":"20240201213593-chxxz85","updated":"20240201213593"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"query_cache_size"},{"Type":"NodeText","Data":"不建议设置的过大。过大的空间不但挤占实例其他内存结构的空间，而且会增加在缓存中搜索的开销。建议根据实例规格，初始值设置为 10MB 到 100MB 之间的值，而后根据运行使用情况调整。"}]}]},{"ID":"20240201213594-dhkxzqc","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213594-dhkxzqc","updated":"20240201213594"},"Children":[{"ID":"20240201213595-62e26ya","Type":"NodeParagraph","Properties":{"id":"20240201213595-62e26ya","updated":"20240201213595"},"Children":[{"Type":"NodeText","Data":"建议通过调整 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"query_cache_size"},{"Type":"NodeText","Data":" 的值来开启、关闭查询缓存，因为修改"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"query_cache_type"},{"Type":"NodeText","Data":" 参数需要重启 MySQL Server 生效。"}]},{"ID":"20240201213596-e7hdyfg","Type":"NodeParagraph","Properties":{"id":"20240201213596-e7hdyfg","updated":"20240201213596"},"Children":[{"Type":"NodeText","Data":"8.0 版本之前，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"my.cnf"},{"Type":"NodeText","Data":" 加入以下配置，重启 MySQL 开启查询缓存"}]}]}]},{"ID":"20240201213597-nj2xs6i","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"cHJvcGVydGllcw==","CodeBlockCloseFence":"YGBg","Properties":{"id":"20240201213597-nj2xs6i","updated":"20240201213597"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHJvcGVydGllcw==","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"query_cache_type=1\nquery_cache_size=600000\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20240201213598-5w07256","Type":"NodeParagraph","Properties":{"id":"20240201213598-5w07256","updated":"20240201213598"},"Children":[{"Type":"NodeText","Data":"或者，MySQL 执行以下命令也可以开启查询缓存"}]},{"ID":"20240201213599-4404j6k","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"cHJvcGVydGllcw==","CodeBlockCloseFence":"YGBg","Properties":{"id":"20240201213599-4404j6k","updated":"20240201213599"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHJvcGVydGllcw==","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"set global  query_cache_type=1;\nset global  query_cache_size=600000;\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20240201213600-oljkokb","Type":"NodeParagraph","Properties":{"id":"20240201213600-oljkokb","updated":"20240201213600"},"Children":[{"Type":"NodeText","Data":"手动清理缓存可以使用下面三个 SQL："}]},{"ID":"20240201213601-1kgu7i9","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213601-1kgu7i9","updated":"20240201213601"},"Children":[{"ID":"20240201213602-vkl6qb3","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213602-vkl6qb3","updated":"20240201213602"},"Children":[{"ID":"20240201213603-lp8hibp","Type":"NodeParagraph","Properties":{"id":"20240201213603-lp8hibp","updated":"20240201213603"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"flush query cache;"},{"Type":"NodeText","Data":"：清理查询缓存内存碎片。"}]}]},{"ID":"20240201213604-180zmgg","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213604-180zmgg","updated":"20240201213604"},"Children":[{"ID":"20240201213605-wh22cl0","Type":"NodeParagraph","Properties":{"id":"20240201213605-wh22cl0","updated":"20240201213605"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"reset query cache;"},{"Type":"NodeText","Data":"：从查询缓存中移除所有查询。"}]}]},{"ID":"20240201213606-lvlue5b","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213606-lvlue5b","updated":"20240201213606"},"Children":[{"ID":"20240201213607-hkucdpf","Type":"NodeParagraph","Properties":{"id":"20240201213607-hkucdpf","updated":"20240201213607"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"flush tables；"},{"Type":"NodeText","Data":" 关闭所有打开的表，同时该操作会清空查询缓存中的内容。"}]}]}]},{"ID":"20240201213608-1a5dsjw","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213608-1a5dsjw","updated":"20240201213608"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"MySQL 缓存机制"}]},{"ID":"20240201213609-0rjbxii","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213609-0rjbxii","updated":"20240201213609"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"缓存规则"}]},{"ID":"20240201213610-y2oqsxq","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213610-y2oqsxq","updated":"20240201213610"},"Children":[{"ID":"20240201213611-u16fiz2","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213611-u16fiz2","updated":"20240201213611"},"Children":[{"ID":"20240201213612-4srudnv","Type":"NodeParagraph","Properties":{"id":"20240201213612-4srudnv","updated":"20240201213612"},"Children":[{"Type":"NodeText","Data":"查询缓存会将查询语句和结果集保存到内存（一般是 key-value 的形式，key 是查询语句，value 是查询的结果集），下次再查直接从内存中取。"}]}]},{"ID":"20240201213613-bu1nb5y","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213613-bu1nb5y","updated":"20240201213613"},"Children":[{"ID":"20240201213614-sqbbtuv","Type":"NodeParagraph","Properties":{"id":"20240201213614-sqbbtuv","updated":"20240201213614"},"Children":[{"Type":"NodeText","Data":"缓存的结果是通过 sessions 共享的，所以一个 client 查询的缓存结果，另一个 client 也可以使用。"}]}]},{"ID":"20240201213615-fvti0vf","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213615-fvti0vf","updated":"20240201213615"},"Children":[{"ID":"20240201213616-9xuhe4d","Type":"NodeParagraph","Properties":{"id":"20240201213616-9xuhe4d","updated":"20240201213616"},"Children":[{"Type":"NodeText","Data":"SQL 必须完全一致才会导致查询缓存命中（大小写、空格、使用的数据库、协议版本、字符集等必须一致）。检查查询缓存时，MySQL Server 不会对 SQL 做任何处理，它精确的使用客户端传来的查询。"}]}]},{"ID":"20240201213617-agmv6cj","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213617-agmv6cj","updated":"20240201213617"},"Children":[{"ID":"20240201213618-9wel05k","Type":"NodeParagraph","Properties":{"id":"20240201213618-9wel05k","updated":"20240201213618"},"Children":[{"Type":"NodeText","Data":"不缓存查询中的子查询结果集，仅缓存查询最终结果集。"}]}]},{"ID":"20240201213619-d34kfux","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213619-d34kfux","updated":"20240201213619"},"Children":[{"ID":"20240201213620-irbr04o","Type":"NodeParagraph","Properties":{"id":"20240201213620-irbr04o","updated":"20240201213620"},"Children":[{"Type":"NodeText","Data":"不确定的函数将永远不会被缓存, 比如 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"now()"},{"Type":"NodeText","Data":"、"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"curdate()"},{"Type":"NodeText","Data":"、"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"last_insert_id()"},{"Type":"NodeText","Data":"、"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"rand()"},{"Type":"NodeText","Data":" 等。"}]}]},{"ID":"20240201213621-9tgx1mi","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213621-9tgx1mi","updated":"20240201213621"},"Children":[{"ID":"20240201213622-2ae58c8","Type":"NodeParagraph","Properties":{"id":"20240201213622-2ae58c8","updated":"20240201213622"},"Children":[{"Type":"NodeText","Data":"不缓存产生告警（Warnings）的查询。"}]}]},{"ID":"20240201213623-zlvkfl7","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213623-zlvkfl7","updated":"20240201213623"},"Children":[{"ID":"20240201213624-g6eedid","Type":"NodeParagraph","Properties":{"id":"20240201213624-g6eedid","updated":"20240201213624"},"Children":[{"Type":"NodeText","Data":"太大的结果集不会被缓存 (\u003c query_cache_limit)。"}]}]},{"ID":"20240201213625-kz4epdk","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213625-kz4epdk","updated":"20240201213625"},"Children":[{"ID":"20240201213626-y9upiwk","Type":"NodeParagraph","Properties":{"id":"20240201213626-y9upiwk","updated":"20240201213626"},"Children":[{"Type":"NodeText","Data":"如果查询中包含任何用户自定义函数、存储函数、用户变量、临时表、MySQL 库中的系统表，其查询结果也不会被缓存。"}]}]},{"ID":"20240201213627-3ovmd7y","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213627-3ovmd7y","updated":"20240201213627"},"Children":[{"ID":"20240201213628-4j7009d","Type":"NodeParagraph","Properties":{"id":"20240201213628-4j7009d","updated":"20240201213628"},"Children":[{"Type":"NodeText","Data":"缓存建立之后，MySQL 的查询缓存系统会跟踪查询中涉及的每张表，如果这些表（数据或结构）发生变化，那么和这张表相关的所有缓存数据都将失效。"}]}]},{"ID":"20240201213629-s5royc4","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213629-s5royc4","updated":"20240201213629"},"Children":[{"ID":"20240201213630-ulbfi96","Type":"NodeParagraph","Properties":{"id":"20240201213630-ulbfi96","updated":"20240201213630"},"Children":[{"Type":"NodeText","Data":"MySQL 缓存在分库分表环境下是不起作用的。"}]}]},{"ID":"20240201213631-pcdh7s2","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213631-pcdh7s2","updated":"20240201213631"},"Children":[{"ID":"20240201213632-68e2l2q","Type":"NodeParagraph","Properties":{"id":"20240201213632-68e2l2q","updated":"20240201213632"},"Children":[{"Type":"NodeText","Data":"不缓存使用 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"SQL_NO_CACHE"},{"Type":"NodeText","Data":" 的查询。"}]}]},{"ID":"20240201213633-lba0yz1","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213633-lba0yz1","updated":"20240201213633"},"Children":[{"ID":"20240201213634-uwjpx4m","Type":"NodeParagraph","Properties":{"id":"20240201213634-uwjpx4m","updated":"20240201213634"},"Children":[{"Type":"NodeText","Data":"……"}]}]}]},{"ID":"20240201213635-ghbd13z","Type":"NodeParagraph","Properties":{"id":"20240201213635-ghbd13z","updated":"20240201213635"},"Children":[{"Type":"NodeText","Data":"查询缓存 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"SELECT"},{"Type":"NodeText","Data":" 选项示例："}]},{"ID":"20240201213636-7itasy0","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"c3Fs","CodeBlockCloseFence":"YGBg","Properties":{"id":"20240201213636-7itasy0","updated":"20240201213636"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c3Fs","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"SELECT SQL_CACHE id, name FROM customer;# 会缓存\nSELECT SQL_NO_CACHE id, name FROM customer;# 不会缓存\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20240201213637-b7bpawa","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213637-b7bpawa","updated":"20240201213637"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"缓存机制中的内存管理"}]},{"ID":"20240201213638-wqq425c","Type":"NodeParagraph","Properties":{"id":"20240201213638-wqq425c","updated":"20240201213638"},"Children":[{"Type":"NodeText","Data":"查询缓存是完全存储在内存中的，所以在配置和使用它之前，我们需要先了解它是如何使用内存的。"}]},{"ID":"20240201213639-ly3s2nh","Type":"NodeParagraph","Properties":{"id":"20240201213639-ly3s2nh","updated":"20240201213639"},"Children":[{"Type":"NodeText","Data":"MySQL 查询缓存使用内存池技术，自己管理内存释放和分配，而不是通过操作系统。内存池使用的基本单位是变长的 block, 用来存储类型、大小、数据等信息。一个结果集的缓存通过链表把这些 block 串起来。block 最短长度为 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"query_cache_min_res_unit"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240201213640-ilvytjz","Type":"NodeParagraph","Properties":{"id":"20240201213640-ilvytjz","updated":"20240201213640"},"Children":[{"Type":"NodeText","Data":"当服务器启动的时候，会初始化缓存需要的内存，是一个完整的空闲块。当查询结果需要缓存的时候，先从空闲块中申请一个数据块为参数 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"query_cache_min_res_unit"},{"Type":"NodeText","Data":" 配置的空间，即使缓存数据很小，申请数据块也是这个，因为查询开始返回结果的时候就分配空间，此时无法预知结果多大。"}]},{"ID":"20240201213641-qasm01h","Type":"NodeParagraph","Properties":{"id":"20240201213641-qasm01h","updated":"20240201213641"},"Children":[{"Type":"NodeText","Data":"分配内存块需要先锁住空间块，所以操作很慢，MySQL 会尽量避免这个操作，选择尽可能小的内存块，如果不够，继续申请，如果存储完时有空余则释放多余的。"}]},{"ID":"20240201213642-vie0p17","Type":"NodeParagraph","Properties":{"id":"20240201213642-vie0p17","updated":"20240201213642"},"Children":[{"Type":"NodeText","Data":"但是如果并发的操作，余下的需要回收的空间很小，小于 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"query_cache_min_res_unit"},{"Type":"NodeText","Data":"，不能再次被使用，就会产生碎片。"}]},{"ID":"20240201213643-4dr7bio","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213643-4dr7bio","updated":"20240201213643"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"MySQL 查询缓存的优缺点"}]},{"ID":"20240201213644-zi2r1b9","Type":"NodeParagraph","Properties":{"id":"20240201213644-zi2r1b9","updated":"20240201213644"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"优点："}]},{"ID":"20240201213645-f1jfywe","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213645-f1jfywe","updated":"20240201213645"},"Children":[{"ID":"20240201213646-ios3pz1","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213646-ios3pz1","updated":"20240201213646"},"Children":[{"ID":"20240201213647-vxe469c","Type":"NodeParagraph","Properties":{"id":"20240201213647-vxe469c","updated":"20240201213647"},"Children":[{"Type":"NodeText","Data":"查询缓存的查询，发生在 MySQL 接收到客户端的查询请求、查询权限验证之后和查询 SQL 解析之前。也就是说，当 MySQL 接收到客户端的查询 SQL 之后，仅仅只需要对其进行相应的权限验证之后，就会通过查询缓存来查找结果，甚至都不需要经过 Optimizer 模块进行执行计划的分析优化，更不需要发生任何存储引擎的交互。"}]}]},{"ID":"20240201213648-83ngrd1","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213648-83ngrd1","updated":"20240201213648"},"Children":[{"ID":"20240201213649-xntyr3e","Type":"NodeParagraph","Properties":{"id":"20240201213649-xntyr3e","updated":"20240201213649"},"Children":[{"Type":"NodeText","Data":"由于查询缓存是基于内存的，直接从内存中返回相应的查询结果，因此减少了大量的磁盘 I/O 和 CPU 计算，导致效率非常高。"}]}]}]},{"ID":"20240201213650-a6t0jjg","Type":"NodeParagraph","Properties":{"id":"20240201213650-a6t0jjg","updated":"20240201213650"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"缺点："}]},{"ID":"20240201213651-rxi6xtf","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213651-rxi6xtf","updated":"20240201213651"},"Children":[{"ID":"20240201213652-7bfzyjw","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213652-7bfzyjw","updated":"20240201213652"},"Children":[{"ID":"20240201213653-ncr2kms","Type":"NodeParagraph","Properties":{"id":"20240201213653-ncr2kms","updated":"20240201213653"},"Children":[{"Type":"NodeText","Data":"MySQL 会对每条接收到的 SELECT 类型的查询进行 Hash 计算，然后查找这个查询的缓存结果是否存在。虽然 Hash 计算和查找的效率已经足够高了，一条查询语句所带来的开销可以忽略，但一旦涉及到高并发，有成千上万条查询语句时，hash 计算和查找所带来的开销就必须重视了。"}]}]},{"ID":"20240201213654-nzoejl0","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213654-nzoejl0","updated":"20240201213654"},"Children":[{"ID":"20240201213655-ikhhhue","Type":"NodeParagraph","Properties":{"id":"20240201213655-ikhhhue","updated":"20240201213655"},"Children":[{"Type":"NodeText","Data":"查询缓存的失效问题。如果表的变更比较频繁，则会造成查询缓存的失效率非常高。表的变更不仅仅指表中的数据发生变化，还包括表结构或者索引的任何变化。"}]}]},{"ID":"20240201213656-gfs6bxq","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213656-gfs6bxq","updated":"20240201213656"},"Children":[{"ID":"20240201213657-hnum61w","Type":"NodeParagraph","Properties":{"id":"20240201213657-hnum61w","updated":"20240201213657"},"Children":[{"Type":"NodeText","Data":"查询语句不同，但查询结果相同的查询都会被缓存，这样便会造成内存资源的过度消耗。查询语句的字符大小写、空格或者注释的不同，查询缓存都会认为是不同的查询（因为他们的 Hash 值会不同）。"}]}]},{"ID":"20240201213658-tj3pqye","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213658-tj3pqye","updated":"20240201213658"},"Children":[{"ID":"20240201213659-bxawqb8","Type":"NodeParagraph","Properties":{"id":"20240201213659-bxawqb8","updated":"20240201213659"},"Children":[{"Type":"NodeText","Data":"相关系统变量设置不合理会造成大量的内存碎片，这样便会导致查询缓存频繁清理内存。"}]}]}]},{"ID":"20240201213660-veldfeu","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213660-veldfeu","updated":"20240201213660"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"MySQL 查询缓存对性能的影响"}]},{"ID":"20240201213661-5ixkt9g","Type":"NodeParagraph","Properties":{"id":"20240201213661-5ixkt9g","updated":"20240201213661"},"Children":[{"Type":"NodeText","Data":"在 MySQL Server 中打开查询缓存对数据库的读和写都会带来额外的消耗:"}]},{"ID":"20240201213662-nqb3q0v","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213662-nqb3q0v","updated":"20240201213662"},"Children":[{"ID":"20240201213663-g0o5zmp","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213663-g0o5zmp","updated":"20240201213663"},"Children":[{"ID":"20240201213664-eq3co0j","Type":"NodeParagraph","Properties":{"id":"20240201213664-eq3co0j","updated":"20240201213664"},"Children":[{"Type":"NodeText","Data":"读查询开始之前必须检查是否命中缓存。"}]}]},{"ID":"20240201213665-n9b1bnz","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213665-n9b1bnz","updated":"20240201213665"},"Children":[{"ID":"20240201213666-ng4c2wg","Type":"NodeParagraph","Properties":{"id":"20240201213666-ng4c2wg","updated":"20240201213666"},"Children":[{"Type":"NodeText","Data":"如果读查询可以缓存，那么执行完查询操作后，会查询结果和查询语句写入缓存。"}]}]},{"ID":"20240201213667-7z6bbvu","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213667-7z6bbvu","updated":"20240201213667"},"Children":[{"ID":"20240201213668-rcjdpvg","Type":"NodeParagraph","Properties":{"id":"20240201213668-rcjdpvg","updated":"20240201213668"},"Children":[{"Type":"NodeText","Data":"当向某个表写入数据的时候，必须将这个表所有的缓存设置为失效，如果缓存空间很大，则消耗也会很大，可能使系统僵死一段时间，因为这个操作是靠全局锁操作来保护的。"}]}]},{"ID":"20240201213669-hxihl35","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213669-hxihl35","updated":"20240201213669"},"Children":[{"ID":"20240201213670-793m2lu","Type":"NodeParagraph","Properties":{"id":"20240201213670-793m2lu","updated":"20240201213670"},"Children":[{"Type":"NodeText","Data":"对 InnoDB 表，当修改一个表时，设置了缓存失效，但是多版本特性会暂时将这修改对其他事务屏蔽，在这个事务提交之前，所有查询都无法使用缓存，直到这个事务被提交，所以长时间的事务，会大大降低查询缓存的命中。"}]}]}]},{"ID":"20240201213671-izzn1z9","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213671-izzn1z9","updated":"20240201213671"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"总结"}]},{"ID":"20240201213672-p490ohp","Type":"NodeParagraph","Properties":{"id":"20240201213672-p490ohp","updated":"20240201213672"},"Children":[{"Type":"NodeText","Data":"MySQL 中的查询缓存虽然能够提升数据库的查询性能，但是查询同时也带来了额外的开销，每次查询后都要做一次缓存操作，失效后还要销毁。"}]},{"ID":"20240201213673-rh4vhw5","Type":"NodeParagraph","Properties":{"id":"20240201213673-rh4vhw5","updated":"20240201213673"},"Children":[{"Type":"NodeText","Data":"查询缓存是一个适用较少情况的缓存机制。如果你的应用对数据库的更新很少，那么查询缓存将会作用显著。比较典型的如博客系统，一般博客更新相对较慢，数据表相对稳定不变，这时候查询缓存的作用会比较明显。"}]},{"ID":"20240201213674-sfc4fsy","Type":"NodeParagraph","Properties":{"id":"20240201213674-sfc4fsy","updated":"20240201213674"},"Children":[{"Type":"NodeText","Data":"简单总结一下查询缓存的适用场景："}]},{"ID":"20240201213675-j5afqr4","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213675-j5afqr4","updated":"20240201213675"},"Children":[{"ID":"20240201213676-1b27q0h","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213676-1b27q0h","updated":"20240201213676"},"Children":[{"ID":"20240201213677-srbqqbs","Type":"NodeParagraph","Properties":{"id":"20240201213677-srbqqbs","updated":"20240201213677"},"Children":[{"Type":"NodeText","Data":"表数据修改不频繁、数据较静态。"}]}]},{"ID":"20240201213678-6uftmnq","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213678-6uftmnq","updated":"20240201213678"},"Children":[{"ID":"20240201213679-asbe32n","Type":"NodeParagraph","Properties":{"id":"20240201213679-asbe32n","updated":"20240201213679"},"Children":[{"Type":"NodeText","Data":"查询（Select）重复度高。"}]}]},{"ID":"20240201213680-uyikcko","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213680-uyikcko","updated":"20240201213680"},"Children":[{"ID":"20240201213681-l63h7ez","Type":"NodeParagraph","Properties":{"id":"20240201213681-l63h7ez","updated":"20240201213681"},"Children":[{"Type":"NodeText","Data":"查询结果集小于 1 MB。"}]}]}]},{"ID":"20240201213682-o6nwc21","Type":"NodeParagraph","Properties":{"id":"20240201213682-o6nwc21","updated":"20240201213682"},"Children":[{"Type":"NodeText","Data":"对于一个更新频繁的系统来说，查询缓存缓存的作用是很微小的，在某些情况下开启查询缓存会带来性能的下降。"}]},{"ID":"20240201213683-m27d75y","Type":"NodeParagraph","Properties":{"id":"20240201213683-m27d75y","updated":"20240201213683"},"Children":[{"Type":"NodeText","Data":"简单总结一下查询缓存不适用的场景："}]},{"ID":"20240201213684-8oisnrg","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213684-8oisnrg","updated":"20240201213684"},"Children":[{"ID":"20240201213685-p2lzluc","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213685-p2lzluc","updated":"20240201213685"},"Children":[{"ID":"20240201213686-183hx44","Type":"NodeParagraph","Properties":{"id":"20240201213686-183hx44","updated":"20240201213686"},"Children":[{"Type":"NodeText","Data":"表中的数据、表结构或者索引变动频繁"}]}]},{"ID":"20240201213687-xe2rs5c","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213687-xe2rs5c","updated":"20240201213687"},"Children":[{"ID":"20240201213688-k8r764p","Type":"NodeParagraph","Properties":{"id":"20240201213688-k8r764p","updated":"20240201213688"},"Children":[{"Type":"NodeText","Data":"重复的查询很少"}]}]},{"ID":"20240201213689-2iq1cac","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213689-2iq1cac","updated":"20240201213689"},"Children":[{"ID":"20240201213690-plrnc1t","Type":"NodeParagraph","Properties":{"id":"20240201213690-plrnc1t","updated":"20240201213690"},"Children":[{"Type":"NodeText","Data":"查询的结果集很大"}]}]}]},{"ID":"20240201213691-dgrl4l4","Type":"NodeParagraph","Properties":{"id":"20240201213691-dgrl4l4","updated":"20240201213691"},"Children":[{"Type":"NodeText","Data":"《高性能 MySQL》这样写到："}]},{"ID":"20240201213692-g5uuayd","Type":"NodeBlockquote","Properties":{"id":"20240201213692-g5uuayd","updated":"20240201213692"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240201213693-ez99lta","Type":"NodeParagraph","Properties":{"id":"20240201213693-ez99lta","updated":"20240201213693"},"Children":[{"Type":"NodeText","Data":"根据我们的经验，在高并发压力环境中查询缓存会导致系统性能的下降，甚至僵死。如果你一 定要使用查询缓存，那么不要设置太大内存，而且只有在明确收益的时候才使用（数据库内容修改次数较少）。"}]}]},{"ID":"20240201213694-jmkwnme","Type":"NodeParagraph","Properties":{"id":"20240201213694-jmkwnme","updated":"20240201213694"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"确实是这样的！实际项目中，更建议使用本地缓存（比如 Caffeine）或者分布式缓存（比如 Redis） ，性能更好，更通用一些。"}]},{"ID":"20240201213695-byafyoo","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213695-byafyoo","updated":"20240201213695"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"参考"}]},{"ID":"20240201213696-65iuf5p","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213696-65iuf5p","updated":"20240201213696"},"Children":[{"ID":"20240201213697-of1t6ym","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213697-of1t6ym","updated":"20240201213697"},"Children":[{"ID":"20240201213698-ojjmimq","Type":"NodeParagraph","Properties":{"id":"20240201213698-ojjmimq","updated":"20240201213698"},"Children":[{"Type":"NodeText","Data":"《高性能 MySQL》"}]}]},{"ID":"20240201213699-dypq0fe","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213699-dypq0fe","updated":"20240201213699"},"Children":[{"ID":"20240201213700-xbfgxrd","Type":"NodeParagraph","Properties":{"id":"20240201213700-xbfgxrd","updated":"20240201213700"},"Children":[{"Type":"NodeText","Data":"MySQL 缓存机制："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://zhuanlan.zhihu.com/p/55947158","TextMarkTextContent":"https://zhuanlan.zhihu.com/p/55947158"}]}]},{"ID":"20240201213701-58u3rlg","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213701-58u3rlg","updated":"20240201213701"},"Children":[{"ID":"20240201213702-gou64mt","Type":"NodeParagraph","Properties":{"id":"20240201213702-gou64mt","updated":"20240201213702"},"Children":[{"Type":"NodeText","Data":"RDS MySQL 查询缓存（Query Cache）的设置和使用 - 阿里元云数据库 RDS 文档:"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://help.aliyun.com/document_detail/41717.html","TextMarkTextContent":"https://help.aliyun.com/document_detail/41717.html"}]}]},{"ID":"20240201213703-ey7m806","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213703-ey7m806","updated":"20240201213703"},"Children":[{"ID":"20240201213704-0bo4ln2","Type":"NodeParagraph","Properties":{"id":"20240201213704-0bo4ln2","updated":"20240201213704"},"Children":[{"Type":"NodeText","Data":"8.10.3 The MySQL Query Cache - MySQL 官方文档："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://dev.mysql.com/doc/refman/5.7/en/query-cache.html","TextMarkTextContent":"https://dev.mysql.com/doc/refman/5.7/en/query-cache.html"}]}]}]},{"ID":"20240201213705-7sb8c0q","Type":"NodeHTMLBlock","Data":"\u003cdiv\u003e\n\u003c!-- @include: @article-footer.snippet.md --\u003e\n\u003c/div\u003e","HtmlBlockType":2,"Properties":{"id":"20240201213705-7sb8c0q","updated":"20240201213705"}}]}