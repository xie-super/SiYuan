{"ID":"20240201213630-wqay8py","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240201213630-wqay8py","title":"cdn","updated":"20240201213630"},"Children":[{"ID":"20240201213631-uo5uljg","Type":"NodeThematicBreak","Properties":{"id":"20240201213631-uo5uljg","updated":"20240201213631"}},{"ID":"20240201213632-mjdosxp","Type":"NodeParagraph","Properties":{"id":"20240201213632-mjdosxp","updated":"20240201213632"},"Children":[{"Type":"NodeText","Data":"title: CDN工作原理详解"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"category: 高性能"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"head:"}]},{"ID":"20240201213633-r14zusz","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"MarkerOffset":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213633-r14zusz","updated":"20240201213633"},"Children":[{"ID":"20240201213634-h9s5ron","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"MarkerOffset":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213634-h9s5ron","updated":"20240201213634"},"Children":[{"ID":"20240201213635-cm30x16","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213635-cm30x16","updated":"20240201213635"},"Children":[{"ID":"20240201213636-rzf9ovh","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213636-rzf9ovh","updated":"20240201213636"},"Children":[{"ID":"20240201213637-ptrk4cp","Type":"NodeParagraph","Properties":{"id":"20240201213637-ptrk4cp","updated":"20240201213637"},"Children":[{"Type":"NodeText","Data":"meta"}]}]},{"ID":"20240201213638-rco858z","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213638-rco858z","updated":"20240201213638"},"Children":[{"ID":"20240201213639-xa7ijlm","Type":"NodeParagraph","Properties":{"id":"20240201213639-xa7ijlm","updated":"20240201213639"},"Children":[{"Type":"NodeText","Data":"name: keywords"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"content: CDN,内容分发网络"}]}]}]}]},{"ID":"20240201213640-r5auleb","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"MarkerOffset":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213640-r5auleb","updated":"20240201213640"},"Children":[{"ID":"20240201213641-cln4d3d","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213641-cln4d3d","updated":"20240201213641"},"Children":[{"ID":"20240201213642-sdleqsm","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213642-sdleqsm","updated":"20240201213642"},"Children":[{"ID":"20240201213643-d0dletu","Type":"NodeParagraph","Properties":{"id":"20240201213643-d0dletu","updated":"20240201213643"},"Children":[{"Type":"NodeText","Data":"meta"}]}]},{"ID":"20240201213644-xk4j3un","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213644-xk4j3un","updated":"20240201213644"},"Children":[{"ID":"20240201213645-48cejkk","Type":"NodeParagraph","Properties":{"id":"20240201213645-48cejkk","updated":"20240201213645"},"Children":[{"Type":"NodeText","Data":"name: description"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"content: CDN 就是将静态资源分发到多个不同的地方以实现就近访问，进而加快静态资源的访问速度，减轻服务器以及带宽的负担。"}]}]}]}]}]},{"ID":"20240201213646-bfm076a","Type":"NodeThematicBreak","Properties":{"id":"20240201213646-bfm076a","updated":"20240201213646"}},{"ID":"20240201213647-kftpkl3","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213647-kftpkl3","updated":"20240201213647"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"什么是 CDN ？"}]},{"ID":"20240201213648-7yfe28k","Type":"NodeParagraph","Properties":{"id":"20240201213648-7yfe28k","updated":"20240201213648"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"CDN"},{"Type":"NodeText","Data":" 全称是 Content Delivery Network/Content Distribution Network，翻译过的意思是 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"内容分发网络"},{"Type":"NodeText","Data":" 。"}]},{"ID":"20240201213649-8pk1ckh","Type":"NodeParagraph","Properties":{"id":"20240201213649-8pk1ckh","updated":"20240201213649"},"Children":[{"Type":"NodeText","Data":"我们可以将内容分发网络拆开来看："}]},{"ID":"20240201213650-afivqmj","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213650-afivqmj","updated":"20240201213650"},"Children":[{"ID":"20240201213651-839l5z7","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213651-839l5z7","updated":"20240201213651"},"Children":[{"ID":"20240201213652-hukelwq","Type":"NodeParagraph","Properties":{"id":"20240201213652-hukelwq","updated":"20240201213652"},"Children":[{"Type":"NodeText","Data":"内容：指的是静态资源比如图片、视频、文档、JS、CSS、HTML。"}]}]},{"ID":"20240201213653-ku55s0x","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213653-ku55s0x","updated":"20240201213653"},"Children":[{"ID":"20240201213654-usetis6","Type":"NodeParagraph","Properties":{"id":"20240201213654-usetis6","updated":"20240201213654"},"Children":[{"Type":"NodeText","Data":"分发网络：指的是将这些静态资源分发到位于多个不同的地理位置机房中的服务器上，这样，就可以实现静态资源的就近访问比如北京的用户直接访问北京机房的数据。"}]}]}]},{"ID":"20240201213655-wpg8p6r","Type":"NodeParagraph","Properties":{"id":"20240201213655-wpg8p6r","updated":"20240201213655"},"Children":[{"Type":"NodeText","Data":"所以，简单来说，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"CDN 就是将静态资源分发到多个不同的地方以实现就近访问，进而加快静态资源的访问速度，减轻服务器以及带宽的负担。"}]},{"ID":"20240201213656-zjnotgc","Type":"NodeParagraph","Properties":{"id":"20240201213656-zjnotgc","updated":"20240201213656"},"Children":[{"Type":"NodeText","Data":"类似于京东建立的庞大的仓储运输体系，京东物流在全国拥有非常多的仓库，仓储网络几乎覆盖全国所有区县。这样的话，用户下单的第一时间，商品就从距离用户最近的仓库，直接发往对应的配送站，再由京东小哥送到你家。"}]},{"ID":"20240201213657-9l765ez","Type":"NodeParagraph","Properties":{"id":"20240201213657-9l765ez","updated":"20240201213657"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"京东仓配系统","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/high-performance/cdn/jingdong-wuliu-cangpei.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213658-piprm3b","Type":"NodeParagraph","Properties":{"id":"20240201213658-piprm3b","updated":"20240201213658"},"Children":[{"Type":"NodeText","Data":"你可以将 CDN 看作是服务上一层的特殊缓存服务，分布在全国各地，主要用来处理静态资源的请求。"}]},{"ID":"20240201213659-vdkrwhe","Type":"NodeParagraph","Properties":{"id":"20240201213659-vdkrwhe","updated":"20240201213659"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"CDN 简易示意图","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/high-performance/cdn/cdn-101.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213660-npo1hee","Type":"NodeParagraph","Properties":{"id":"20240201213660-npo1hee","updated":"20240201213660"},"Children":[{"Type":"NodeText","Data":"我们经常拿全站加速和内容分发网络做对比，不要把两者搞混了！全站加速（不同云服务商叫法不同，腾讯云叫 ECDN、阿里云叫 DCDN）既可以加速静态资源又可以加速动态资源，内容分发网络（CDN）主要针对的是 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"静态资源"},{"Type":"NodeText","Data":" 。"}]},{"ID":"20240201213661-muq9hb0","Type":"NodeParagraph","Properties":{"id":"20240201213661-muq9hb0","updated":"20240201213661"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"阿里云文档：https://help.aliyun.com/document_detail/64836.html","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/high-performance/cdn/cdn-aliyun-dcdn.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213662-zrgr6e5","Type":"NodeParagraph","Properties":{"id":"20240201213662-zrgr6e5","updated":"20240201213662"},"Children":[{"Type":"NodeText","Data":"绝大部分公司都会在项目开发中使用 CDN 服务，但很少会有自建 CDN 服务的公司。基于成本、稳定性和易用性考虑，建议直接选择专业的云厂商（比如阿里云、腾讯云、华为云、青云）或者 CDN 厂商（比如网宿、蓝汛）提供的开箱即用的 CDN 服务。"}]},{"ID":"20240201213663-ya85m16","Type":"NodeParagraph","Properties":{"id":"20240201213663-ya85m16","updated":"20240201213663"},"Children":[{"Type":"NodeText","Data":"很多朋友可能要问了："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"既然是就近访问，为什么不直接将服务部署在多个不同的地方呢？"}]},{"ID":"20240201213664-vku0d1w","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213664-vku0d1w","updated":"20240201213664"},"Children":[{"ID":"20240201213665-zbjochd","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213665-zbjochd","updated":"20240201213665"},"Children":[{"ID":"20240201213666-4ah4iu9","Type":"NodeParagraph","Properties":{"id":"20240201213666-4ah4iu9","updated":"20240201213666"},"Children":[{"Type":"NodeText","Data":"成本太高，需要部署多份相同的服务。"}]}]},{"ID":"20240201213667-jhbxjq2","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213667-jhbxjq2","updated":"20240201213667"},"Children":[{"ID":"20240201213668-9d7j3a6","Type":"NodeParagraph","Properties":{"id":"20240201213668-9d7j3a6","updated":"20240201213668"},"Children":[{"Type":"NodeText","Data":"静态资源通常占用空间比较大且经常会被访问到，如果直接使用服务器或者缓存来处理静态资源请求的话，对系统资源消耗非常大，可能会影响到系统其他服务的正常运行。"}]}]}]},{"ID":"20240201213669-01k8fz3","Type":"NodeParagraph","Properties":{"id":"20240201213669-01k8fz3","updated":"20240201213669"},"Children":[{"Type":"NodeText","Data":"同一个服务在在多个不同的地方部署多份（比如同城灾备、异地灾备、同城多活、异地多活）是为了实现系统的高可用而不是就近访问。"}]},{"ID":"20240201213670-r1kmpmn","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213670-r1kmpmn","updated":"20240201213670"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"CDN 工作原理是什么？"}]},{"ID":"20240201213671-5zo7cyx","Type":"NodeParagraph","Properties":{"id":"20240201213671-5zo7cyx","updated":"20240201213671"},"Children":[{"Type":"NodeText","Data":"搞懂下面 3 个问题也就搞懂了 CDN 的工作原理："}]},{"ID":"20240201213672-wex0d0k","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213672-wex0d0k","updated":"20240201213672"},"Children":[{"ID":"20240201213673-c0erypw","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213673-c0erypw","updated":"20240201213673"},"Children":[{"ID":"20240201213674-7iyu09l","Type":"NodeParagraph","Properties":{"id":"20240201213674-7iyu09l","updated":"20240201213674"},"Children":[{"Type":"NodeText","Data":"静态资源是如何被缓存到 CDN 节点中的？"}]}]},{"ID":"20240201213675-9en231u","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20240201213675-9en231u","updated":"20240201213675"},"Children":[{"ID":"20240201213676-kxx7llq","Type":"NodeParagraph","Properties":{"id":"20240201213676-kxx7llq","updated":"20240201213676"},"Children":[{"Type":"NodeText","Data":"如何找到最合适的 CDN 节点？"}]}]},{"ID":"20240201213677-rkd05rq","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20240201213677-rkd05rq","updated":"20240201213677"},"Children":[{"ID":"20240201213678-kg4yanf","Type":"NodeParagraph","Properties":{"id":"20240201213678-kg4yanf","updated":"20240201213678"},"Children":[{"Type":"NodeText","Data":"如何防止静态资源被盗用？"}]}]}]},{"ID":"20240201213679-g4rzmrz","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213679-g4rzmrz","updated":"20240201213679"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"静态资源是如何被缓存到 CDN 节点中的？"}]},{"ID":"20240201213680-nrw2sez","Type":"NodeParagraph","Properties":{"id":"20240201213680-nrw2sez","updated":"20240201213680"},"Children":[{"Type":"NodeText","Data":"你可以通过 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"预热"},{"Type":"NodeText","Data":" 的方式将源站的资源同步到 CDN 的节点中。这样的话，用户首次请求资源可以直接从 CDN 节点中取，无需回源。这样可以降低源站压力，提升用户体验。"}]},{"ID":"20240201213681-w1kj1gr","Type":"NodeParagraph","Properties":{"id":"20240201213681-w1kj1gr","updated":"20240201213681"},"Children":[{"Type":"NodeText","Data":"如果不预热的话，你访问的资源可能不在 CDN 节点中，这个时候 CDN 节点将请求源站获取资源，这个过程是大家经常说的 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"回源"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240201213682-4he8a7o","Type":"NodeBlockquote","Properties":{"id":"20240201213682-4he8a7o","updated":"20240201213682"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240201213683-gtjmti2","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213683-gtjmti2","updated":"20240201213683"},"Children":[{"ID":"20240201213684-4y96kak","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213684-4y96kak","updated":"20240201213684"},"Children":[{"ID":"20240201213685-ux8n11b","Type":"NodeParagraph","Properties":{"id":"20240201213685-ux8n11b","updated":"20240201213685"},"Children":[{"Type":"NodeText","Data":"回源：当 CDN 节点上没有用户请求的资源或该资源的缓存已经过期时，CDN 节点需要从原始服务器获取最新的资源内容，这个过程就是回源。当用户请求发生回源的话，会导致该请求的响应速度比未使用 CDN 还慢，因为相比于未使用 CDN 还多了一层 CDN 的调用流程。"}]}]},{"ID":"20240201213686-gfqxfn9","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213686-gfqxfn9","updated":"20240201213686"},"Children":[{"ID":"20240201213687-fb6xn0u","Type":"NodeParagraph","Properties":{"id":"20240201213687-fb6xn0u","updated":"20240201213687"},"Children":[{"Type":"NodeText","Data":"预热：预热是指在 CDN 上提前将内容缓存到 CDN 节点上。这样当用户在请求这些资源时，能够快速地从最近的 CDN 节点获取到而不需要回源，进而减少了对源站的访问压力，提高了访问速度。"}]}]}]}]},{"ID":"20240201213688-0a820f7","Type":"NodeParagraph","Properties":{"id":"20240201213688-0a820f7","updated":"20240201213688"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"CDN 回源","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/high-performance/cdn/cdn-back-to-source.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213689-abdwwqj","Type":"NodeParagraph","Properties":{"id":"20240201213689-abdwwqj","updated":"20240201213689"},"Children":[{"Type":"NodeText","Data":"如果资源有更新的话，你也可以对其 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"刷新"},{"Type":"NodeText","Data":" ，删除 CDN 节点上缓存的旧资源，并强制 CDN 节点回源站获取最新资源。"}]},{"ID":"20240201213690-cj1nfb7","Type":"NodeParagraph","Properties":{"id":"20240201213690-cj1nfb7","updated":"20240201213690"},"Children":[{"Type":"NodeText","Data":"几乎所有云厂商提供的 CDN 服务都具备缓存的刷新和预热功能（下图是阿里云 CDN 服务提供的相应功能）："}]},{"ID":"20240201213691-bjkjjz6","Type":"NodeParagraph","Properties":{"id":"20240201213691-bjkjjz6","updated":"20240201213691"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"CDN 缓存的刷新和预热","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/high-performance/cdn/cdn-refresh-warm-up.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213692-rsngzua","Type":"NodeParagraph","Properties":{"id":"20240201213692-rsngzua","updated":"20240201213692"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"命中率"},{"Type":"NodeText","Data":" 和 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"回源率"},{"Type":"NodeText","Data":" 是衡量 CDN 服务质量两个重要指标。命中率越高越好，回源率越低越好。"}]},{"ID":"20240201213693-pdtzook","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213693-pdtzook","updated":"20240201213693"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"如何找到最合适的 CDN 节点？"}]},{"ID":"20240201213694-2ziv42x","Type":"NodeParagraph","Properties":{"id":"20240201213694-2ziv42x","updated":"20240201213694"},"Children":[{"Type":"NodeText","Data":"GSLB （Global Server Load Balance，全局负载均衡）是 CDN 的大脑，负责多个 CDN 节点之间相互协作，最常用的是基于 DNS 的 GSLB。"}]},{"ID":"20240201213695-1a0wu58","Type":"NodeParagraph","Properties":{"id":"20240201213695-1a0wu58","updated":"20240201213695"},"Children":[{"Type":"NodeText","Data":"CDN 会通过 GSLB 找到最合适的 CDN 节点，更具体点来说是下面这样的："}]},{"ID":"20240201213696-amisnnd","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213696-amisnnd","updated":"20240201213696"},"Children":[{"ID":"20240201213697-ur9i33p","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213697-ur9i33p","updated":"20240201213697"},"Children":[{"ID":"20240201213698-djmpupz","Type":"NodeParagraph","Properties":{"id":"20240201213698-djmpupz","updated":"20240201213698"},"Children":[{"Type":"NodeText","Data":"浏览器向 DNS 服务器发送域名请求；"}]}]},{"ID":"20240201213699-7esneru","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20240201213699-7esneru","updated":"20240201213699"},"Children":[{"ID":"20240201213700-w6y6d1z","Type":"NodeParagraph","Properties":{"id":"20240201213700-w6y6d1z","updated":"20240201213700"},"Children":[{"Type":"NodeText","Data":"DNS 服务器向根据 CNAME( Canonical Name ) 别名记录向 GSLB 发送请求；"}]}]},{"ID":"20240201213701-iw2g6nb","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20240201213701-iw2g6nb","updated":"20240201213701"},"Children":[{"ID":"20240201213702-vd1tcoi","Type":"NodeParagraph","Properties":{"id":"20240201213702-vd1tcoi","updated":"20240201213702"},"Children":[{"Type":"NodeText","Data":"GSLB 返回性能最好（通常距离请求地址最近）的 CDN 节点（边缘服务器，真正缓存内容的地方）的地址给浏览器；"}]}]},{"ID":"20240201213703-453lhdc","Type":"NodeListItem","Data":"4","ListData":{"Typ":1,"Tight":true,"Start":4,"Delimiter":46,"Padding":3,"Marker":"NA==","Num":4},"Properties":{"id":"20240201213703-453lhdc","updated":"20240201213703"},"Children":[{"ID":"20240201213704-mu1zpa0","Type":"NodeParagraph","Properties":{"id":"20240201213704-mu1zpa0","updated":"20240201213704"},"Children":[{"Type":"NodeText","Data":"浏览器直接访问指定的 CDN 节点。"}]}]}]},{"ID":"20240201213705-2v7yu9e","Type":"NodeParagraph","Properties":{"id":"20240201213705-2v7yu9e","updated":"20240201213705"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"CDN 原理示意图","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/high-performance/cdn/cdn-overview.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213706-xav0c8w","Type":"NodeParagraph","Properties":{"id":"20240201213706-xav0c8w","updated":"20240201213706"},"Children":[{"Type":"NodeText","Data":"为了方便理解，上图其实做了一点简化。GSLB 内部可以看作是 CDN 专用 DNS 服务器和负载均衡系统组合。CDN 专用 DNS 服务器会返回负载均衡系统 IP 地址给浏览器，浏览器使用 IP 地址请求负载均衡系统进而找到对应的 CDN 节点。"}]},{"ID":"20240201213707-pdrwxhh","Type":"NodeParagraph","Properties":{"id":"20240201213707-pdrwxhh","updated":"20240201213707"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"GSLB 是如何选择出最合适的 CDN 节点呢？"},{"Type":"NodeText","Data":" GSLB 会根据请求的 IP 地址、CDN 节点状态（比如负载情况、性能、响应时间、带宽）等指标来综合判断具体返回哪一个 CDN 节点的地址。"}]},{"ID":"20240201213708-1hq9z9e","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213708-1hq9z9e","updated":"20240201213708"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"如何防止资源被盗刷？"}]},{"ID":"20240201213709-wyen0zo","Type":"NodeParagraph","Properties":{"id":"20240201213709-wyen0zo","updated":"20240201213709"},"Children":[{"Type":"NodeText","Data":"如果我们的资源被其他用户或者网站非法盗刷的话，将会是一笔不小的开支。"}]},{"ID":"20240201213710-gxpw8ev","Type":"NodeParagraph","Properties":{"id":"20240201213710-gxpw8ev","updated":"20240201213710"},"Children":[{"Type":"NodeText","Data":"解决这个问题最常用最简单的办法设置 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Referer 防盗链"},{"Type":"NodeText","Data":"，具体来说就是根据 HTTP 请求的头信息里面的 Referer 字段对请求进行限制。我们可以通过 Referer 字段获取到当前请求页面的来源页面的网站地址，这样我们就能确定请求是否来自合法的网站。"}]},{"ID":"20240201213711-939ms7s","Type":"NodeParagraph","Properties":{"id":"20240201213711-939ms7s","updated":"20240201213711"},"Children":[{"Type":"NodeText","Data":"CDN 服务提供商几乎都提供了这种比较基础的防盗链机制。"}]},{"ID":"20240201213712-dx9ut32","Type":"NodeParagraph","Properties":{"id":"20240201213712-dx9ut32","updated":"20240201213712"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"腾讯云 CDN Referer 防盗链配置","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/high-performance/cdn/cnd-tencent-cloud-anti-theft.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213713-ujl0cwh","Type":"NodeParagraph","Properties":{"id":"20240201213713-ujl0cwh","updated":"20240201213713"},"Children":[{"Type":"NodeText","Data":"不过，如果站点的防盗链配置允许 Referer 为空的话，通过隐藏 Referer，可以直接绕开防盗链。"}]},{"ID":"20240201213714-vil330g","Type":"NodeParagraph","Properties":{"id":"20240201213714-vil330g","updated":"20240201213714"},"Children":[{"Type":"NodeText","Data":"通常情况下，我们会配合其他机制来确保静态资源被盗用，一种常用的机制是 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"时间戳防盗链"},{"Type":"NodeText","Data":" 。相比之下，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"时间戳防盗链"},{"Type":"NodeText","Data":" 的安全性更强一些。时间戳防盗链加密的 URL 具有时效性，过期之后就无法再被允许访问。"}]},{"ID":"20240201213715-kms6ulz","Type":"NodeParagraph","Properties":{"id":"20240201213715-kms6ulz","updated":"20240201213715"},"Children":[{"Type":"NodeText","Data":"时间戳防盗链的 URL 通常会有两个参数一个是签名字符串，一个是过期时间。签名字符串一般是通过对用户设定的加密字符串、请求路径、过期时间通过 MD5 哈希算法取哈希的方式获得。"}]},{"ID":"20240201213716-r67a3tm","Type":"NodeParagraph","Properties":{"id":"20240201213716-r67a3tm","updated":"20240201213716"},"Children":[{"Type":"NodeText","Data":"时间戳防盗链 URL 示例："}]},{"ID":"20240201213717-kkjtz7a","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"cGxhaW4=","CodeBlockCloseFence":"YGBg","Properties":{"id":"20240201213717-kkjtz7a","updated":"20240201213717"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cGxhaW4=","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"http://cdn.wangsu.com/4/123.mp3? wsSecret=79aead3bd7b5db4adeffb93a010298b5\u0026wsTime=1601026312\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20240201213718-rp3894o","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213718-rp3894o","updated":"20240201213718"},"Children":[{"ID":"20240201213719-rle58b6","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213719-rle58b6","updated":"20240201213719"},"Children":[{"ID":"20240201213720-6q5h737","Type":"NodeParagraph","Properties":{"id":"20240201213720-6q5h737","updated":"20240201213720"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"wsSecret"},{"Type":"NodeText","Data":"：签名字符串。"}]}]},{"ID":"20240201213721-3cwm49h","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213721-3cwm49h","updated":"20240201213721"},"Children":[{"ID":"20240201213722-a0ntpg7","Type":"NodeParagraph","Properties":{"id":"20240201213722-a0ntpg7","updated":"20240201213722"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"wsTime"},{"Type":"NodeText","Data":": 过期时间。"}]}]}]},{"ID":"20240201213723-9y4s7q4","Type":"NodeParagraph","Properties":{"id":"20240201213723-9y4s7q4","updated":"20240201213723"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/high-performance/cdn/timestamp-anti-theft.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213724-r83qxyt","Type":"NodeParagraph","Properties":{"id":"20240201213724-r83qxyt","updated":"20240201213724"},"Children":[{"Type":"NodeText","Data":"时间戳防盗链的实现也比较简单，并且可靠性较高，推荐使用。并且，绝大部分 CDN 服务提供商都提供了开箱即用的时间戳防盗链机制。"}]},{"ID":"20240201213725-au2blba","Type":"NodeParagraph","Properties":{"id":"20240201213725-au2blba","updated":"20240201213725"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"七牛云时间戳防盗链配置","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/high-performance/cdn/qiniuyun-timestamp-anti-theft.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213726-s0vpzh5","Type":"NodeParagraph","Properties":{"id":"20240201213726-s0vpzh5","updated":"20240201213726"},"Children":[{"Type":"NodeText","Data":"除了 Referer 防盗链和时间戳防盗链之外，你还可以 IP 黑白名单配置、IP 访问限频配置等机制来防盗刷。"}]},{"ID":"20240201213727-0vjm2yi","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213727-0vjm2yi","updated":"20240201213727"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"总结"}]},{"ID":"20240201213728-45w6f8m","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213728-45w6f8m","updated":"20240201213728"},"Children":[{"ID":"20240201213729-o4yl8ex","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213729-o4yl8ex","updated":"20240201213729"},"Children":[{"ID":"20240201213730-euo232w","Type":"NodeParagraph","Properties":{"id":"20240201213730-euo232w","updated":"20240201213730"},"Children":[{"Type":"NodeText","Data":"CDN 就是将静态资源分发到多个不同的地方以实现就近访问，进而加快静态资源的访问速度，减轻服务器以及带宽的负担。"}]}]},{"ID":"20240201213731-11g0so9","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213731-11g0so9","updated":"20240201213731"},"Children":[{"ID":"20240201213732-rh2py56","Type":"NodeParagraph","Properties":{"id":"20240201213732-rh2py56","updated":"20240201213732"},"Children":[{"Type":"NodeText","Data":"基于成本、稳定性和易用性考虑，建议直接选择专业的云厂商（比如阿里云、腾讯云、华为云、青云）或者 CDN 厂商（比如网宿、蓝汛）提供的开箱即用的 CDN 服务。"}]}]},{"ID":"20240201213733-fqf8kt2","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213733-fqf8kt2","updated":"20240201213733"},"Children":[{"ID":"20240201213734-15qnn2x","Type":"NodeParagraph","Properties":{"id":"20240201213734-15qnn2x","updated":"20240201213734"},"Children":[{"Type":"NodeText","Data":"GSLB （Global Server Load Balance，全局负载均衡）是 CDN 的大脑，负责多个 CDN 节点之间相互协作，最常用的是基于 DNS 的 GSLB。CDN 会通过 GSLB 找到最合适的 CDN 节点。"}]}]},{"ID":"20240201213735-grarx28","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213735-grarx28","updated":"20240201213735"},"Children":[{"ID":"20240201213736-kjcsrka","Type":"NodeParagraph","Properties":{"id":"20240201213736-kjcsrka","updated":"20240201213736"},"Children":[{"Type":"NodeText","Data":"为了防止静态资源被盗用，我们可以利用 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Referer 防盗链"},{"Type":"NodeText","Data":" + "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"时间戳防盗链"},{"Type":"NodeText","Data":" 。"}]}]}]},{"ID":"20240201213737-1k21j49","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213737-1k21j49","updated":"20240201213737"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"参考"}]},{"ID":"20240201213738-mqntbyu","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213738-mqntbyu","updated":"20240201213738"},"Children":[{"ID":"20240201213739-7b99usz","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213739-7b99usz","updated":"20240201213739"},"Children":[{"ID":"20240201213740-dr169oa","Type":"NodeParagraph","Properties":{"id":"20240201213740-dr169oa","updated":"20240201213740"},"Children":[{"Type":"NodeText","Data":"时间戳防盗链 - 七牛云 CDN："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://developer.qiniu.com/fusion/kb/1670/timestamp-hotlinking-prevention","TextMarkTextContent":"https://developer.qiniu.com/fusion/kb/1670/timestamp-hotlinking-prevention"}]}]},{"ID":"20240201213741-fd9c9ax","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213741-fd9c9ax","updated":"20240201213741"},"Children":[{"ID":"20240201213742-b3yhe2m","Type":"NodeParagraph","Properties":{"id":"20240201213742-b3yhe2m","updated":"20240201213742"},"Children":[{"Type":"NodeText","Data":"CDN 是个啥玩意？一文说个明白："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://mp.weixin.qq.com/s/Pp0C8ALUXsmYCUkM5QnkQw","TextMarkTextContent":"https://mp.weixin.qq.com/s/Pp0C8ALUXsmYCUkM5QnkQw"}]}]},{"ID":"20240201213743-z91lspb","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213743-z91lspb","updated":"20240201213743"},"Children":[{"ID":"20240201213744-0siiz42","Type":"NodeParagraph","Properties":{"id":"20240201213744-0siiz42","updated":"20240201213744"},"Children":[{"Type":"NodeText","Data":"《透视 HTTP 协议》- 37 | CDN：加速我们的网络服务："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"http://gk.link/a/11yOG","TextMarkTextContent":"http://gk.link/a/11yOG"}]}]}]},{"ID":"20240201213745-cs8at9z","Type":"NodeHTMLBlock","Data":"\u003cdiv\u003e\n\u003c!-- @include: @article-footer.snippet.md --\u003e\n\u003c/div\u003e","HtmlBlockType":2,"Properties":{"id":"20240201213745-cs8at9z","updated":"20240201213745"}}]}