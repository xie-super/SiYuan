{"ID":"20240201213700-iwo3uqt","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240201213700-iwo3uqt","title":"arp","updated":"20240201213700"},"Children":[{"ID":"20240201213701-8y2t1nn","Type":"NodeThematicBreak","Properties":{"id":"20240201213701-8y2t1nn","updated":"20240201213701"}},{"ID":"20240201213702-9qwegoe","Type":"NodeParagraph","Properties":{"id":"20240201213702-9qwegoe","updated":"20240201213702"},"Children":[{"Type":"NodeText","Data":"title: ARP 协议详解(网络层)"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"category: 计算机基础"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"tag:"}]},{"ID":"20240201213703-vb4pvwd","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"MarkerOffset":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213703-vb4pvwd","updated":"20240201213703"},"Children":[{"ID":"20240201213704-jsnh54c","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"MarkerOffset":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213704-jsnh54c","updated":"20240201213704"},"Children":[{"ID":"20240201213705-tbrgey1","Type":"NodeParagraph","Properties":{"id":"20240201213705-tbrgey1","updated":"20240201213705"},"Children":[{"Type":"NodeText","Data":"计算机网络"}]}]}]},{"ID":"20240201213706-23go9g2","Type":"NodeThematicBreak","Properties":{"id":"20240201213706-23go9g2","updated":"20240201213706"}},{"ID":"20240201213707-5g9nw4b","Type":"NodeParagraph","Properties":{"id":"20240201213707-5g9nw4b","updated":"20240201213707"},"Children":[{"Type":"NodeText","Data":"每当我们学习一个新的网络协议的时候，都要把他结合到 OSI 七层模型中，或者是 TCP/IP 协议栈中来学习，一是要学习该协议在整个网络协议栈中的位置，二是要学习该协议解决了什么问题，地位如何？三是要学习该协议的工作原理，以及一些更深入的细节。"}]},{"ID":"20240201213708-9svoydo","Type":"NodeParagraph","Properties":{"id":"20240201213708-9svoydo","updated":"20240201213708"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"ARP 协议"},{"Type":"NodeText","Data":"，可以说是在协议栈中属于一个"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"偏底层的、非常重要的、又非常简单的"},{"Type":"NodeText","Data":"通信协议。"}]},{"ID":"20240201213709-08jcctg","Type":"NodeParagraph","Properties":{"id":"20240201213709-08jcctg","updated":"20240201213709"},"Children":[{"Type":"NodeText","Data":"开始阅读这篇文章之前，你可以先看看下面几个问题："}]},{"ID":"20240201213710-vlk4ms5","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213710-vlk4ms5","updated":"20240201213710"},"Children":[{"ID":"20240201213711-5xkusfc","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213711-5xkusfc","updated":"20240201213711"},"Children":[{"ID":"20240201213712-cgc1bcw","Type":"NodeParagraph","Properties":{"id":"20240201213712-cgc1bcw","updated":"20240201213712"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"ARP 协议在协议栈中的位置？"},{"Type":"NodeText","Data":" ARP 协议在协议栈中的位置非常重要，在理解了它的工作原理之后，也很难说它到底是网络层协议，还是链路层协议，因为它恰恰串联起了网络层和链路层。国外的大部分教程通常将 ARP 协议放在网络层。"}]}]},{"ID":"20240201213713-4hl2vqp","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20240201213713-4hl2vqp","updated":"20240201213713"},"Children":[{"ID":"20240201213714-au4dgoa","Type":"NodeParagraph","Properties":{"id":"20240201213714-au4dgoa","updated":"20240201213714"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"ARP 协议解决了什么问题，地位如何？"},{"Type":"NodeText","Data":" ARP 协议，全称 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"地址解析协议（Address Resolution Protocol）"},{"Type":"NodeText","Data":"，它解决的是网络层地址和链路层地址之间的转换问题。因为一个 IP 数据报在物理上传输的过程中，总是需要知道下一跳（物理上的下一个目的地）该去往何处，但 IP 地址属于逻辑地址，而 MAC 地址才是物理地址，ARP 协议解决了 IP 地址转 MAC 地址的一些问题。"}]}]},{"ID":"20240201213715-7ml2fg6","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20240201213715-7ml2fg6","updated":"20240201213715"},"Children":[{"ID":"20240201213716-vbu2bh9","Type":"NodeParagraph","Properties":{"id":"20240201213716-vbu2bh9","updated":"20240201213716"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"ARP 工作原理？"},{"Type":"NodeText","Data":" 只希望大家记住几个关键词："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"ARP 表、广播问询、单播响应"},{"Type":"NodeText","Data":"。"}]}]}]},{"ID":"20240201213717-w52ldeg","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213717-w52ldeg","updated":"20240201213717"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"MAC 地址"}]},{"ID":"20240201213718-t72g1yk","Type":"NodeParagraph","Properties":{"id":"20240201213718-t72g1yk","updated":"20240201213718"},"Children":[{"Type":"NodeText","Data":"在介绍 ARP 协议之前，有必要介绍一下 MAC 地址。"}]},{"ID":"20240201213719-i49wa3e","Type":"NodeParagraph","Properties":{"id":"20240201213719-i49wa3e","updated":"20240201213719"},"Children":[{"Type":"NodeText","Data":"MAC 地址的全称是 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"媒体访问控制地址（Media Access Control Address）"},{"Type":"NodeText","Data":"。如果说，互联网中每一个资源都由 IP 地址唯一标识（IP 协议内容），那么一切网络设备都由 MAC 地址唯一标识。"}]},{"ID":"20240201213720-m20e2yj","Type":"NodeParagraph","Properties":{"id":"20240201213720-m20e2yj","updated":"20240201213720"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"路由器的背面就会注明 MAC 位址","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/2008410143049281-20240201213826-dmf4jna.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213721-1ux4fru","Type":"NodeParagraph","Properties":{"id":"20240201213721-1ux4fru","updated":"20240201213721"},"Children":[{"Type":"NodeText","Data":"可以理解为，MAC 地址是一个网络设备真正的身份证号，IP 地址只是一种不重复的定位方式（比如说住在某省某市某街道的张三，这种逻辑定位是 IP 地址，他的身份证号才是他的 MAC 地址），也可以理解为 MAC 地址是身份证号，IP 地址是邮政地址。MAC 地址也有一些别称，如 LAN 地址、物理地址、以太网地址等。"}]},{"ID":"20240201213722-u76k00z","Type":"NodeBlockquote","Properties":{"id":"20240201213722-u76k00z","updated":"20240201213722"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240201213723-scunfif","Type":"NodeParagraph","Properties":{"id":"20240201213723-scunfif","updated":"20240201213723"},"Children":[{"Type":"NodeText","Data":"还有一点要知道的是，不仅仅是网络资源才有 IP 地址，网络设备也有 IP 地址，比如路由器。但从结构上说，路由器等网络设备的作用是组成一个网络，而且通常是内网，所以它们使用的 IP 地址通常是内网 IP，内网的设备在与内网以外的设备进行通信时，需要用到 NAT 协议。"}]}]},{"ID":"20240201213724-06yjjbv","Type":"NodeParagraph","Properties":{"id":"20240201213724-06yjjbv","updated":"20240201213724"},"Children":[{"Type":"NodeText","Data":"MAC 地址的长度为 6 字节（48 比特），地址空间大小有 280 万亿之多（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"inline-math","TextMarkInlineMathContent":"2^{48}"},{"Type":"NodeText","Data":"），MAC 地址由 IEEE 统一管理与分配，理论上，一个网络设备中的网卡上的 MAC 地址是永久的。不同的网卡生产商从 IEEE 那里购买自己的 MAC 地址空间（MAC 的前 24 比特），也就是前 24 比特由 IEEE 统一管理，保证不会重复。而后 24 比特，由各家生产商自己管理，同样保证生产的两块网卡的 MAC 地址不会重复。"}]},{"ID":"20240201213725-4b8e6ld","Type":"NodeParagraph","Properties":{"id":"20240201213725-4b8e6ld","updated":"20240201213725"},"Children":[{"Type":"NodeText","Data":"MAC 地址具有可携带性、永久性，身份证号永久地标识一个人的身份，不论他到哪里都不会改变。而 IP 地址不具有这些性质，当一台设备更换了网络，它的 IP 地址也就可能发生改变，也就是它在互联网中的定位发生了变化。"}]},{"ID":"20240201213726-2hz2vrq","Type":"NodeParagraph","Properties":{"id":"20240201213726-2hz2vrq","updated":"20240201213726"},"Children":[{"Type":"NodeText","Data":"最后，记住，MAC 地址有一个特殊地址：FF-FF-FF-FF-FF-FF（全 1 地址），该地址表示广播地址。"}]},{"ID":"20240201213727-diur1du","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213727-diur1du","updated":"20240201213727"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"ARP 协议工作原理"}]},{"ID":"20240201213728-hikim3n","Type":"NodeParagraph","Properties":{"id":"20240201213728-hikim3n","updated":"20240201213728"},"Children":[{"Type":"NodeText","Data":"ARP 协议工作时有一个大前提，那就是 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"ARP 表"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240201213729-eurdfpg","Type":"NodeParagraph","Properties":{"id":"20240201213729-eurdfpg","updated":"20240201213729"},"Children":[{"Type":"NodeText","Data":"在一个局域网内，每个网络设备都自己维护了一个 ARP 表，ARP 表记录了某些其他网络设备的 IP 地址-MAC 地址映射关系，该映射关系以 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"\u0026lt;IP, MAC, TTL\u0026gt;"},{"Type":"NodeText","Data":" 三元组的形式存储。其中，TTL 为该映射关系的生存周期，典型值为 20 分钟，超过该时间，该条目将被丢弃。"}]},{"ID":"20240201213730-kd687gy","Type":"NodeParagraph","Properties":{"id":"20240201213730-kd687gy","updated":"20240201213730"},"Children":[{"Type":"NodeText","Data":"ARP 的工作原理将分两种场景讨论："}]},{"ID":"20240201213731-4skkeok","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213731-4skkeok","updated":"20240201213731"},"Children":[{"ID":"20240201213732-3t3slh0","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213732-3t3slh0","updated":"20240201213732"},"Children":[{"ID":"20240201213733-mibsnz3","Type":"NodeParagraph","Properties":{"id":"20240201213733-mibsnz3","updated":"20240201213733"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"同一局域网内的 MAC 寻址"},{"Type":"NodeText","Data":"；"}]}]},{"ID":"20240201213734-os4c2sl","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20240201213734-os4c2sl","updated":"20240201213734"},"Children":[{"ID":"20240201213735-mbgdx9n","Type":"NodeParagraph","Properties":{"id":"20240201213735-mbgdx9n","updated":"20240201213735"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"从一个局域网到另一个局域网中的网络设备的寻址"},{"Type":"NodeText","Data":"。"}]}]}]},{"ID":"20240201213736-gpfazdl","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213736-gpfazdl","updated":"20240201213736"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"同一局域网内的 MAC 寻址"}]},{"ID":"20240201213737-806l6wx","Type":"NodeParagraph","Properties":{"id":"20240201213737-806l6wx","updated":"20240201213737"},"Children":[{"Type":"NodeText","Data":"假设当前有如下场景：IP 地址为"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"137.196.7.23"},{"Type":"NodeText","Data":"的主机 A，想要给同一局域网内的 IP 地址为"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"137.196.7.14"},{"Type":"NodeText","Data":"主机 B，发送 IP 数据报文。"}]},{"ID":"20240201213738-ktctwuc","Type":"NodeBlockquote","Properties":{"id":"20240201213738-ktctwuc","updated":"20240201213738"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240201213739-ylzwlaa","Type":"NodeParagraph","Properties":{"id":"20240201213739-ylzwlaa","updated":"20240201213739"},"Children":[{"Type":"NodeText","Data":"再次强调，当主机发送 IP 数据报文时（网络层），仅知道目的地的 IP 地址，并不清楚目的地的 MAC 地址，而 ARP 协议就是解决这一问题的。"}]}]},{"ID":"20240201213740-lyc0wqm","Type":"NodeParagraph","Properties":{"id":"20240201213740-lyc0wqm","updated":"20240201213740"},"Children":[{"Type":"NodeText","Data":"为了达成这一目标，主机 A 将不得不通过 ARP 协议来获取主机 B 的 MAC 地址，并将 IP 报文封装成链路层帧，发送到下一跳上。在该局域网内，关于此将按照时间顺序，依次发生如下事件："}]},{"ID":"20240201213741-wltnmbt","Type":"NodeList","ListData":{"Typ":1,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213741-wltnmbt","updated":"20240201213741"},"Children":[{"ID":"20240201213742-kguv0tc","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213742-kguv0tc","updated":"20240201213742"},"Children":[{"ID":"20240201213743-w7ds7dq","Type":"NodeParagraph","Properties":{"id":"20240201213743-w7ds7dq","updated":"20240201213743"},"Children":[{"Type":"NodeText","Data":"主机 A 检索自己的 ARP 表，发现 ARP 表中并无主机 B 的 IP 地址对应的映射条目，也就无从知道主机 B 的 MAC 地址。"}]}]},{"ID":"20240201213744-g3padl6","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20240201213744-g3padl6","updated":"20240201213744"},"Children":[{"ID":"20240201213745-bvrxio6","Type":"NodeParagraph","Properties":{"id":"20240201213745-bvrxio6","updated":"20240201213745"},"Children":[{"Type":"NodeText","Data":"主机 A 将构造一个 ARP 查询分组，并将其广播到所在的局域网中。"}]},{"ID":"20240201213746-takwqbh","Type":"NodeParagraph","Properties":{"id":"20240201213746-takwqbh","updated":"20240201213746"},"Children":[{"Type":"NodeText","Data":"ARP 分组是一种特殊报文，ARP 分组有两类，一种是查询分组，另一种是响应分组，它们具有相同的格式，均包含了发送和接收的 IP 地址、发送和接收的 MAC 地址。当然了，查询分组中，发送的 IP 地址，即为主机 A 的 IP 地址，接收的 IP 地址即为主机 B 的 IP 地址，发送的 MAC 地址也是主机 A 的 MAC 地址，但接收的 MAC 地址绝不会是主机 B 的 MAC 地址（因为这正是我们要问询的！），而是一个特殊值——"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"FF-FF-FF-FF-FF-FF"},{"Type":"NodeText","Data":"，之前说过，该 MAC 地址是广播地址，也就是说，查询分组将广播给该局域网内的所有设备。"}]}]},{"ID":"20240201213747-dan31ar","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20240201213747-dan31ar","updated":"20240201213747"},"Children":[{"ID":"20240201213748-q8otqs7","Type":"NodeParagraph","Properties":{"id":"20240201213748-q8otqs7","updated":"20240201213748"},"Children":[{"Type":"NodeText","Data":"主机 A 构造的查询分组将在该局域网内广播，理论上，每一个设备都会收到该分组，并检查查询分组的接收 IP 地址是否为自己的 IP 地址，如果是，说明查询分组已经到达了主机 B，否则，该查询分组对当前设备无效，丢弃之。"}]}]},{"ID":"20240201213749-029gc1m","Type":"NodeListItem","Data":"4","ListData":{"Typ":1,"Tight":true,"Start":4,"Delimiter":46,"Padding":3,"Marker":"NA==","Num":4},"Properties":{"id":"20240201213749-029gc1m","updated":"20240201213749"},"Children":[{"ID":"20240201213750-0p27dhp","Type":"NodeParagraph","Properties":{"id":"20240201213750-0p27dhp","updated":"20240201213750"},"Children":[{"Type":"NodeText","Data":"主机 B 收到了查询分组之后，验证是对自己的问询，接着构造一个 ARP 响应分组，该分组的目的地只有一个——主机 A，发送给主机 A。同时，主机 B 提取查询分组中的 IP 地址和 MAC 地址信息，在自己的 ARP 表中构造一条主机 A 的 IP-MAC 映射记录。"}]},{"ID":"20240201213751-s08lgoe","Type":"NodeParagraph","Properties":{"id":"20240201213751-s08lgoe","updated":"20240201213751"},"Children":[{"Type":"NodeText","Data":"ARP 响应分组具有和 ARP 查询分组相同的构造，不同的是，发送和接受的 IP 地址恰恰相反，发送的 MAC 地址为发送者本身，目标 MAC 地址为查询分组的发送者，也就是说，ARP 响应分组只有一个目的地，而非广播。"}]}]},{"ID":"20240201213752-jukw0m7","Type":"NodeListItem","Data":"5","ListData":{"Typ":1,"Tight":true,"Start":5,"Delimiter":46,"Padding":3,"Marker":"NQ==","Num":5},"Properties":{"id":"20240201213752-jukw0m7","updated":"20240201213752"},"Children":[{"ID":"20240201213753-vuig6nb","Type":"NodeParagraph","Properties":{"id":"20240201213753-vuig6nb","updated":"20240201213753"},"Children":[{"Type":"NodeText","Data":"主机 A 终将收到主机 B 的响应分组，提取出该分组中的 IP 地址和 MAC 地址后，构造映射信息，加入到自己的 ARP 表中。"}]}]}]},{"ID":"20240201213754-5wr6uv7","Type":"NodeParagraph","Properties":{"id":"20240201213754-5wr6uv7","updated":"20240201213754"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/arp_same_lan-20240201213826-8o40e78.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213755-c79cgos","Type":"NodeParagraph","Properties":{"id":"20240201213755-c79cgos","updated":"20240201213755"},"Children":[{"Type":"NodeText","Data":"在整个过程中，有几点需要补充说明的是："}]},{"ID":"20240201213756-983gqgl","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213756-983gqgl","updated":"20240201213756"},"Children":[{"ID":"20240201213757-wa587jc","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213757-wa587jc","updated":"20240201213757"},"Children":[{"ID":"20240201213758-13iun5s","Type":"NodeParagraph","Properties":{"id":"20240201213758-13iun5s","updated":"20240201213758"},"Children":[{"Type":"NodeText","Data":"主机 A 想要给主机 B 发送 IP 数据报，如果主机 B 的 IP-MAC 映射信息已经存在于主机 A 的 ARP 表中，那么主机 A 无需广播，只需提取 MAC 地址并构造链路层帧发送即可。"}]}]},{"ID":"20240201213759-bq9mw4s","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20240201213759-bq9mw4s","updated":"20240201213759"},"Children":[{"ID":"20240201213760-8c0f087","Type":"NodeParagraph","Properties":{"id":"20240201213760-8c0f087","updated":"20240201213760"},"Children":[{"Type":"NodeText","Data":"ARP 表中的映射信息是有生存周期的，典型值为 20 分钟。"}]}]},{"ID":"20240201213761-80c71k3","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20240201213761-80c71k3","updated":"20240201213761"},"Children":[{"ID":"20240201213762-8ryu7uk","Type":"NodeParagraph","Properties":{"id":"20240201213762-8ryu7uk","updated":"20240201213762"},"Children":[{"Type":"NodeText","Data":"目标主机接收到了问询主机构造的问询报文后，将先把问询主机的 IP-MAC 映射存进自己的 ARP 表中，这样才能获取到响应的目标 MAC 地址，顺利的发送响应分组。"}]}]}]},{"ID":"20240201213763-1nhw352","Type":"NodeParagraph","Properties":{"id":"20240201213763-1nhw352","updated":"20240201213763"},"Children":[{"Type":"NodeText","Data":"总结来说，ARP 协议是一个"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"广播问询，单播响应"},{"Type":"NodeText","Data":"协议。"}]},{"ID":"20240201213764-15grlae","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213764-15grlae","updated":"20240201213764"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"不同局域网内的 MAC 寻址"}]},{"ID":"20240201213765-uqqr0zx","Type":"NodeParagraph","Properties":{"id":"20240201213765-uqqr0zx","updated":"20240201213765"},"Children":[{"Type":"NodeText","Data":"更复杂的情况是，发送主机 A 和接收主机 B 不在同一个子网中，假设一个一般场景，两台主机所在的子网由一台路由器联通。这里需要注意的是，一般情况下，我们说网络设备都有一个 IP 地址和一个 MAC 地址，这里说的网络设备，更严谨的说法应该是一个接口。路由器作为互联设备，具有多个接口，每个接口同样也应该具备不重复的 IP 地址和 MAC 地址。因此，在讨论 ARP 表时，路由器的多个接口都各自维护一个 ARP 表，而非一个路由器只维护一个 ARP 表。"}]},{"ID":"20240201213766-t1lpam6","Type":"NodeParagraph","Properties":{"id":"20240201213766-t1lpam6","updated":"20240201213766"},"Children":[{"Type":"NodeText","Data":"接下来，回顾同一子网内的 MAC 寻址，如果主机 A 发送一个广播问询分组，那么 A 所在的子网内所有设备（接口）都将会捕获该分组，因为该分组的目的 IP 与发送主机 A 的 IP 在同一个子网中。但是当目的 IP 与 A 不在同一子网时，A 所在子网内将不会有设备成功接收该分组。那么，主机 A 应该发送怎样的查询分组呢？整个过程按照时间顺序发生的事件如下："}]},{"ID":"20240201213767-fztvxp4","Type":"NodeList","ListData":{"Typ":1,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213767-fztvxp4","updated":"20240201213767"},"Children":[{"ID":"20240201213768-uroet6b","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213768-uroet6b","updated":"20240201213768"},"Children":[{"ID":"20240201213769-1bu06yb","Type":"NodeParagraph","Properties":{"id":"20240201213769-1bu06yb","updated":"20240201213769"},"Children":[{"Type":"NodeText","Data":"主机 A 查询 ARP 表，期望寻找到目标路由器的本子网接口的 MAC 地址。"}]},{"ID":"20240201213770-m95ojla","Type":"NodeParagraph","Properties":{"id":"20240201213770-m95ojla","updated":"20240201213770"},"Children":[{"Type":"NodeText","Data":"目标路由器指的是，根据目的主机 B 的 IP 地址，分析出 B 所在的子网，能够把报文转发到 B 所在子网的那个路由器。"}]}]},{"ID":"20240201213771-xigi3ph","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20240201213771-xigi3ph","updated":"20240201213771"},"Children":[{"ID":"20240201213772-rusxofx","Type":"NodeParagraph","Properties":{"id":"20240201213772-rusxofx","updated":"20240201213772"},"Children":[{"Type":"NodeText","Data":"主机 A 未能找到目标路由器的本子网接口的 MAC 地址，将采用 ARP 协议，问询到该 MAC 地址，由于目标接口与主机 A 在同一个子网内，该过程与同一局域网内的 MAC 寻址相同。"}]}]},{"ID":"20240201213773-j725hl1","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20240201213773-j725hl1","updated":"20240201213773"},"Children":[{"ID":"20240201213774-euqa6hs","Type":"NodeParagraph","Properties":{"id":"20240201213774-euqa6hs","updated":"20240201213774"},"Children":[{"Type":"NodeText","Data":"主机 A 获取到目标接口的 MAC 地址，先构造 IP 数据报，其中源 IP 是 A 的 IP 地址，目的 IP 地址是 B 的 IP 地址，再构造链路层帧，其中源 MAC 地址是 A 的 MAC 地址，目的 MAC 地址是"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"本子网内与路由器连接的接口的 MAC 地址"},{"Type":"NodeText","Data":"。主机 A 将把这个链路层帧，以单播的方式，发送给目标接口。"}]}]},{"ID":"20240201213775-lkapa7d","Type":"NodeListItem","Data":"4","ListData":{"Typ":1,"Tight":true,"Start":4,"Delimiter":46,"Padding":3,"Marker":"NA==","Num":4},"Properties":{"id":"20240201213775-lkapa7d","updated":"20240201213775"},"Children":[{"ID":"20240201213776-jbqaewq","Type":"NodeParagraph","Properties":{"id":"20240201213776-jbqaewq","updated":"20240201213776"},"Children":[{"Type":"NodeText","Data":"目标接口接收到了主机 A 发过来的链路层帧，解析，根据目的 IP 地址，查询转发表，将该 IP 数据报转发到与主机 B 所在子网相连的接口上。"}]},{"ID":"20240201213777-y9ykrce","Type":"NodeParagraph","Properties":{"id":"20240201213777-y9ykrce","updated":"20240201213777"},"Children":[{"Type":"NodeText","Data":"到此，该帧已经从主机 A 所在的子网，转移到了主机 B 所在的子网了。"}]}]},{"ID":"20240201213778-c3z0v6p","Type":"NodeListItem","Data":"5","ListData":{"Typ":1,"Tight":true,"Start":5,"Delimiter":46,"Padding":3,"Marker":"NQ==","Num":5},"Properties":{"id":"20240201213778-c3z0v6p","updated":"20240201213778"},"Children":[{"ID":"20240201213779-qtm49g1","Type":"NodeParagraph","Properties":{"id":"20240201213779-qtm49g1","updated":"20240201213779"},"Children":[{"Type":"NodeText","Data":"路由器接口查询 ARP 表，期望寻找到主机 B 的 MAC 地址。"}]}]},{"ID":"20240201213780-wd2gvmx","Type":"NodeListItem","Data":"6","ListData":{"Typ":1,"Tight":true,"Start":6,"Delimiter":46,"Padding":3,"Marker":"Ng==","Num":6},"Properties":{"id":"20240201213780-wd2gvmx","updated":"20240201213780"},"Children":[{"ID":"20240201213781-2puhgv6","Type":"NodeParagraph","Properties":{"id":"20240201213781-2puhgv6","updated":"20240201213781"},"Children":[{"Type":"NodeText","Data":"路由器接口如未能找到主机 B 的 MAC 地址，将采用 ARP 协议，广播问询，单播响应，获取到主机 B 的 MAC 地址。"}]}]},{"ID":"20240201213782-mcs2byx","Type":"NodeListItem","Data":"7","ListData":{"Typ":1,"Tight":true,"Start":7,"Delimiter":46,"Padding":3,"Marker":"Nw==","Num":7},"Properties":{"id":"20240201213782-mcs2byx","updated":"20240201213782"},"Children":[{"ID":"20240201213783-t7rro4j","Type":"NodeParagraph","Properties":{"id":"20240201213783-t7rro4j","updated":"20240201213783"},"Children":[{"Type":"NodeText","Data":"路由器接口将对 IP 数据报重新封装成链路层帧，目标 MAC 地址为主机 B 的 MAC 地址，单播发送，直到目的地。"}]}]}]},{"ID":"20240201213784-w6hqj3l","Type":"NodeParagraph","Properties":{"id":"20240201213784-w6hqj3l","updated":"20240201213784"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/arp_different_lan-20240201213826-hvnasf1.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213785-40pu5yi","Type":"NodeHTMLBlock","Data":"\u003cdiv\u003e\n\u003c!-- @include: @article-footer.snippet.md --\u003e\n\u003c/div\u003e","HtmlBlockType":2,"Properties":{"id":"20240201213785-40pu5yi","updated":"20240201213785"}}]}