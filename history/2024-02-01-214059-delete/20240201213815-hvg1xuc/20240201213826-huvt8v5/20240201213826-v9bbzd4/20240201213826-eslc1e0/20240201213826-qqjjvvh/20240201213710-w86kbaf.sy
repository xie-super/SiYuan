{"ID":"20240201213710-w86kbaf","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240201213710-w86kbaf","title":"tcp-connection-and-disconnection","updated":"20240201213710"},"Children":[{"ID":"20240201213711-h6mz20b","Type":"NodeThematicBreak","Properties":{"id":"20240201213711-h6mz20b","updated":"20240201213711"}},{"ID":"20240201213712-4kzabax","Type":"NodeParagraph","Properties":{"id":"20240201213712-4kzabax","updated":"20240201213712"},"Children":[{"Type":"NodeText","Data":"title: TCP 三次握手和四次挥手（传输层）"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"category: 计算机基础"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"tag:"}]},{"ID":"20240201213713-qom2swg","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"MarkerOffset":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213713-qom2swg","updated":"20240201213713"},"Children":[{"ID":"20240201213714-86znsjo","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"MarkerOffset":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213714-86znsjo","updated":"20240201213714"},"Children":[{"ID":"20240201213715-19p2yvt","Type":"NodeParagraph","Properties":{"id":"20240201213715-19p2yvt","updated":"20240201213715"},"Children":[{"Type":"NodeText","Data":"计算机网络"}]}]}]},{"ID":"20240201213716-2yhyo54","Type":"NodeThematicBreak","Properties":{"id":"20240201213716-2yhyo54","updated":"20240201213716"}},{"ID":"20240201213717-71ein0h","Type":"NodeParagraph","Properties":{"id":"20240201213717-71ein0h","updated":"20240201213717"},"Children":[{"Type":"NodeText","Data":"为了准确无误地把数据送达目标处，TCP 协议采用了三次握手策略。"}]},{"ID":"20240201213718-i0jrwa3","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213718-i0jrwa3","updated":"20240201213718"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"建立连接-TCP 三次握手"}]},{"ID":"20240201213719-qcvl70n","Type":"NodeParagraph","Properties":{"id":"20240201213719-qcvl70n","updated":"20240201213719"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"TCP 三次握手图解","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/cs-basics/network/tcp-shakes-hands-three-times.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213720-gs5bw43","Type":"NodeParagraph","Properties":{"id":"20240201213720-gs5bw43","updated":"20240201213720"},"Children":[{"Type":"NodeText","Data":"建立一个 TCP 连接需要“三次握手”，缺一不可："}]},{"ID":"20240201213721-pcy0czx","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213721-pcy0czx","updated":"20240201213721"},"Children":[{"ID":"20240201213722-gkk11ty","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213722-gkk11ty","updated":"20240201213722"},"Children":[{"ID":"20240201213723-s44sac7","Type":"NodeParagraph","Properties":{"id":"20240201213723-s44sac7","updated":"20240201213723"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"一次握手"},{"Type":"NodeText","Data":":客户端发送带有 SYN（SEQ=x） 标志的数据包 -\u003e 服务端，然后客户端进入 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"SYN_SEND"},{"Type":"NodeText","Data":" 状态，等待服务器的确认；"}]}]},{"ID":"20240201213724-idx7plt","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213724-idx7plt","updated":"20240201213724"},"Children":[{"ID":"20240201213725-jk2vw18","Type":"NodeParagraph","Properties":{"id":"20240201213725-jk2vw18","updated":"20240201213725"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"二次握手"},{"Type":"NodeText","Data":":服务端发送带有 SYN+ACK(SEQ=y,ACK=x+1) 标志的数据包 –\u003e 客户端,然后服务端进入 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"SYN_RECV"},{"Type":"NodeText","Data":" 状态"}]}]},{"ID":"20240201213726-6msjgwp","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213726-6msjgwp","updated":"20240201213726"},"Children":[{"ID":"20240201213727-99tm0sp","Type":"NodeParagraph","Properties":{"id":"20240201213727-99tm0sp","updated":"20240201213727"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"三次握手"},{"Type":"NodeText","Data":":客户端发送带有 ACK(ACK=y+1) 标志的数据包 –\u003e 服务端，然后客户端和服务器端都进入"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"ESTABLISHED"},{"Type":"NodeText","Data":" 状态，完成 TCP 三次握手。"}]}]}]},{"ID":"20240201213728-tvq1nzz","Type":"NodeParagraph","Properties":{"id":"20240201213728-tvq1nzz","updated":"20240201213728"},"Children":[{"Type":"NodeText","Data":"当建立了 3 次握手之后，客户端和服务端就可以传输数据啦！"}]},{"ID":"20240201213729-lxcwgf3","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213729-lxcwgf3","updated":"20240201213729"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"为什么要三次握手?"}]},{"ID":"20240201213730-lrk5kp3","Type":"NodeParagraph","Properties":{"id":"20240201213730-lrk5kp3","updated":"20240201213730"},"Children":[{"Type":"NodeText","Data":"三次握手的目的是建立可靠的通信信道，说到通讯，简单来说就是数据的发送与接收，而三次握手最主要的目的就是双方确认自己与对方的发送与接收是正常的。"}]},{"ID":"20240201213731-atg1ejg","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213731-atg1ejg","updated":"20240201213731"},"Children":[{"ID":"20240201213732-ezxeuzh","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213732-ezxeuzh","updated":"20240201213732"},"Children":[{"ID":"20240201213733-dlapgqp","Type":"NodeParagraph","Properties":{"id":"20240201213733-dlapgqp","updated":"20240201213733"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第一次握手"},{"Type":"NodeText","Data":"：Client 什么都不能确认；Server 确认了对方发送正常，自己接收正常"}]}]},{"ID":"20240201213734-1peyp52","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20240201213734-1peyp52","updated":"20240201213734"},"Children":[{"ID":"20240201213735-ydosotx","Type":"NodeParagraph","Properties":{"id":"20240201213735-ydosotx","updated":"20240201213735"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第二次握手"},{"Type":"NodeText","Data":"：Client 确认了：自己发送、接收正常，对方发送、接收正常；Server 确认了：对方发送正常，自己接收正常"}]}]},{"ID":"20240201213736-wdkj7t5","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20240201213736-wdkj7t5","updated":"20240201213736"},"Children":[{"ID":"20240201213737-r0efstt","Type":"NodeParagraph","Properties":{"id":"20240201213737-r0efstt","updated":"20240201213737"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第三次握手"},{"Type":"NodeText","Data":"：Client 确认了：自己发送、接收正常，对方发送、接收正常；Server 确认了：自己发送、接收正常，对方发送、接收正常"}]}]}]},{"ID":"20240201213738-gx9ijit","Type":"NodeParagraph","Properties":{"id":"20240201213738-gx9ijit","updated":"20240201213738"},"Children":[{"Type":"NodeText","Data":"三次握手就能确认双方收发功能都正常，缺一不可。"}]},{"ID":"20240201213739-0ek2953","Type":"NodeParagraph","Properties":{"id":"20240201213739-0ek2953","updated":"20240201213739"},"Children":[{"Type":"NodeText","Data":"更详细的解答可以看这个："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://www.zhihu.com/question/24853633/answer/115173386","TextMarkTextContent":"TCP 为什么是三次握手，而不是两次或四次？ - 车小胖的回答 - 知乎"},{"Type":"NodeText","Data":" 。"}]},{"ID":"20240201213740-zp1rmae","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213740-zp1rmae","updated":"20240201213740"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"第 2 次握手传回了 ACK，为什么还要传回 SYN？"}]},{"ID":"20240201213741-wjao98q","Type":"NodeParagraph","Properties":{"id":"20240201213741-wjao98q","updated":"20240201213741"},"Children":[{"Type":"NodeText","Data":"服务端传回发送端所发送的 ACK 是为了告诉客户端：“我接收到的信息确实就是你所发送的信号了”，这表明从客户端到服务端的通信是正常的。回传 SYN 则是为了建立并确认从服务端到客户端的通信。"}]},{"ID":"20240201213742-g9y6fnt","Type":"NodeBlockquote","Properties":{"id":"20240201213742-g9y6fnt","updated":"20240201213742"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240201213743-x05qf50","Type":"NodeParagraph","Properties":{"id":"20240201213743-x05qf50","updated":"20240201213743"},"Children":[{"Type":"NodeText","Data":"SYN 同步序列编号(Synchronize Sequence Numbers) 是 TCP/IP 建立连接时使用的握手信号。在客户机和服务器之间建立正常的 TCP 网络连接时，客户机首先发出一个 SYN 消息，服务器使用 SYN-ACK 应答表示接收到了这个消息，最后客户机再以 ACK(Acknowledgement）消息响应。这样在客户机和服务器之间才能建立起可靠的 TCP 连接，数据才可以在客户机和服务器之间传递。"}]}]},{"ID":"20240201213744-g01blcu","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213744-g01blcu","updated":"20240201213744"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"断开连接-TCP 四次挥手"}]},{"ID":"20240201213745-tpihis4","Type":"NodeParagraph","Properties":{"id":"20240201213745-tpihis4","updated":"20240201213745"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"TCP 四次挥手图解","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/cs-basics/network/tcp-waves-four-times.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213746-jtyj0a9","Type":"NodeParagraph","Properties":{"id":"20240201213746-jtyj0a9","updated":"20240201213746"},"Children":[{"Type":"NodeText","Data":"断开一个 TCP 连接则需要“四次挥手”，缺一不可："}]},{"ID":"20240201213747-fs4zez1","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213747-fs4zez1","updated":"20240201213747"},"Children":[{"ID":"20240201213748-uue7ww4","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213748-uue7ww4","updated":"20240201213748"},"Children":[{"ID":"20240201213749-hr10aje","Type":"NodeParagraph","Properties":{"id":"20240201213749-hr10aje","updated":"20240201213749"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第一次挥手"},{"Type":"NodeText","Data":"：客户端发送一个 FIN（SEQ=x） 标志的数据包-\u003e服务端，用来关闭客户端到服务器的数据传送。然后客户端进入 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"FIN-WAIT-1"},{"Type":"NodeText","Data":" 状态。"}]}]},{"ID":"20240201213750-cbecb9h","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20240201213750-cbecb9h","updated":"20240201213750"},"Children":[{"ID":"20240201213751-550743i","Type":"NodeParagraph","Properties":{"id":"20240201213751-550743i","updated":"20240201213751"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第二次挥手"},{"Type":"NodeText","Data":"：服务器收到这个 FIN（SEQ=X） 标志的数据包，它发送一个 ACK （ACK=x+1）标志的数据包-\u003e客户端 。然后服务端进入 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"CLOSE-WAIT"},{"Type":"NodeText","Data":" 状态，客户端进入 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"FIN-WAIT-2"},{"Type":"NodeText","Data":" 状态。"}]}]},{"ID":"20240201213752-9i8mksa","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20240201213752-9i8mksa","updated":"20240201213752"},"Children":[{"ID":"20240201213753-sglbutk","Type":"NodeParagraph","Properties":{"id":"20240201213753-sglbutk","updated":"20240201213753"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第三次挥手"},{"Type":"NodeText","Data":"：服务端发送一个 FIN (SEQ=y)标志的数据包-\u003e客户端，请求关闭连接，然后服务端进入 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"LAST-ACK"},{"Type":"NodeText","Data":" 状态。"}]}]},{"ID":"20240201213754-zcuhziu","Type":"NodeListItem","Data":"4","ListData":{"Typ":1,"Tight":true,"Start":4,"Delimiter":46,"Padding":3,"Marker":"NA==","Num":4},"Properties":{"id":"20240201213754-zcuhziu","updated":"20240201213754"},"Children":[{"ID":"20240201213755-2gr2dxe","Type":"NodeParagraph","Properties":{"id":"20240201213755-2gr2dxe","updated":"20240201213755"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第四次挥手"},{"Type":"NodeText","Data":"：客户端发送 ACK (ACK=y+1)标志的数据包-\u003e服务端，然后客户端进入"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"TIME-WAIT"},{"Type":"NodeText","Data":"状态，服务端在收到 ACK (ACK=y+1)标志的数据包后进入 CLOSE 状态。此时如果客户端等待 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"2MSL"},{"Type":"NodeText","Data":" 后依然没有收到回复，就证明服务端已正常关闭，随后客户端也可以关闭连接了。"}]}]}]},{"ID":"20240201213756-0dvsc2d","Type":"NodeParagraph","Properties":{"id":"20240201213756-0dvsc2d","updated":"20240201213756"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"只要四次挥手没有结束，客户端和服务端就可以继续传输数据！"}]},{"ID":"20240201213757-p5hi8yn","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213757-p5hi8yn","updated":"20240201213757"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"为什么要四次挥手？"}]},{"ID":"20240201213758-evvwkw3","Type":"NodeParagraph","Properties":{"id":"20240201213758-evvwkw3","updated":"20240201213758"},"Children":[{"Type":"NodeText","Data":"TCP 是全双工通信，可以双向传输数据。任何一方都可以在数据传送结束后发出连接释放的通知，待对方确认后进入半关闭状态。当另一方也没有数据再发送的时候，则发出连接释放通知，对方确认后就完全关闭了 TCP 连接。"}]},{"ID":"20240201213759-o11jnwx","Type":"NodeParagraph","Properties":{"id":"20240201213759-o11jnwx","updated":"20240201213759"},"Children":[{"Type":"NodeText","Data":"举个例子：A 和 B 打电话，通话即将结束后。"}]},{"ID":"20240201213760-t1uqqgx","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213760-t1uqqgx","updated":"20240201213760"},"Children":[{"ID":"20240201213761-42e7lft","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213761-42e7lft","updated":"20240201213761"},"Children":[{"ID":"20240201213762-7575t84","Type":"NodeParagraph","Properties":{"id":"20240201213762-7575t84","updated":"20240201213762"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第一次挥手"},{"Type":"NodeText","Data":"：A 说“我没啥要说的了”"}]}]},{"ID":"20240201213763-6u8w4kc","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20240201213763-6u8w4kc","updated":"20240201213763"},"Children":[{"ID":"20240201213764-s78jj9n","Type":"NodeParagraph","Properties":{"id":"20240201213764-s78jj9n","updated":"20240201213764"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第二次挥手"},{"Type":"NodeText","Data":"：B 回答“我知道了”，但是 B 可能还会有要说的话，A 不能要求 B 跟着自己的节奏结束通话"}]}]},{"ID":"20240201213765-wi43f08","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20240201213765-wi43f08","updated":"20240201213765"},"Children":[{"ID":"20240201213766-3f9yxxr","Type":"NodeParagraph","Properties":{"id":"20240201213766-3f9yxxr","updated":"20240201213766"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第三次挥手"},{"Type":"NodeText","Data":"：于是 B 可能又巴拉巴拉说了一通，最后 B 说“我说完了”"}]}]},{"ID":"20240201213767-fgpmagt","Type":"NodeListItem","Data":"4","ListData":{"Typ":1,"Tight":true,"Start":4,"Delimiter":46,"Padding":3,"Marker":"NA==","Num":4},"Properties":{"id":"20240201213767-fgpmagt","updated":"20240201213767"},"Children":[{"ID":"20240201213768-xmknsyh","Type":"NodeParagraph","Properties":{"id":"20240201213768-xmknsyh","updated":"20240201213768"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第四次挥手"},{"Type":"NodeText","Data":"：A 回答“知道了”，这样通话才算结束。"}]}]}]},{"ID":"20240201213769-273mbb9","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213769-273mbb9","updated":"20240201213769"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"为什么不能把服务器发送的 ACK 和 FIN 合并起来，变成三次挥手？"}]},{"ID":"20240201213770-vcgra9l","Type":"NodeParagraph","Properties":{"id":"20240201213770-vcgra9l","updated":"20240201213770"},"Children":[{"Type":"NodeText","Data":"因为服务器收到客户端断开连接的请求时，可能还有一些数据没有发完，这时先回复 ACK，表示接收到了断开连接的请求。等到数据发完之后再发 FIN，断开服务器到客户端的数据传送。"}]},{"ID":"20240201213771-uxgygxa","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213771-uxgygxa","updated":"20240201213771"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"如果第二次挥手时服务器的 ACK 没有送达客户端，会怎样？"}]},{"ID":"20240201213772-96nt8ay","Type":"NodeParagraph","Properties":{"id":"20240201213772-96nt8ay","updated":"20240201213772"},"Children":[{"Type":"NodeText","Data":"客户端没有收到 ACK 确认，会重新发送 FIN 请求。"}]},{"ID":"20240201213773-hr61qu2","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213773-hr61qu2","updated":"20240201213773"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"为什么第四次挥手客户端需要等待 2"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"*","Properties":{"id":""}}]},{"Type":"NodeText","Data":"MSL（报文段最长寿命）时间后才进入 CLOSED 状态？"}]},{"ID":"20240201213774-9thk6rl","Type":"NodeParagraph","Properties":{"id":"20240201213774-9thk6rl","updated":"20240201213774"},"Children":[{"Type":"NodeText","Data":"第四次挥手时，客户端发送给服务器的 ACK 有可能丢失，如果服务端因为某些原因而没有收到 ACK 的话，服务端就会重发 FIN，如果客户端在 2"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"*","Properties":{"id":""}}]},{"Type":"NodeText","Data":"MSL 的时间内收到了 FIN，就会重新发送 ACK 并再次等待 2MSL，防止 Server 没有收到 ACK 而不断重发 FIN。"}]},{"ID":"20240201213775-mzq60ev","Type":"NodeBlockquote","Properties":{"id":"20240201213775-mzq60ev","updated":"20240201213775"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240201213776-2gm41lw","Type":"NodeParagraph","Properties":{"id":"20240201213776-2gm41lw","updated":"20240201213776"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"MSL(Maximum Segment Lifetime)"},{"Type":"NodeText","Data":" : 一个片段在网络中最大的存活时间，2MSL 就是一个发送和一个回复所需的最大时间。如果直到 2MSL，Client 都没有再次收到 FIN，那么 Client 推断 ACK 已经被成功接收，则结束 TCP 连接。"}]}]},{"ID":"20240201213777-npn8gl3","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213777-npn8gl3","updated":"20240201213777"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"参考"}]},{"ID":"20240201213778-msehot0","Type":"NodeList","ListData":{"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213778-msehot0","updated":"20240201213778"},"Children":[{"ID":"20240201213779-bkfzf8j","Type":"NodeListItem","Data":"-","ListData":{"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213779-bkfzf8j","updated":"20240201213779"},"Children":[{"ID":"20240201213780-1ss1sn3","Type":"NodeParagraph","Properties":{"id":"20240201213780-1ss1sn3","updated":"20240201213780"},"Children":[{"Type":"NodeText","Data":"《计算机网络（第 7 版）》"}]}]},{"ID":"20240201213781-btrfloz","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213781-btrfloz","updated":"20240201213781"},"Children":[{"ID":"20240201213782-n2iozu7","Type":"NodeParagraph","Properties":{"id":"20240201213782-n2iozu7","updated":"20240201213782"},"Children":[{"Type":"NodeText","Data":"《图解 HTTP》"}]}]},{"ID":"20240201213783-bojw3j8","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213783-bojw3j8","updated":"20240201213783"},"Children":[{"ID":"20240201213784-jjbs61a","Type":"NodeParagraph","Properties":{"id":"20240201213784-jjbs61a","updated":"20240201213784"},"Children":[{"Type":"NodeText","Data":"TCP and UDP Tutorial："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://www.9tut.com/tcp-and-udp-tutorial","TextMarkTextContent":"https://www.9tut.com/tcp-and-udp-tutorial"}]}]}]},{"ID":"20240201213785-v48mgve","Type":"NodeHTMLBlock","Data":"\u003cdiv\u003e\n\u003c!-- @include: @article-footer.snippet.md --\u003e\n\u003c/div\u003e","HtmlBlockType":2,"Properties":{"id":"20240201213785-v48mgve","updated":"20240201213785"}}]}