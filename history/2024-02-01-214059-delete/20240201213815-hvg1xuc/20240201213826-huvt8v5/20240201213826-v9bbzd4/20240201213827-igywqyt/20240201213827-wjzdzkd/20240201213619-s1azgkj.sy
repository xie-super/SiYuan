{"ID":"20240201213619-s1azgkj","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240201213619-s1azgkj","title":"jwt-intro","updated":"20240201213619"},"Children":[{"ID":"20240201213620-zq6fyk3","Type":"NodeThematicBreak","Properties":{"id":"20240201213620-zq6fyk3","updated":"20240201213620"}},{"ID":"20240201213621-mhp0c0i","Type":"NodeParagraph","Properties":{"id":"20240201213621-mhp0c0i","updated":"20240201213621"},"Children":[{"Type":"NodeText","Data":"title: JWT 基础概念详解"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"category: 系统设计"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"tag:"}]},{"ID":"20240201213622-b0j7ej1","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"MarkerOffset":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213622-b0j7ej1","updated":"20240201213622"},"Children":[{"ID":"20240201213623-h33ubtr","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"MarkerOffset":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213623-h33ubtr","updated":"20240201213623"},"Children":[{"ID":"20240201213624-s1x701i","Type":"NodeParagraph","Properties":{"id":"20240201213624-s1x701i","updated":"20240201213624"},"Children":[{"Type":"NodeText","Data":"安全"}]}]}]},{"ID":"20240201213625-hx9heo8","Type":"NodeThematicBreak","Properties":{"id":"20240201213625-hx9heo8","updated":"20240201213625"}},{"ID":"20240201213626-mfa5f6y","Type":"NodeHTMLBlock","Data":"\u003cdiv\u003e\n\u003c!-- @include: @article-header.snippet.md --\u003e\n\u003c/div\u003e","HtmlBlockType":2,"Properties":{"id":"20240201213626-mfa5f6y","updated":"20240201213626"}},{"ID":"20240201213627-873sjkj","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213627-873sjkj","updated":"20240201213627"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"什么是 JWT?"}]},{"ID":"20240201213628-qjwckx4","Type":"NodeParagraph","Properties":{"id":"20240201213628-qjwckx4","updated":"20240201213628"},"Children":[{"Type":"NodeText","Data":"JWT （JSON Web Token） 是目前最流行的跨域认证解决方案，是一种基于 Token 的认证授权机制。 从 JWT 的全称可以看出，JWT 本身也是 Token，一种规范化之后的 JSON 结构的 Token。"}]},{"ID":"20240201213629-3bl136f","Type":"NodeParagraph","Properties":{"id":"20240201213629-3bl136f","updated":"20240201213629"},"Children":[{"Type":"NodeText","Data":"JWT 自身包含了身份验证所需要的所有信息，因此，我们的服务器不需要存储 Session 信息。这显然增加了系统的可用性和伸缩性，大大减轻了服务端的压力。"}]},{"ID":"20240201213630-ljuxpsq","Type":"NodeParagraph","Properties":{"id":"20240201213630-ljuxpsq","updated":"20240201213630"},"Children":[{"Type":"NodeText","Data":"可以看出，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"JWT 更符合设计 RESTful API 时的「Stateless（无状态）」原则"},{"Type":"NodeText","Data":" 。"}]},{"ID":"20240201213631-o2ho7by","Type":"NodeParagraph","Properties":{"id":"20240201213631-o2ho7by","updated":"20240201213631"},"Children":[{"Type":"NodeText","Data":"并且， 使用 JWT 认证可以有效避免 CSRF 攻击，因为 JWT 一般是存在在 localStorage 中，使用 JWT 进行身份验证的过程中是不会涉及到 Cookie 的。"}]},{"ID":"20240201213632-dg6d1vy","Type":"NodeParagraph","Properties":{"id":"20240201213632-dg6d1vy","updated":"20240201213632"},"Children":[{"Type":"NodeText","Data":"我在 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"./advantages-and-disadvantages-of-jwt.md","TextMarkTextContent":"JWT 优缺点分析"},{"Type":"NodeText","Data":"这篇文章中有详细介绍到使用 JWT 做身份认证的优势和劣势。"}]},{"ID":"20240201213633-m7a0m9w","Type":"NodeParagraph","Properties":{"id":"20240201213633-m7a0m9w","updated":"20240201213633"},"Children":[{"Type":"NodeText","Data":"下面是 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://tools.ietf.org/html/rfc7519","TextMarkTextContent":"RFC 7519"},{"Type":"NodeText","Data":" 对 JWT 做的较为正式的定义。"}]},{"ID":"20240201213634-e2rhjsw","Type":"NodeBlockquote","Properties":{"id":"20240201213634-e2rhjsw","updated":"20240201213634"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240201213635-46gn9oe","Type":"NodeParagraph","Properties":{"id":"20240201213635-46gn9oe","updated":"20240201213635"},"Children":[{"Type":"NodeText","Data":"JSON Web Token (JWT) is a compact, URL-safe means of representing claims to be transferred between two parties. The claims in a JWT are encoded as a JSON object that is used as the payload of a JSON Web Signature (JWS) structure or as the plaintext of a JSON Web Encryption (JWE) structure, enabling the claims to be digitally signed or integrity protected with a Message Authentication Code (MAC) and/or encrypted. ——"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://tools.ietf.org/html/rfc7519","TextMarkTextContent":"JSON Web Token (JWT)"}]}]},{"ID":"20240201213636-ehmakug","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213636-ehmakug","updated":"20240201213636"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"JWT 由哪些部分组成？"}]},{"ID":"20240201213637-55aqe3l","Type":"NodeParagraph","Properties":{"id":"20240201213637-55aqe3l","updated":"20240201213637"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"此图片来源于：https://supertokens.com/blog/oauth-vs-jwt","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/javaguide/system-design/jwt/jwt-composition.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213638-tis31o7","Type":"NodeParagraph","Properties":{"id":"20240201213638-tis31o7","updated":"20240201213638"},"Children":[{"Type":"NodeText","Data":"JWT 本质上就是一组字串，通过（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"."},{"Type":"NodeText","Data":"）切分成三个为 Base64 编码的部分："}]},{"ID":"20240201213639-ue92gbr","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213639-ue92gbr","updated":"20240201213639"},"Children":[{"ID":"20240201213640-9ngc9xe","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213640-9ngc9xe","updated":"20240201213640"},"Children":[{"ID":"20240201213641-q1oh2ck","Type":"NodeParagraph","Properties":{"id":"20240201213641-q1oh2ck","updated":"20240201213641"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Header"},{"Type":"NodeText","Data":" : 描述 JWT 的元数据，定义了生成签名的算法以及 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"Token"},{"Type":"NodeText","Data":" 的类型。"}]}]},{"ID":"20240201213642-3x4cmuz","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213642-3x4cmuz","updated":"20240201213642"},"Children":[{"ID":"20240201213643-2xedy31","Type":"NodeParagraph","Properties":{"id":"20240201213643-2xedy31","updated":"20240201213643"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Payload"},{"Type":"NodeText","Data":" : 用来存放实际需要传递的数据"}]}]},{"ID":"20240201213644-d6ne57a","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213644-d6ne57a","updated":"20240201213644"},"Children":[{"ID":"20240201213645-w6ct1w9","Type":"NodeParagraph","Properties":{"id":"20240201213645-w6ct1w9","updated":"20240201213645"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Signature（签名）"},{"Type":"NodeText","Data":"：服务器通过 Payload、Header 和一个密钥(Secret)使用 Header 里面指定的签名算法（默认是 HMAC SHA256）生成。"}]}]}]},{"ID":"20240201213646-8xpk8dd","Type":"NodeParagraph","Properties":{"id":"20240201213646-8xpk8dd","updated":"20240201213646"},"Children":[{"Type":"NodeText","Data":"JWT 通常是这样的："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"xxxxx.yyyyy.zzzzz"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240201213647-fnktmur","Type":"NodeParagraph","Properties":{"id":"20240201213647-fnktmur","updated":"20240201213647"},"Children":[{"Type":"NodeText","Data":"示例："}]},{"ID":"20240201213648-5toaib4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"cGxhaW4=","CodeBlockCloseFence":"YGBg","Properties":{"id":"20240201213648-5toaib4","updated":"20240201213648"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cGxhaW4=","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.\neyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.\nSflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20240201213649-2pwa32v","Type":"NodeParagraph","Properties":{"id":"20240201213649-2pwa32v","updated":"20240201213649"},"Children":[{"Type":"NodeText","Data":"你可以在 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://jwt.io/","TextMarkTextContent":"jwt.io"},{"Type":"NodeText","Data":" 这个网站上对其 JWT 进行解码，解码之后得到的就是 Header、Payload、Signature 这三部分。"}]},{"ID":"20240201213650-9t83nam","Type":"NodeParagraph","Properties":{"id":"20240201213650-9t83nam","updated":"20240201213650"},"Children":[{"Type":"NodeText","Data":"Header 和 Payload 都是 JSON 格式的数据，Signature 由 Payload、Header 和 Secret(密钥)通过特定的计算公式和加密算法得到。"}]},{"ID":"20240201213651-b3l6x4o","Type":"NodeParagraph","Properties":{"id":"20240201213651-b3l6x4o","updated":"20240201213651"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/javaguide/system-design/jwt/jwt.io.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213652-jwd9qqp","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213652-jwd9qqp","updated":"20240201213652"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"Header"}]},{"ID":"20240201213653-5irylyj","Type":"NodeParagraph","Properties":{"id":"20240201213653-5irylyj","updated":"20240201213653"},"Children":[{"Type":"NodeText","Data":"Header 通常由两部分组成："}]},{"ID":"20240201213654-t1tnidn","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213654-t1tnidn","updated":"20240201213654"},"Children":[{"ID":"20240201213655-gqv2h9z","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213655-gqv2h9z","updated":"20240201213655"},"Children":[{"ID":"20240201213656-zso9yhj","Type":"NodeParagraph","Properties":{"id":"20240201213656-zso9yhj","updated":"20240201213656"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"typ"},{"Type":"NodeText","Data":"（Type）：令牌类型，也就是 JWT。"}]}]},{"ID":"20240201213657-rt4hmde","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213657-rt4hmde","updated":"20240201213657"},"Children":[{"ID":"20240201213658-aptci69","Type":"NodeParagraph","Properties":{"id":"20240201213658-aptci69","updated":"20240201213658"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"alg"},{"Type":"NodeText","Data":"（Algorithm）：签名算法，比如 HS256。"}]}]}]},{"ID":"20240201213659-ia6bh38","Type":"NodeParagraph","Properties":{"id":"20240201213659-ia6bh38","updated":"20240201213659"},"Children":[{"Type":"NodeText","Data":"示例："}]},{"ID":"20240201213660-viirvu4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"anNvbg==","CodeBlockCloseFence":"YGBg","Properties":{"id":"20240201213660-viirvu4","updated":"20240201213660"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"anNvbg==","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"{\n  \"alg\": \"HS256\",\n  \"typ\": \"JWT\"\n}\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20240201213661-3ublf8n","Type":"NodeParagraph","Properties":{"id":"20240201213661-3ublf8n","updated":"20240201213661"},"Children":[{"Type":"NodeText","Data":"JSON 形式的 Header 被转换成 Base64 编码，成为 JWT 的第一部分。"}]},{"ID":"20240201213662-3hmrocc","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213662-3hmrocc","updated":"20240201213662"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"Payload"}]},{"ID":"20240201213663-bxt10cs","Type":"NodeParagraph","Properties":{"id":"20240201213663-bxt10cs","updated":"20240201213663"},"Children":[{"Type":"NodeText","Data":"Payload 也是 JSON 格式数据，其中包含了 Claims(声明，包含 JWT 的相关信息)。"}]},{"ID":"20240201213664-nt6xzlh","Type":"NodeParagraph","Properties":{"id":"20240201213664-nt6xzlh","updated":"20240201213664"},"Children":[{"Type":"NodeText","Data":"Claims 分为三种类型："}]},{"ID":"20240201213665-00eyeq1","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213665-00eyeq1","updated":"20240201213665"},"Children":[{"ID":"20240201213666-74it4u4","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213666-74it4u4","updated":"20240201213666"},"Children":[{"ID":"20240201213667-s3nm2r1","Type":"NodeParagraph","Properties":{"id":"20240201213667-s3nm2r1","updated":"20240201213667"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Registered Claims（注册声明）"},{"Type":"NodeText","Data":"：预定义的一些声明，建议使用，但不是强制性的。"}]}]},{"ID":"20240201213668-3ou2nl2","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213668-3ou2nl2","updated":"20240201213668"},"Children":[{"ID":"20240201213669-2iht93z","Type":"NodeParagraph","Properties":{"id":"20240201213669-2iht93z","updated":"20240201213669"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Public Claims（公有声明）"},{"Type":"NodeText","Data":"：JWT 签发方可以自定义的声明，但是为了避免冲突，应该在 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://www.iana.org/assignments/jwt/jwt.xhtml","TextMarkTextContent":"IANA JSON Web Token Registry"},{"Type":"NodeText","Data":" 中定义它们。"}]}]},{"ID":"20240201213670-vdhp0qf","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213670-vdhp0qf","updated":"20240201213670"},"Children":[{"ID":"20240201213671-39vbgmv","Type":"NodeParagraph","Properties":{"id":"20240201213671-39vbgmv","updated":"20240201213671"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Private Claims（私有声明）"},{"Type":"NodeText","Data":"：JWT 签发方因为项目需要而自定义的声明，更符合实际项目场景使用。"}]}]}]},{"ID":"20240201213672-p922ves","Type":"NodeParagraph","Properties":{"id":"20240201213672-p922ves","updated":"20240201213672"},"Children":[{"Type":"NodeText","Data":"下面是一些常见的注册声明："}]},{"ID":"20240201213673-dkoyqux","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213673-dkoyqux","updated":"20240201213673"},"Children":[{"ID":"20240201213674-zaksue1","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213674-zaksue1","updated":"20240201213674"},"Children":[{"ID":"20240201213675-jiqre0r","Type":"NodeParagraph","Properties":{"id":"20240201213675-jiqre0r","updated":"20240201213675"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"iss"},{"Type":"NodeText","Data":"（issuer）：JWT 签发方。"}]}]},{"ID":"20240201213676-fkr7pl5","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213676-fkr7pl5","updated":"20240201213676"},"Children":[{"ID":"20240201213677-t71ju9h","Type":"NodeParagraph","Properties":{"id":"20240201213677-t71ju9h","updated":"20240201213677"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"iat"},{"Type":"NodeText","Data":"（issued at time）：JWT 签发时间。"}]}]},{"ID":"20240201213678-9lxbc7x","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213678-9lxbc7x","updated":"20240201213678"},"Children":[{"ID":"20240201213679-7n6ch81","Type":"NodeParagraph","Properties":{"id":"20240201213679-7n6ch81","updated":"20240201213679"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"sub"},{"Type":"NodeText","Data":"（subject）：JWT 主题。"}]}]},{"ID":"20240201213680-lm3k9yz","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213680-lm3k9yz","updated":"20240201213680"},"Children":[{"ID":"20240201213681-5rtb0vy","Type":"NodeParagraph","Properties":{"id":"20240201213681-5rtb0vy","updated":"20240201213681"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"aud"},{"Type":"NodeText","Data":"（audience）：JWT 接收方。"}]}]},{"ID":"20240201213682-42823cj","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213682-42823cj","updated":"20240201213682"},"Children":[{"ID":"20240201213683-ansm6xz","Type":"NodeParagraph","Properties":{"id":"20240201213683-ansm6xz","updated":"20240201213683"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"exp"},{"Type":"NodeText","Data":"（expiration time）：JWT 的过期时间。"}]}]},{"ID":"20240201213684-4dovcw8","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213684-4dovcw8","updated":"20240201213684"},"Children":[{"ID":"20240201213685-4jvayvy","Type":"NodeParagraph","Properties":{"id":"20240201213685-4jvayvy","updated":"20240201213685"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"nbf"},{"Type":"NodeText","Data":"（not before time）：JWT 生效时间，早于该定义的时间的 JWT 不能被接受处理。"}]}]},{"ID":"20240201213686-77hnmp2","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213686-77hnmp2","updated":"20240201213686"},"Children":[{"ID":"20240201213687-ag3otcx","Type":"NodeParagraph","Properties":{"id":"20240201213687-ag3otcx","updated":"20240201213687"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"jti"},{"Type":"NodeText","Data":"（JWT ID）：JWT 唯一标识。"}]}]}]},{"ID":"20240201213688-93kvwz3","Type":"NodeParagraph","Properties":{"id":"20240201213688-93kvwz3","updated":"20240201213688"},"Children":[{"Type":"NodeText","Data":"示例："}]},{"ID":"20240201213689-vnl4ix5","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"anNvbg==","CodeBlockCloseFence":"YGBg","Properties":{"id":"20240201213689-vnl4ix5","updated":"20240201213689"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"anNvbg==","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"{\n  \"uid\": \"ff1212f5-d8d1-4496-bf41-d2dda73de19a\",\n  \"sub\": \"1234567890\",\n  \"name\": \"John Doe\",\n  \"exp\": 15323232,\n  \"iat\": 1516239022,\n  \"scope\": [\"admin\", \"user\"]\n}\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20240201213690-ohr99lb","Type":"NodeParagraph","Properties":{"id":"20240201213690-ohr99lb","updated":"20240201213690"},"Children":[{"Type":"NodeText","Data":"Payload 部分默认是不加密的，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"一定不要将隐私信息存放在 Payload 当中！！！"}]},{"ID":"20240201213691-o8z1jx0","Type":"NodeParagraph","Properties":{"id":"20240201213691-o8z1jx0","updated":"20240201213691"},"Children":[{"Type":"NodeText","Data":"JSON 形式的 Payload 被转换成 Base64 编码，成为 JWT 的第二部分。"}]},{"ID":"20240201213692-rtyg0az","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213692-rtyg0az","updated":"20240201213692"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"Signature"}]},{"ID":"20240201213693-iohz9i5","Type":"NodeParagraph","Properties":{"id":"20240201213693-iohz9i5","updated":"20240201213693"},"Children":[{"Type":"NodeText","Data":"Signature 部分是对前两部分的签名，作用是防止 JWT（主要是 payload） 被篡改。"}]},{"ID":"20240201213694-zt3pbi6","Type":"NodeParagraph","Properties":{"id":"20240201213694-zt3pbi6","updated":"20240201213694"},"Children":[{"Type":"NodeText","Data":"这个签名的生成需要用到："}]},{"ID":"20240201213695-wr04l1k","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213695-wr04l1k","updated":"20240201213695"},"Children":[{"ID":"20240201213696-a6a2b4k","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213696-a6a2b4k","updated":"20240201213696"},"Children":[{"ID":"20240201213697-clsjnp1","Type":"NodeParagraph","Properties":{"id":"20240201213697-clsjnp1","updated":"20240201213697"},"Children":[{"Type":"NodeText","Data":"Header + Payload。"}]}]},{"ID":"20240201213698-dn4yodz","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213698-dn4yodz","updated":"20240201213698"},"Children":[{"ID":"20240201213699-lgbf86b","Type":"NodeParagraph","Properties":{"id":"20240201213699-lgbf86b","updated":"20240201213699"},"Children":[{"Type":"NodeText","Data":"存放在服务端的密钥(一定不要泄露出去)。"}]}]},{"ID":"20240201213700-dijr6el","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213700-dijr6el","updated":"20240201213700"},"Children":[{"ID":"20240201213701-kpsqmfj","Type":"NodeParagraph","Properties":{"id":"20240201213701-kpsqmfj","updated":"20240201213701"},"Children":[{"Type":"NodeText","Data":"签名算法。"}]}]}]},{"ID":"20240201213702-i87a83n","Type":"NodeParagraph","Properties":{"id":"20240201213702-i87a83n","updated":"20240201213702"},"Children":[{"Type":"NodeText","Data":"签名的计算公式如下："}]},{"ID":"20240201213703-eautf3w","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"cGxhaW4=","CodeBlockCloseFence":"YGBg","Properties":{"id":"20240201213703-eautf3w","updated":"20240201213703"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cGxhaW4=","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"HMACSHA256(\n  base64UrlEncode(header) + \".\" +\n  base64UrlEncode(payload),\n  secret)\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20240201213704-243d3jd","Type":"NodeParagraph","Properties":{"id":"20240201213704-243d3jd","updated":"20240201213704"},"Children":[{"Type":"NodeText","Data":"算出签名以后，把 Header、Payload、Signature 三个部分拼成一个字符串，每个部分之间用\"点\"（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"."},{"Type":"NodeText","Data":"）分隔，这个字符串就是 JWT 。"}]},{"ID":"20240201213705-0g112tb","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213705-0g112tb","updated":"20240201213705"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"如何基于 JWT 进行身份验证？"}]},{"ID":"20240201213706-st9cbwx","Type":"NodeParagraph","Properties":{"id":"20240201213706-st9cbwx","updated":"20240201213706"},"Children":[{"Type":"NodeText","Data":"在基于 JWT 进行身份验证的的应用程序中，服务器通过 Payload、Header 和 Secret(密钥)创建 JWT 并将 JWT 发送给客户端。客户端接收到 JWT 之后，会将其保存在 Cookie 或者 localStorage 里面，以后客户端发出的所有请求都会携带这个令牌。"}]},{"ID":"20240201213707-zuydhdp","Type":"NodeParagraph","Properties":{"id":"20240201213707-zuydhdp","updated":"20240201213707"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":" JWT 身份验证示意图","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/system-design/jwt/jwt-authentication process.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213708-xo00i55","Type":"NodeParagraph","Properties":{"id":"20240201213708-xo00i55","updated":"20240201213708"},"Children":[{"Type":"NodeText","Data":"简化后的步骤如下："}]},{"ID":"20240201213709-lb2erd8","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213709-lb2erd8","updated":"20240201213709"},"Children":[{"ID":"20240201213710-d9xbxkn","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213710-d9xbxkn","updated":"20240201213710"},"Children":[{"ID":"20240201213711-cmt94lv","Type":"NodeParagraph","Properties":{"id":"20240201213711-cmt94lv","updated":"20240201213711"},"Children":[{"Type":"NodeText","Data":"用户向服务器发送用户名、密码以及验证码用于登陆系统。"}]}]},{"ID":"20240201213712-d7sso6i","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20240201213712-d7sso6i","updated":"20240201213712"},"Children":[{"ID":"20240201213713-fmp4ise","Type":"NodeParagraph","Properties":{"id":"20240201213713-fmp4ise","updated":"20240201213713"},"Children":[{"Type":"NodeText","Data":"如果用户用户名、密码以及验证码校验正确的话，服务端会返回已经签名的 Token，也就是 JWT。"}]}]},{"ID":"20240201213714-shg1owg","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20240201213714-shg1owg","updated":"20240201213714"},"Children":[{"ID":"20240201213715-121v0em","Type":"NodeParagraph","Properties":{"id":"20240201213715-121v0em","updated":"20240201213715"},"Children":[{"Type":"NodeText","Data":"用户以后每次向后端发请求都在 Header 中带上这个 JWT 。"}]}]},{"ID":"20240201213716-kybf006","Type":"NodeListItem","Data":"4","ListData":{"Typ":1,"Tight":true,"Start":4,"Delimiter":46,"Padding":3,"Marker":"NA==","Num":4},"Properties":{"id":"20240201213716-kybf006","updated":"20240201213716"},"Children":[{"ID":"20240201213717-uptt8m6","Type":"NodeParagraph","Properties":{"id":"20240201213717-uptt8m6","updated":"20240201213717"},"Children":[{"Type":"NodeText","Data":"服务端检查 JWT 并从中获取用户相关信息。"}]}]}]},{"ID":"20240201213718-fh3u6r7","Type":"NodeParagraph","Properties":{"id":"20240201213718-fh3u6r7","updated":"20240201213718"},"Children":[{"Type":"NodeText","Data":"两点建议："}]},{"ID":"20240201213719-x5alxqd","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213719-x5alxqd","updated":"20240201213719"},"Children":[{"ID":"20240201213720-6xmb3f7","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213720-6xmb3f7","updated":"20240201213720"},"Children":[{"ID":"20240201213721-2ai0p7w","Type":"NodeParagraph","Properties":{"id":"20240201213721-2ai0p7w","updated":"20240201213721"},"Children":[{"Type":"NodeText","Data":"建议将 JWT 存放在 localStorage 中，放在 Cookie 中会有 CSRF 风险。"}]}]},{"ID":"20240201213722-w08hb2m","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20240201213722-w08hb2m","updated":"20240201213722"},"Children":[{"ID":"20240201213723-xdzfirk","Type":"NodeParagraph","Properties":{"id":"20240201213723-xdzfirk","updated":"20240201213723"},"Children":[{"Type":"NodeText","Data":"请求服务端并携带 JWT 的常见做法是将其放在 HTTP Header 的 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"Authorization"},{"Type":"NodeText","Data":" 字段中（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"Authorization: Bearer Token"},{"Type":"NodeText","Data":"）。"}]}]}]},{"ID":"20240201213724-lzgk9en","Type":"NodeParagraph","Properties":{"id":"20240201213724-lzgk9en","updated":"20240201213724"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong a","TextMarkAHref":"https://github.com/Snailclimb/spring-security-jwt-guide","TextMarkTextContent":"spring-security-jwt-guide"},{"Type":"NodeText","Data":" 就是一个基于 JWT 来做身份认证的简单案例，感兴趣的可以看看。"}]},{"ID":"20240201213725-6gp2ka7","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213725-6gp2ka7","updated":"20240201213725"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"如何防止 JWT 被篡改？"}]},{"ID":"20240201213726-q9a6acq","Type":"NodeParagraph","Properties":{"id":"20240201213726-q9a6acq","updated":"20240201213726"},"Children":[{"Type":"NodeText","Data":"有了签名之后，即使 JWT 被泄露或者截获，黑客也没办法同时篡改 Signature、Header、Payload。"}]},{"ID":"20240201213727-wljj1vu","Type":"NodeParagraph","Properties":{"id":"20240201213727-wljj1vu","updated":"20240201213727"},"Children":[{"Type":"NodeText","Data":"这是为什么呢？因为服务端拿到 JWT 之后，会解析出其中包含的 Header、Payload 以及 Signature 。服务端会根据 Header、Payload、密钥再次生成一个 Signature。拿新生成的 Signature 和 JWT 中的 Signature 作对比，如果一样就说明 Header 和 Payload 没有被修改。"}]},{"ID":"20240201213728-qbdm8r9","Type":"NodeParagraph","Properties":{"id":"20240201213728-qbdm8r9","updated":"20240201213728"},"Children":[{"Type":"NodeText","Data":"不过，如果服务端的秘钥也被泄露的话，黑客就可以同时篡改 Signature、Header、Payload 了。黑客直接修改了 Header 和 Payload 之后，再重新生成一个 Signature 就可以了。"}]},{"ID":"20240201213729-ijjuede","Type":"NodeParagraph","Properties":{"id":"20240201213729-ijjuede","updated":"20240201213729"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"密钥一定保管好，一定不要泄露出去。JWT 安全的核心在于签名，签名安全的核心在密钥。"}]},{"ID":"20240201213730-8c3ub1w","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213730-8c3ub1w","updated":"20240201213730"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"如何加强 JWT 的安全性？"}]},{"ID":"20240201213731-4xud1xv","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213731-4xud1xv","updated":"20240201213731"},"Children":[{"ID":"20240201213732-0o9m8w8","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213732-0o9m8w8","updated":"20240201213732"},"Children":[{"ID":"20240201213733-v419fok","Type":"NodeParagraph","Properties":{"id":"20240201213733-v419fok","updated":"20240201213733"},"Children":[{"Type":"NodeText","Data":"使用安全系数高的加密算法。"}]}]},{"ID":"20240201213734-6rs5id4","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20240201213734-6rs5id4","updated":"20240201213734"},"Children":[{"ID":"20240201213735-4mzjmwf","Type":"NodeParagraph","Properties":{"id":"20240201213735-4mzjmwf","updated":"20240201213735"},"Children":[{"Type":"NodeText","Data":"使用成熟的开源库，没必要造轮子。"}]}]},{"ID":"20240201213736-ym1bop0","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20240201213736-ym1bop0","updated":"20240201213736"},"Children":[{"ID":"20240201213737-bwhe1e8","Type":"NodeParagraph","Properties":{"id":"20240201213737-bwhe1e8","updated":"20240201213737"},"Children":[{"Type":"NodeText","Data":"JWT 存放在 localStorage 中而不是 Cookie 中，避免 CSRF 风险。"}]}]},{"ID":"20240201213738-ccz92gd","Type":"NodeListItem","Data":"4","ListData":{"Typ":1,"Tight":true,"Start":4,"Delimiter":46,"Padding":3,"Marker":"NA==","Num":4},"Properties":{"id":"20240201213738-ccz92gd","updated":"20240201213738"},"Children":[{"ID":"20240201213739-hi072pa","Type":"NodeParagraph","Properties":{"id":"20240201213739-hi072pa","updated":"20240201213739"},"Children":[{"Type":"NodeText","Data":"一定不要将隐私信息存放在 Payload 当中。"}]}]},{"ID":"20240201213740-hdkeceq","Type":"NodeListItem","Data":"5","ListData":{"Typ":1,"Tight":true,"Start":5,"Delimiter":46,"Padding":3,"Marker":"NQ==","Num":5},"Properties":{"id":"20240201213740-hdkeceq","updated":"20240201213740"},"Children":[{"ID":"20240201213741-1lvdlq3","Type":"NodeParagraph","Properties":{"id":"20240201213741-1lvdlq3","updated":"20240201213741"},"Children":[{"Type":"NodeText","Data":"密钥一定保管好，一定不要泄露出去。JWT 安全的核心在于签名，签名安全的核心在密钥。"}]}]},{"ID":"20240201213742-0i2t49f","Type":"NodeListItem","Data":"6","ListData":{"Typ":1,"Tight":true,"Start":6,"Delimiter":46,"Padding":3,"Marker":"Ng==","Num":6},"Properties":{"id":"20240201213742-0i2t49f","updated":"20240201213742"},"Children":[{"ID":"20240201213743-wk71d1c","Type":"NodeParagraph","Properties":{"id":"20240201213743-wk71d1c","updated":"20240201213743"},"Children":[{"Type":"NodeText","Data":"Payload 要加入 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"exp"},{"Type":"NodeText","Data":" （JWT 的过期时间），永久有效的 JWT 不合理。并且，JWT 的过期时间不易过长。"}]}]},{"ID":"20240201213744-uot46tr","Type":"NodeListItem","Data":"7","ListData":{"Typ":1,"Tight":true,"Start":7,"Delimiter":46,"Padding":3,"Marker":"Nw==","Num":7},"Properties":{"id":"20240201213744-uot46tr","updated":"20240201213744"},"Children":[{"ID":"20240201213745-sbi9bly","Type":"NodeParagraph","Properties":{"id":"20240201213745-sbi9bly","updated":"20240201213745"},"Children":[{"Type":"NodeText","Data":"……"}]}]}]},{"ID":"20240201213746-ww5mgyy","Type":"NodeHTMLBlock","Data":"\u003cdiv\u003e\n\u003c!-- @include: @article-footer.snippet.md --\u003e\n\u003c/div\u003e","HtmlBlockType":2,"Properties":{"id":"20240201213746-ww5mgyy","updated":"20240201213746"}}]}