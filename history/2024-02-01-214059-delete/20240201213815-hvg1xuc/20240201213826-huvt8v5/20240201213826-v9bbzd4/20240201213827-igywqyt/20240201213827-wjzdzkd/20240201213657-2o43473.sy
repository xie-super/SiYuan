{"ID":"20240201213657-2o43473","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240201213657-2o43473","title":"sso-intro","updated":"20240201213657"},"Children":[{"ID":"20240201213658-0497n3y","Type":"NodeThematicBreak","Properties":{"id":"20240201213658-0497n3y","updated":"20240201213658"}},{"ID":"20240201213659-i96xkwx","Type":"NodeParagraph","Properties":{"id":"20240201213659-i96xkwx","updated":"20240201213659"},"Children":[{"Type":"NodeText","Data":"title: SSO 单点登录详解"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"category: 系统设计"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"tag:"}]},{"ID":"20240201213660-btmyq4i","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"MarkerOffset":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213660-btmyq4i","updated":"20240201213660"},"Children":[{"ID":"20240201213661-5e62z08","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"MarkerOffset":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213661-5e62z08","updated":"20240201213661"},"Children":[{"ID":"20240201213662-krzj9yy","Type":"NodeParagraph","Properties":{"id":"20240201213662-krzj9yy","updated":"20240201213662"},"Children":[{"Type":"NodeText","Data":"安全"}]}]}]},{"ID":"20240201213663-5i15qp5","Type":"NodeThematicBreak","Properties":{"id":"20240201213663-5i15qp5","updated":"20240201213663"}},{"ID":"20240201213664-0pu9f8m","Type":"NodeBlockquote","Properties":{"id":"20240201213664-0pu9f8m","updated":"20240201213664"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240201213665-2gbom2m","Type":"NodeParagraph","Properties":{"id":"20240201213665-2gbom2m","updated":"20240201213665"},"Children":[{"Type":"NodeText","Data":"本文授权转载自："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://ken.io/note/sso-design-implement","TextMarkTextContent":"https://ken.io/note/sso-design-implement"},{"Type":"NodeText","Data":" 作者：ken.io"}]}]},{"ID":"20240201213666-e7yf8q7","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213666-e7yf8q7","updated":"20240201213666"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"SSO 介绍"}]},{"ID":"20240201213667-uegc71r","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213667-uegc71r","updated":"20240201213667"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"什么是 SSO？"}]},{"ID":"20240201213668-xokjwqw","Type":"NodeParagraph","Properties":{"id":"20240201213668-xokjwqw","updated":"20240201213668"},"Children":[{"Type":"NodeText","Data":"SSO 英文全称 Single Sign On，单点登录。SSO 是在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。"}]},{"ID":"20240201213669-4fddmo3","Type":"NodeParagraph","Properties":{"id":"20240201213669-4fddmo3","updated":"20240201213669"},"Children":[{"Type":"NodeText","Data":"例如你登录网易账号中心（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://reg.163.com/","TextMarkTextContent":"https://reg.163.com/"},{"Type":"NodeText","Data":" ）之后访问以下站点都是登录状态。"}]},{"ID":"20240201213670-ges2w9j","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213670-ges2w9j","updated":"20240201213670"},"Children":[{"ID":"20240201213671-srts6af","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213671-srts6af","updated":"20240201213671"},"Children":[{"ID":"20240201213672-ksshrrq","Type":"NodeParagraph","Properties":{"id":"20240201213672-ksshrrq","updated":"20240201213672"},"Children":[{"Type":"NodeText","Data":"网易直播 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://v.163.com/","TextMarkTextContent":"https://v.163.com"}]}]},{"ID":"20240201213673-95xorbc","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213673-95xorbc","updated":"20240201213673"},"Children":[{"ID":"20240201213674-lrmc76g","Type":"NodeParagraph","Properties":{"id":"20240201213674-lrmc76g","updated":"20240201213674"},"Children":[{"Type":"NodeText","Data":"网易博客 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://blog.163.com/","TextMarkTextContent":"https://blog.163.com"}]}]},{"ID":"20240201213675-ego84ds","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213675-ego84ds","updated":"20240201213675"},"Children":[{"ID":"20240201213676-2pieyr1","Type":"NodeParagraph","Properties":{"id":"20240201213676-2pieyr1","updated":"20240201213676"},"Children":[{"Type":"NodeText","Data":"网易花田 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://love.163.com/","TextMarkTextContent":"https://love.163.com"}]}]},{"ID":"20240201213677-4gmdzfe","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213677-4gmdzfe","updated":"20240201213677"},"Children":[{"ID":"20240201213678-p87p6cl","Type":"NodeParagraph","Properties":{"id":"20240201213678-p87p6cl","updated":"20240201213678"},"Children":[{"Type":"NodeText","Data":"网易考拉 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://www.kaola.com/","TextMarkTextContent":"https://www.kaola.com"}]}]},{"ID":"20240201213679-va25me6","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213679-va25me6","updated":"20240201213679"},"Children":[{"ID":"20240201213680-mqbus77","Type":"NodeParagraph","Properties":{"id":"20240201213680-mqbus77","updated":"20240201213680"},"Children":[{"Type":"NodeText","Data":"网易 Lofter "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"http://www.lofter.com/","TextMarkTextContent":"http://www.lofter.com"}]}]}]},{"ID":"20240201213681-mrwux51","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213681-mrwux51","updated":"20240201213681"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"SSO 有什么好处？"}]},{"ID":"20240201213682-i0b1532","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213682-i0b1532","updated":"20240201213682"},"Children":[{"ID":"20240201213683-r6ykm2q","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213683-r6ykm2q","updated":"20240201213683"},"Children":[{"ID":"20240201213684-2if13el","Type":"NodeParagraph","Properties":{"id":"20240201213684-2if13el","updated":"20240201213684"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"用户角度"},{"Type":"NodeText","Data":" :用户能够做到一次登录多次使用，无需记录多套用户名和密码，省心。"}]}]},{"ID":"20240201213685-ybeh9qd","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20240201213685-ybeh9qd","updated":"20240201213685"},"Children":[{"ID":"20240201213686-wxb9k7e","Type":"NodeParagraph","Properties":{"id":"20240201213686-wxb9k7e","updated":"20240201213686"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"系统管理员角度"},{"Type":"NodeText","Data":" : 管理员只需维护好一个统一的账号中心就可以了，方便。"}]}]},{"ID":"20240201213687-55tydqt","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20240201213687-55tydqt","updated":"20240201213687"},"Children":[{"ID":"20240201213688-6c0l9gr","Type":"NodeParagraph","Properties":{"id":"20240201213688-6c0l9gr","updated":"20240201213688"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"新系统开发角度:"},{"Type":"NodeText","Data":" 新系统开发时只需直接对接统一的账号中心即可，简化开发流程，省时。"}]}]}]},{"ID":"20240201213689-ipejkom","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213689-ipejkom","updated":"20240201213689"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"SSO 设计与实现"}]},{"ID":"20240201213690-bmbljiv","Type":"NodeParagraph","Properties":{"id":"20240201213690-bmbljiv","updated":"20240201213690"},"Children":[{"Type":"NodeText","Data":"本篇文章也主要是为了探讨如何设计\u0026实现一个 SSO 系统"}]},{"ID":"20240201213691-f6w3j95","Type":"NodeParagraph","Properties":{"id":"20240201213691-f6w3j95","updated":"20240201213691"},"Children":[{"Type":"NodeText","Data":"以下为需要实现的核心功能："}]},{"ID":"20240201213692-sbvbywk","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213692-sbvbywk","updated":"20240201213692"},"Children":[{"ID":"20240201213693-r6z9ykz","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213693-r6z9ykz","updated":"20240201213693"},"Children":[{"ID":"20240201213694-vskmq3r","Type":"NodeParagraph","Properties":{"id":"20240201213694-vskmq3r","updated":"20240201213694"},"Children":[{"Type":"NodeText","Data":"单点登录"}]}]},{"ID":"20240201213695-f0n25ib","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213695-f0n25ib","updated":"20240201213695"},"Children":[{"ID":"20240201213696-ryq2ytz","Type":"NodeParagraph","Properties":{"id":"20240201213696-ryq2ytz","updated":"20240201213696"},"Children":[{"Type":"NodeText","Data":"单点登出"}]}]},{"ID":"20240201213697-j9zcogn","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213697-j9zcogn","updated":"20240201213697"},"Children":[{"ID":"20240201213698-fwkgifq","Type":"NodeParagraph","Properties":{"id":"20240201213698-fwkgifq","updated":"20240201213698"},"Children":[{"Type":"NodeText","Data":"支持跨域单点登录"}]}]},{"ID":"20240201213699-gaz2sff","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213699-gaz2sff","updated":"20240201213699"},"Children":[{"ID":"20240201213700-aw3n4ni","Type":"NodeParagraph","Properties":{"id":"20240201213700-aw3n4ni","updated":"20240201213700"},"Children":[{"Type":"NodeText","Data":"支持跨域单点登出"}]}]}]},{"ID":"20240201213701-faoz966","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213701-faoz966","updated":"20240201213701"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"核心应用与依赖"}]},{"ID":"20240201213702-p6j0avs","Type":"NodeParagraph","Properties":{"id":"20240201213702-p6j0avs","updated":"20240201213702"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"单点登录（SSO）设计","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/system-design/security/sso/sso-system.png-kblb.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213703-4wjgwqa","Type":"NodeTable","Data":"| 应用/模块/对象    | 说明                                |\n| ----------------- | ----------------------------------- |\n| 前台站点          | 需要登录的站点                      |\n| SSO 站点-登录     | 提供登录的页面                      |\n| SSO 站点-登出     | 提供注销登录的入口                  |\n| SSO 服务-登录     | 提供登录服务                        |\n| SSO 服务-登录状态 | 提供登录状态校验/登录信息查询的服务 |\n| SSO 服务-登出     | 提供用户注销登录的服务              |\n| 数据库            | 存储用户账户信息                    |\n| 缓存              | 存储用户的登录信息，通常使用 Redis  |","TableAligns":[0,0],"Properties":{"id":"20240201213703-4wjgwqa","updated":"20240201213703"},"Children":[{"Type":"NodeTableHead","Properties":{"id":""},"Children":[{"Type":"NodeTableRow","Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"应用/模块/对象"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"说明"}]}]}]},{"Type":"NodeTableRow","TableAligns":[0,0],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"前台站点"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"需要登录的站点"}]}]},{"Type":"NodeTableRow","TableAligns":[0,0],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"SSO 站点-登录"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"提供登录的页面"}]}]},{"Type":"NodeTableRow","TableAligns":[0,0],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"SSO 站点-登出"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"提供注销登录的入口"}]}]},{"Type":"NodeTableRow","TableAligns":[0,0],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"SSO 服务-登录"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"提供登录服务"}]}]},{"Type":"NodeTableRow","TableAligns":[0,0],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"SSO 服务-登录状态"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"提供登录状态校验/登录信息查询的服务"}]}]},{"Type":"NodeTableRow","TableAligns":[0,0],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"SSO 服务-登出"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"提供用户注销登录的服务"}]}]},{"Type":"NodeTableRow","TableAligns":[0,0],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"数据库"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"存储用户账户信息"}]}]},{"Type":"NodeTableRow","TableAligns":[0,0],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"缓存"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"存储用户的登录信息，通常使用 Redis"}]}]}]},{"ID":"20240201213704-9h2itjl","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213704-9h2itjl","updated":"20240201213704"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"用户登录状态的存储与校验"}]},{"ID":"20240201213705-o8zovw2","Type":"NodeParagraph","Properties":{"id":"20240201213705-o8zovw2","updated":"20240201213705"},"Children":[{"Type":"NodeText","Data":"常见的 Web 框架对于 Session 的实现都是生成一个 SessionId 存储在浏览器 Cookie 中。然后将 Session 内容存储在服务器端内存中，这个 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://ken.io/","TextMarkTextContent":"ken.io"},{"Type":"NodeText","Data":" 在之前"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://ken.io/note/session-principle-skill","TextMarkTextContent":"Session 工作原理"},{"Type":"NodeText","Data":"中也提到过。整体也是借鉴这个思路。"}]},{"ID":"20240201213706-q421blo","Type":"NodeParagraph","Properties":{"id":"20240201213706-q421blo","updated":"20240201213706"},"Children":[{"Type":"NodeText","Data":"用户登录成功之后，生成 AuthToken 交给客户端保存。如果是浏览器，就保存在 Cookie 中。如果是手机 App 就保存在 App 本地缓存中。本篇主要探讨基于 Web 站点的 SSO。"}]},{"ID":"20240201213707-64m22nn","Type":"NodeParagraph","Properties":{"id":"20240201213707-64m22nn","updated":"20240201213707"},"Children":[{"Type":"NodeText","Data":"用户在浏览需要登录的页面时，客户端将 AuthToken 提交给 SSO 服务校验登录状态/获取用户登录信息"}]},{"ID":"20240201213708-74s8js3","Type":"NodeParagraph","Properties":{"id":"20240201213708-74s8js3","updated":"20240201213708"},"Children":[{"Type":"NodeText","Data":"对于登录信息的存储，建议采用 Redis，使用 Redis 集群来存储登录信息，既可以保证高可用，又可以线性扩充。同时也可以让 SSO 服务满足负载均衡/可伸缩的需求。"}]},{"ID":"20240201213709-kfd2k90","Type":"NodeTable","Data":"| 对象      | 说明                                                                                                               |\n| --------- | ------------------------------------------------------------------------------------------------------------------ |\n| AuthToken | 直接使用 UUID/GUID 即可，如果有验证 AuthToken 合法性需求，可以将 UserName+时间戳加密生成，服务端解密之后验证合法性 |\n| 登录信息  | 通常是将 UserId，UserName 缓存起来                                                                                 |","TableAligns":[0,0],"Properties":{"id":"20240201213709-kfd2k90","updated":"20240201213709"},"Children":[{"Type":"NodeTableHead","Properties":{"id":""},"Children":[{"Type":"NodeTableRow","Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"对象"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"说明"}]}]}]},{"Type":"NodeTableRow","TableAligns":[0,0],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"AuthToken"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"直接使用 UUID/GUID 即可，如果有验证 AuthToken 合法性需求，可以将 UserName+时间戳加密生成，服务端解密之后验证合法性"}]}]},{"Type":"NodeTableRow","TableAligns":[0,0],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"登录信息"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"通常是将 UserId，UserName 缓存起来"}]}]}]},{"ID":"20240201213710-hsmxvvq","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213710-hsmxvvq","updated":"20240201213710"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"用户登录/登录校验"}]},{"ID":"20240201213711-vgx5qqv","Type":"NodeParagraph","Properties":{"id":"20240201213711-vgx5qqv","updated":"20240201213711"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"登录时序图"}]},{"ID":"20240201213712-5ie3vnd","Type":"NodeParagraph","Properties":{"id":"20240201213712-5ie3vnd","updated":"20240201213712"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"SSO系统设计-登录时序图","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/system-design/security/sso/sso-login-sequence.png-kbrb.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213713-pb46v5q","Type":"NodeParagraph","Properties":{"id":"20240201213713-pb46v5q","updated":"20240201213713"},"Children":[{"Type":"NodeText","Data":"按照上图，用户登录后 AuthToken 保存在 Cookie 中。 domain=test.com"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"浏览器会将 domain 设置成 .test.com，"}]},{"ID":"20240201213714-xl5h55x","Type":"NodeParagraph","Properties":{"id":"20240201213714-xl5h55x","updated":"20240201213714"},"Children":[{"Type":"NodeText","Data":"这样访问所有 "},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"*","Properties":{"id":""}}]},{"Type":"NodeText","Data":".test.com 的 web 站点，都会将 AuthToken 携带到服务器端。"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"然后通过 SSO 服务，完成对用户状态的校验/用户登录信息的获取"}]},{"ID":"20240201213715-8obxbh8","Type":"NodeParagraph","Properties":{"id":"20240201213715-8obxbh8","updated":"20240201213715"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"登录信息获取/登录状态校验"}]},{"ID":"20240201213716-zo89ino","Type":"NodeParagraph","Properties":{"id":"20240201213716-zo89ino","updated":"20240201213716"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"SSO系统设计-登录信息获取/登录状态校验","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/system-design/security/sso/sso-logincheck-sequence.png-kbrb.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213717-o6rkj9n","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213717-o6rkj9n","updated":"20240201213717"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"用户登出"}]},{"ID":"20240201213718-ci8xnaq","Type":"NodeParagraph","Properties":{"id":"20240201213718-ci8xnaq","updated":"20240201213718"},"Children":[{"Type":"NodeText","Data":"用户登出时要做的事情很简单："}]},{"ID":"20240201213719-9isvhei","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213719-9isvhei","updated":"20240201213719"},"Children":[{"ID":"20240201213720-x2hb5da","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20240201213720-x2hb5da","updated":"20240201213720"},"Children":[{"ID":"20240201213721-zag0suv","Type":"NodeParagraph","Properties":{"id":"20240201213721-zag0suv","updated":"20240201213721"},"Children":[{"Type":"NodeText","Data":"服务端清除缓存（Redis）中的登录状态"}]}]},{"ID":"20240201213722-u1n8unq","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20240201213722-u1n8unq","updated":"20240201213722"},"Children":[{"ID":"20240201213723-qnii8xt","Type":"NodeParagraph","Properties":{"id":"20240201213723-qnii8xt","updated":"20240201213723"},"Children":[{"Type":"NodeText","Data":"客户端清除存储的 AuthToken"}]}]}]},{"ID":"20240201213724-39ppgla","Type":"NodeParagraph","Properties":{"id":"20240201213724-39ppgla","updated":"20240201213724"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"登出时序图"}]},{"ID":"20240201213725-ogr8cs3","Type":"NodeParagraph","Properties":{"id":"20240201213725-ogr8cs3","updated":"20240201213725"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"SSO系统设计-用户登出","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/system-design/security/sso/sso-logout-sequence.png-kbrb.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213726-l0pot1i","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240201213726-l0pot1i","updated":"20240201213726"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"跨域登录、登出"}]},{"ID":"20240201213727-4sjcuuo","Type":"NodeParagraph","Properties":{"id":"20240201213727-4sjcuuo","updated":"20240201213727"},"Children":[{"Type":"NodeText","Data":"前面提到过，核心思路是客户端存储 AuthToken，服务器端通过 Redis 存储登录信息。由于客户端是将 AuthToken 存储在 Cookie 中的。所以跨域要解决的问题，就是如何解决 Cookie 的跨域读写问题。"}]},{"ID":"20240201213728-jedn5gt","Type":"NodeParagraph","Properties":{"id":"20240201213728-jedn5gt","updated":"20240201213728"},"Children":[{"Type":"NodeText","Data":"解决跨域的核心思路就是："}]},{"ID":"20240201213729-m5fd20g","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213729-m5fd20g","updated":"20240201213729"},"Children":[{"ID":"20240201213730-20jbwzt","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213730-20jbwzt","updated":"20240201213730"},"Children":[{"ID":"20240201213731-7za4vxx","Type":"NodeParagraph","Properties":{"id":"20240201213731-7za4vxx","updated":"20240201213731"},"Children":[{"Type":"NodeText","Data":"登录完成之后通过回调的方式，将 AuthToken 传递给主域名之外的站点，该站点自行将 AuthToken 保存在当前域下的 Cookie 中。"}]}]},{"ID":"20240201213732-tmegfrc","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213732-tmegfrc","updated":"20240201213732"},"Children":[{"ID":"20240201213733-8ljznon","Type":"NodeParagraph","Properties":{"id":"20240201213733-8ljznon","updated":"20240201213733"},"Children":[{"Type":"NodeText","Data":"登出完成之后通过回调的方式，调用非主域名站点的登出页面，完成设置 Cookie 中的 AuthToken 过期的操作。"}]}]}]},{"ID":"20240201213734-hz00j86","Type":"NodeParagraph","Properties":{"id":"20240201213734-hz00j86","updated":"20240201213734"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"跨域登录（主域名已登录）"}]},{"ID":"20240201213735-75nqwoa","Type":"NodeParagraph","Properties":{"id":"20240201213735-75nqwoa","updated":"20240201213735"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"SSO系统设计-跨域登录（主域名已登录）","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/system-design/security/sso/sso-crossdomain-login-loggedin-sequence.png-kbrb.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213736-3v9roue","Type":"NodeParagraph","Properties":{"id":"20240201213736-3v9roue","updated":"20240201213736"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"跨域登录（主域名未登录）"}]},{"ID":"20240201213737-v43b95f","Type":"NodeParagraph","Properties":{"id":"20240201213737-v43b95f","updated":"20240201213737"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"SSO系统设计-跨域登录（主域名未登录）","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/system-design/security/sso/sso-crossdomain-login-unlogin-sequence.png-kbrb.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213738-v1sajcq","Type":"NodeParagraph","Properties":{"id":"20240201213738-v1sajcq","updated":"20240201213738"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"跨域登出"}]},{"ID":"20240201213739-0sauhqf","Type":"NodeParagraph","Properties":{"id":"20240201213739-0sauhqf","updated":"20240201213739"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"SSO系统设计-跨域登出","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://oss.javaguide.cn/github/javaguide/system-design/security/sso/sso-crossdomain-logout-sequence.png-kbrb.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240201213740-f09vg3n","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240201213740-f09vg3n","updated":"20240201213740"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"说明"}]},{"ID":"20240201213741-hf42t26","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213741-hf42t26","updated":"20240201213741"},"Children":[{"ID":"20240201213742-smq40se","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213742-smq40se","updated":"20240201213742"},"Children":[{"ID":"20240201213743-t14f8cz","Type":"NodeParagraph","Properties":{"id":"20240201213743-t14f8cz","updated":"20240201213743"},"Children":[{"Type":"NodeText","Data":"关于方案：这次设计方案更多是提供实现思路。如果涉及到 APP 用户登录等情况，在访问 SSO 服务时，增加对 APP 的签名验证就好了。当然，如果有无线网关，验证签名不是问题。"}]}]},{"ID":"20240201213744-j1u14mx","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240201213744-j1u14mx","updated":"20240201213744"},"Children":[{"ID":"20240201213745-qifbz94","Type":"NodeParagraph","Properties":{"id":"20240201213745-qifbz94","updated":"20240201213745"},"Children":[{"Type":"NodeText","Data":"关于时序图：时序图中并没有包含所有场景，只列举了核心/主要场景，另外对于一些不影响理解思路的消息能省就省了。"}]}]}]},{"ID":"20240201213746-3rcpqpm","Type":"NodeHTMLBlock","Data":"\u003cdiv\u003e\n\u003c!-- @include: @article-footer.snippet.md --\u003e\n\u003c/div\u003e","HtmlBlockType":2,"Properties":{"id":"20240201213746-3rcpqpm","updated":"20240201213746"}}]}