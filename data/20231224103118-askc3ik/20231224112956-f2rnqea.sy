{"ID":"20231224112956-f2rnqea","Spec":"1","Type":"NodeDocument","Properties":{"id":"20231224112956-f2rnqea","title":"The State Pattern（状态模式）","updated":"20231226171145"},"Children":[{"ID":"20231224113022-1ezi2j6","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20231224113022-1ezi2j6","updated":"20231226171145"},"Children":[{"Type":"NodeText","Data":"案例：自动糖果售卖机"}]},{"ID":"20231224113022-nnoltjy","Type":"NodeParagraph","Properties":{"id":"20231224113022-nnoltjy","updated":"20231226020454"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"width: 50%;","style":"width: 10000px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image.png"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c9154acd1ded47acbaaefe0a22fda57d~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1088\u0026h=866\u0026s=408372\u0026e=png\u0026b=f9f9f9"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 10000px;\" parent-style=\"width: 50%;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231226000947-txnhxgq","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20231226000947-txnhxgq","updated":"20231226000949"},"Children":[{"Type":"NodeText","Data":"原先设计"}]},{"ID":"20231224113022-uztuyxu","Type":"NodeParagraph","Properties":{"id":"20231224113022-uztuyxu","updated":"20231226000947"},"Children":[{"Type":"NodeText","Data":"创建一个实例变量来保存当前状态，并为每个状态定义值"}]},{"ID":"20231224113022-w8f7n0b","Type":"NodeParagraph","Properties":{"id":"20231224113022-w8f7n0b","updated":"20231226020500"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"width: 50%;","style":"width: 10000px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image.png"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eb2294a43aac4203ac3e850a54166b4e~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1120\u0026h=452\u0026s=183497\u0026e=png\u0026b=fffefe"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 10000px;\" parent-style=\"width: 50%;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231226001107-hmxb16t","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231226001107-hmxb16t","updated":"20231226001117"},"Children":[{"Type":"NodeText","Data":"代码逻辑"}]},{"ID":"20231226001606-bgom1bb","Type":"NodeList","ListData":{},"Properties":{"id":"20231226001606-bgom1bb","updated":"20231226001740"},"Children":[{"ID":"20231226001607-n67vcue","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226001607-n67vcue","updated":"20231226001740"},"Children":[{"ID":"20231226001607-7czs1hf","Type":"NodeParagraph","Properties":{"id":"20231226001607-7czs1hf","updated":"20231226001740"},"Children":[{"Type":"NodeText","Data":"四个状态"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"HAS_QUARTER、NO_QUARTER、SOLD、SOLD_OUT"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20231226001133-939z4pg","Type":"NodeList","ListData":{},"Properties":{"id":"20231226001133-939z4pg","updated":"20231226003955"},"Children":[{"ID":"20231226001134-47jrtlq","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226001134-47jrtlq","updated":"20231226001134"},"Children":[{"ID":"20231226001134-gpyburr","Type":"NodeParagraph","Properties":{"id":"20231226001134-gpyburr","updated":"20231226004251"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"insertQuarter"},{"Type":"NodeText","Data":"​事件"}]},{"ID":"20231226001156-o3i7bd8","Type":"NodeList","ListData":{},"Properties":{"id":"20231226001156-o3i7bd8","updated":"20231226001159"},"Children":[{"ID":"20231226001159-guhti7d","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226001159-guhti7d","updated":"20231226001159"},"Children":[{"ID":"20231226001159-gch9rw0","Type":"NodeParagraph","Properties":{"id":"20231226001159-gch9rw0","updated":"20231226002334"},"Children":[{"Type":"NodeText","Data":"当前状态是 HAS_QUARTER-\u003e不做操作，不能再投入了"}]}]},{"ID":"20231226001536-6yoafw2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226001536-6yoafw2"},"Children":[{"ID":"20231226001536-ovby8pm","Type":"NodeParagraph","Properties":{"id":"20231226001536-ovby8pm","updated":"20231226001559"},"Children":[{"Type":"NodeText","Data":"当前状态是 NO_QUARTER-\u003e状态变为HAS_QUARTER"}]}]},{"ID":"20231226001958-vbv1snh","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226001958-vbv1snh"},"Children":[{"ID":"20231226001958-yg95b3x","Type":"NodeParagraph","Properties":{"id":"20231226001958-yg95b3x","updated":"20231226002028"},"Children":[{"Type":"NodeText","Data":"当前是 SOLD_OUT-\u003e糖果售完，拒绝收钱"}]}]},{"ID":"20231226002037-0js4hdg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226002037-0js4hdg"},"Children":[{"ID":"20231226002037-vkexp8m","Type":"NodeParagraph","Properties":{"id":"20231226002037-vkexp8m","updated":"20231226003816"},"Children":[{"Type":"NodeText","Data":"当前是 SOLD-\u003e售出糖果了，让客户等一下，然后收钱，状态变为NO_QUARTER"}]}]}]}]},{"ID":"20231226002157-w7brfni","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226002157-w7brfni"},"Children":[{"ID":"20231226002157-ljfi2rn","Type":"NodeParagraph","Properties":{"id":"20231226002157-ljfi2rn","updated":"20231226004255"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ejectQuarter"},{"Type":"NodeText","Data":"​事件"}]},{"ID":"20231226002252-f2ue54b","Type":"NodeList","ListData":{},"Properties":{"id":"20231226002252-f2ue54b","updated":"20231226002302"},"Children":[{"ID":"20231226002302-z3nvkqp","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226002302-z3nvkqp","updated":"20231226002302"},"Children":[{"ID":"20231226002302-n8fxygc","Type":"NodeParagraph","Properties":{"id":"20231226002302-n8fxygc","updated":"20231226002313"},"Children":[{"Type":"NodeText","Data":"当前状态是 HAS_QUARTER-\u003e状态变为NO_QUARTER"}]}]}]},{"ID":"20231226002248-io4c1lb","Type":"NodeList","ListData":{},"Properties":{"id":"20231226002248-io4c1lb","updated":"20231226002248"},"Children":[{"ID":"20231226002248-m2rj0bp","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226002248-m2rj0bp","updated":"20231226002248"},"Children":[{"ID":"20231226002248-opx19ia","Type":"NodeParagraph","Properties":{"id":"20231226002248-opx19ia","updated":"20231226002347"},"Children":[{"Type":"NodeText","Data":"当前状态是 NO_QUARTER-\u003e不做操作"}]}]},{"ID":"20231226002248-clq4aeg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226002248-clq4aeg","updated":"20231226002248"},"Children":[{"ID":"20231226002248-dyf5zye","Type":"NodeParagraph","Properties":{"id":"20231226002248-dyf5zye","updated":"20231226003624"},"Children":[{"Type":"NodeText","Data":"当前是 SOLD_OUT-\u003e不做操作"}]}]},{"ID":"20231226002248-rm3xmvk","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226002248-rm3xmvk","updated":"20231226002248"},"Children":[{"ID":"20231226002248-v4asj8j","Type":"NodeParagraph","Properties":{"id":"20231226002248-v4asj8j","updated":"20231226003841"},"Children":[{"Type":"NodeText","Data":"当前是 SOLD-\u003e已售出糖果，不能退回，不做任何操作"}]}]}]}]},{"ID":"20231226003428-63qqkzf","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226003428-63qqkzf"},"Children":[{"ID":"20231226003428-x95pknr","Type":"NodeParagraph","Properties":{"id":"20231226003428-x95pknr","updated":"20231226003501"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"turnCrank"},{"Type":"NodeText","Data":"​​转动曲柄事件"}]},{"ID":"20231226003513-evtxund","Type":"NodeList","ListData":{},"Properties":{"id":"20231226003513-evtxund","updated":"20231226003513"},"Children":[{"ID":"20231226003513-d6ktl9k","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226003513-d6ktl9k","updated":"20231226003513"},"Children":[{"ID":"20231226003513-wh3pq29","Type":"NodeParagraph","Properties":{"id":"20231226003513-wh3pq29","updated":"20231226003749"},"Children":[{"Type":"NodeText","Data":"当前状态是 HAS_QUARTER-\u003e状态变为SOLD 并且执行 dispense()发放糖果"}]}]}]},{"ID":"20231226003513-j4xmgbz","Type":"NodeList","ListData":{},"Properties":{"id":"20231226003513-j4xmgbz","updated":"20231226003513"},"Children":[{"ID":"20231226003513-0irjt8n","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226003513-0irjt8n","updated":"20231226003513"},"Children":[{"ID":"20231226003513-nel0miw","Type":"NodeParagraph","Properties":{"id":"20231226003513-nel0miw","updated":"20231226003513"},"Children":[{"Type":"NodeText","Data":"当前状态是 NO_QUARTER-\u003e不做操作"}]}]},{"ID":"20231226003513-5qkuzle","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226003513-5qkuzle","updated":"20231226003513"},"Children":[{"ID":"20231226003513-uztwyuo","Type":"NodeParagraph","Properties":{"id":"20231226003513-uztwyuo","updated":"20231226003703"},"Children":[{"Type":"NodeText","Data":"当前是 SOLD_OUT-\u003e不做操作"}]}]},{"ID":"20231226003513-cs655yk","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226003513-cs655yk","updated":"20231226003513"},"Children":[{"ID":"20231226003513-sn0x2pt","Type":"NodeParagraph","Properties":{"id":"20231226003513-sn0x2pt","updated":"20231226003924"},"Children":[{"Type":"NodeText","Data":"当前是 SOLD-\u003e不做操作"}]}]}]}]},{"ID":"20231226003925-3svcr3z","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226003925-3svcr3z","updated":"20231226003955"},"Children":[{"ID":"20231226003925-bqc50es","Type":"NodeParagraph","Properties":{"id":"20231226003925-bqc50es","updated":"20231226003936"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"dispense"},{"Type":"NodeText","Data":"​​分发糖果"}]},{"ID":"20231226003955-29o3ynt","Type":"NodeList","ListData":{},"Properties":{"id":"20231226003955-29o3ynt"},"Children":[{"ID":"20231226003955-fa9qhla","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226003955-fa9qhla"},"Children":[{"ID":"20231226003955-oon2k5o","Type":"NodeParagraph","Properties":{"id":"20231226003955-oon2k5o","updated":"20231226004150"},"Children":[{"Type":"NodeText","Data":"当前状态是 HAS_QUARTER-\u003e不应该发生这种状况，错误提示"}]}]},{"ID":"20231226004006-96kp8q6","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226004006-96kp8q6"},"Children":[{"ID":"20231226004006-d4nd2bq","Type":"NodeParagraph","Properties":{"id":"20231226004006-d4nd2bq","updated":"20231226004147"},"Children":[{"Type":"NodeText","Data":"当前状态是 NO_QUARTER-\u003e不应该发生这种状况，错误提示"}]}]},{"ID":"20231226004012-wgwsdwx","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226004012-wgwsdwx"},"Children":[{"ID":"20231226004012-wzc66oa","Type":"NodeParagraph","Properties":{"id":"20231226004012-wzc66oa","updated":"20231226004152"},"Children":[{"Type":"NodeText","Data":"当前是 SOLD_OUT-\u003e不应该发生这种状况，错误提示"}]}]},{"ID":"20231226004032-8f614l4","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226004032-8f614l4"},"Children":[{"ID":"20231226004032-eseuknw","Type":"NodeParagraph","Properties":{"id":"20231226004032-eseuknw","updated":"20231226004159"},"Children":[{"Type":"NodeText","Data":"当前是 SOLD-\u003e糖果数量-1"}]},{"ID":"20231226004201-o0fe133","Type":"NodeList","ListData":{},"Properties":{"id":"20231226004201-o0fe133"},"Children":[{"ID":"20231226004200-mvwdd7v","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226004200-mvwdd7v"},"Children":[{"ID":"20231226004200-t7jd8lj","Type":"NodeParagraph","Properties":{"id":"20231226004200-t7jd8lj","updated":"20231226004238"},"Children":[{"Type":"NodeText","Data":"count == 0 ? state = SOLD_OUT : NO_QUARTER"}]}]}]}]}]}]}]},{"ID":"20231226004344-257yuk4","Type":"NodeParagraph","Properties":{"id":"20231226004344-257yuk4"}},{"ID":"20231226004347-qhelzva","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231226004347-qhelzva","updated":"20231226004354"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"dGV4dA=="},{"Type":"NodeCodeBlockCode","Data":"通过在对象内部创建一个实例变量来存储状态值，并在方法中编写条件代码来处理各种状态。\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231226004340-xm79442","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231226004340-xm79442","updated":"20231226004401"},"Children":[{"Type":"NodeText","Data":"问题"}]},{"ID":"20231224113022-qyejwbf","Type":"NodeParagraph","Properties":{"id":"20231224113022-qyejwbf","updated":"20231226004455"},"Children":[{"Type":"NodeText","Data":"现在糖果公司要求：当曲柄被转动时，有10%的几率掉下来的是两个糖果。（氪金扭蛋），新加入一个 winner状态。"}]},{"ID":"20231226004548-ptiffqh","Type":"NodeParagraph","Properties":{"id":"20231226004548-ptiffqh","updated":"20231226004548"}},{"ID":"20231224113022-jciuxxe","Type":"NodeParagraph","Properties":{"id":"20231224113022-jciuxxe","updated":"20231226020505"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"width: 50%;","style":"width: 10000px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image.png"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/02969ae6897b49d4b71c607db9cd5c34~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=680\u0026h=688\u0026s=207534\u0026e=png\u0026b=f5f5f5"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 10000px;\" parent-style=\"width: 50%;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231226004557-r974471","Type":"NodeParagraph","Properties":{"id":"20231226004557-r974471","updated":"20231226004557"},"Children":[{"Type":"NodeText","Data":"再回看一下我们的初步代码，想要实现新的需求将会变得非常麻烦："}]},{"ID":"20231226004557-373f7oa","Type":"NodeList","ListData":{},"Properties":{"id":"20231226004557-373f7oa","updated":"20231226004557"},"Children":[{"ID":"20231226004557-n5d7cyg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226004557-n5d7cyg","updated":"20231226004557"},"Children":[{"ID":"20231226004557-ags1c3w","Type":"NodeParagraph","Properties":{"id":"20231226004557-ags1c3w","updated":"20231226004557"},"Children":[{"Type":"NodeText","Data":"必须新增一个中奖的“赢家”状态。"}]}]},{"ID":"20231226004557-ajeh186","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226004557-ajeh186","updated":"20231226004557"},"Children":[{"ID":"20231226004557-yanin1u","Type":"NodeParagraph","Properties":{"id":"20231226004557-yanin1u","updated":"20231226004557"},"Children":[{"Type":"NodeText","Data":"必须在每一个方法添加新的判断条件来处理“赢家”状态。"}]}]},{"ID":"20231226004557-not78f8","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226004557-not78f8","updated":"20231226004557"},"Children":[{"ID":"20231226004557-p796vqg","Type":"NodeParagraph","Properties":{"id":"20231226004557-p796vqg","updated":"20231226004557"},"Children":[{"Type":"NodeText","Data":"转动把手的方法中还需要检查目前状态是否是“赢家”再决定切换到“赢家”状态行为还是正常出售行为。"}]}]}]},{"ID":"20231224113022-nmao9at","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20231224113022-nmao9at","updated":"20231226004758"},"Children":[{"Type":"NodeText","Data":"优化方案：状态模式"}]},{"ID":"20231226004759-ytly7uj","Type":"NodeParagraph","Properties":{"id":"20231226004759-ytly7uj","updated":"20231226004924"},"Children":[{"Type":"NodeText","Data":"会想我们策略模式的设计思想，将变化的部分抽离出来，在这里我们将状态抽离出来。"}]},{"ID":"20231226004933-it6zjtt","Type":"NodeParagraph","Properties":{"id":"20231226004933-it6zjtt","updated":"20231226004938"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"width: 50%;","style":"width: 10000px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20231226004933-7zzc0kk.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 10000px;\" parent-style=\"width: 50%;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231224113022-c3c014c","Type":"NodeList","ListData":{},"Properties":{"id":"20231224113022-c3c014c","updated":"20231226012552"},"Children":[{"ID":"20231226005710-7yxbtg8","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226005710-7yxbtg8","updated":"20231226012552"},"Children":[{"ID":"20231226005710-ppyszbk","Type":"NodeParagraph","Properties":{"id":"20231226005710-ppyszbk","updated":"20231226012552"},"Children":[{"Type":"NodeText","Data":"首先定义抽象状态(State），将原先的"},{"Type":"NodeTextMark","TextMarkType":"mark","TextMarkTextContent":"事件（行为）"},{"Type":"NodeText","Data":"委托到状态（接口）中（策略模式也是这样）；"}]}]}]},{"ID":"20231226005517-eosdwc2","Type":"NodeList","ListData":{},"Properties":{"id":"20231226005517-eosdwc2","updated":"20231226005712"},"Children":[{"ID":"20231226005712-dchddx6","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226005712-dchddx6","updated":"20231226005712"},"Children":[{"ID":"20231226005712-856bz35","Type":"NodeParagraph","Properties":{"id":"20231226005712-856bz35","updated":"20231226005712"},"Children":[{"Type":"NodeText","Data":"具体状态，实现具体的逻辑；"}]}]}]},{"ID":"20231226005544-bkbl7vw","Type":"NodeList","ListData":{},"Properties":{"id":"20231226005544-bkbl7vw","updated":"20231226014556"},"Children":[{"ID":"20231226005713-xq7qumn","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226005713-xq7qumn","updated":"20231226014556"},"Children":[{"ID":"20231226005713-r25jy5d","Type":"NodeParagraph","Properties":{"id":"20231226005713-r25jy5d","updated":"20231226014556"},"Children":[{"Type":"NodeText","Data":"上下文：和策略模式类似，有状态的实例，并且有可以实现状态变化的方法。这里与策略模式不同的是上下文中有一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"request()"},{"Type":"NodeText","Data":"​,不管什么时候只要有人调用上下文中的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"request()"},{"Type":"NodeText","Data":"​，都会被委托到 State处理。，（在本例子PPT代码中为insertQuarter等 3个方法，在下面 给出的的示例代码中为 handle 函数）见下图："}]}]}]},{"ID":"20231224113022-pty6d82","Type":"NodeParagraph","Properties":{"id":"20231224113022-pty6d82","updated":"20231226013439"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"width: 50%;","style":"width: 10000px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20231226013435-ge5ku64.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 10000px;\" parent-style=\"width: 50%;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231226014558-1jycupr","Type":"NodeParagraph","Properties":{"id":"20231226014558-1jycupr","updated":"20231226014558"}},{"ID":"20231226014558-cn18god","Type":"NodeParagraph","Properties":{"id":"20231226014558-cn18god","updated":"20231226014608"},"Children":[{"Type":"NodeText","Data":"（也可以认为是策略模式例子上下文代码中的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"performFly()、performQuack()"},{"Type":"NodeText","Data":"​这样就当我没说，但我觉得策略模式中的这两个函数可以写到具体"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ConcreteStrategy"},{"Type":"NodeText","Data":"​类中，那这样想 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"request"},{"Type":"NodeText","Data":"​也可以写在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ConcreteState"},{"Type":"NodeText","Data":"​类中，那为啥状态模式定义图中上下文中会有个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"request()"},{"Type":"NodeText","Data":"​呢😠🤨）"}]},{"ID":"20231226013455-irxh2tl","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231226013455-irxh2tl","updated":"20231226013506"},"Children":[{"Type":"NodeText","Data":"代码"}]},{"ID":"20231226015236-bjeuic3","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231226015236-bjeuic3","updated":"20231226015713"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"//状态模式，糖果机问题，其代码太长，我们包装一下，大体代码逻辑不变，缩短代码量\n//状态接口，封装行为\n\ninterface State {\n    void handle(Context context);\n}\nclass ConcreteStateA implements State {\n    @Override\n    public void handle(Context context) {\n        System.out.println(\"当前位于 ConcreteStateA\");\n        context.setState(new ConcreteStateB());//对应与糖果机中执行事件后状态转换，并且我们知道状态转换需要借助上下文完成\n    }\n}\nclass ConcreteStateB implements State {\n    @Override\n    public void handle(Context context) {\n        System.out.println(\"当前位于 ConcreteStateB\");\n        context.setState(new ConcreteStateA());\n    }\n}\n//上下文，有着状态接口的实例以及状态转换的方法\nclass Context {\n    State state; //实例\n    public Context(){\n        state = new ConcreteStateA();//在糖果机里这里具体实现应该分别为四个状态初始化\n    }\n    //具体的set get操作\n    public void setState(State state) {\n        this.state = state;\n    }\n    public State getState(){\n        return this.state;\n    }\n    public void request(){\n        state.handle(this);\n    }\n}\n//客户端\npublic class StatePatternTest {\n    public static void main(String[] args) {\n        Context context = new Context();\n        context.request();\n        context.request();\n        context.request();\n        context.request();\n    }\n}\n//我们从客户端可以明显看出来客户端根本不了状态对象，但是在策略模式中客户端基本都是指定 Context所组合的策略对象是哪一个（策略模式中主动更改飞行以及鸣叫）\n//感觉状态模式是一种状态的自然更迭（规定条件下），策略模式是一种搭配选择（重点在 choose）\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231226015255-o8kveba","Type":"NodeParagraph","Properties":{"id":"20231226015255-o8kveba","updated":"20231226015255"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20231226015255-vv41n37.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231226015729-v6evzed","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231226015729-v6evzed","updated":"20231226015736"},"Children":[{"Type":"NodeText","Data":"对应 UML 类图"}]},{"ID":"20231226020137-6p45cas","Type":"NodeParagraph","Properties":{"id":"20231226020137-6p45cas","updated":"20231226020515"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"width: 50%;","style":"width: 10000px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image.png"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fdf9783350ea4ceb9d97832e13f2d5b4~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1502\u0026h=942\u0026s=270670\u0026e=png\u0026b=fefefe"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 10000px;\" parent-style=\"width: 50%;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231224113022-47nmn1k","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20231224113022-47nmn1k","updated":"20231226020027"},"Children":[{"Type":"NodeText","Data":"总结​​"}]},{"ID":"20231224113022-xxq64vv","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231224113022-xxq64vv","updated":"20231224113022"},"Children":[{"Type":"NodeText","Data":"与策略模式关系"}]},{"ID":"20231224113022-z8aetnx","Type":"NodeList","ListData":{},"Properties":{"id":"20231224113022-z8aetnx","updated":"20231226020347"},"Children":[{"ID":"20231224113022-fgbsmbd","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231224113022-fgbsmbd","updated":"20231224113022"},"Children":[{"ID":"20231224113022-qmzyc1v","Type":"NodeParagraph","Properties":{"id":"20231224113022-qmzyc1v","updated":"20231224113022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"相似性："},{"Type":"NodeText","Data":" 两者都涉及到将特定的行为封装起来，使得行为可以相互替换。"}]}]},{"ID":"20231224113022-wyvmgzw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231224113022-wyvmgzw","updated":"20231226020347"},"Children":[{"ID":"20231224113022-dunt5m6","Type":"NodeParagraph","Properties":{"id":"20231224113022-dunt5m6","updated":"20231226020334"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"差异性："},{"Type":"NodeText","Data":"（主要出发点还是刚才说的“意图”）"}]},{"ID":"20231224113022-vwx7vql","Type":"NodeList","ListData":{},"Properties":{"id":"20231224113022-vwx7vql","updated":"20231226020347"},"Children":[{"ID":"20231224113022-aeari12","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231224113022-aeari12","updated":"20231224113022"},"Children":[{"ID":"20231224113022-hr3nh14","Type":"NodeParagraph","Properties":{"id":"20231224113022-hr3nh14","updated":"20231226020221"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用方式不同："},{"Type":"NodeText","Data":" 在策略模式中，客户端通常选择具体的策略对象，而在状态模式中，上下文的状态是在内部管理的，客户端对状态对象了解较少。\n"}]}]},{"ID":"20231224113022-9ahku0q","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231224113022-9ahku0q","updated":"20231224113022"},"Children":[{"ID":"20231224113022-ez3mrkr","Type":"NodeParagraph","Properties":{"id":"20231224113022-ez3mrkr","updated":"20231224113022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"动态性："},{"Type":"NodeText","Data":" 策略模式允许在运行时动态更改策略对象，而状态模式是通过内部状态的变化来改变行为。​​"}]}]},{"ID":"20231226020347-i8608uf","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226020347-i8608uf","updated":"20231226020347"},"Children":[{"ID":"20231226020347-u8igkpg","Type":"NodeParagraph","Properties":{"id":"20231226020347-u8igkpg"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"选择标准："},{"Type":"NodeText","Data":" 策略模式适用于在不同情况下选择算法，而状态模式适用于对象在内部状态变化时改变行为。"}]}]}]}]}]},{"ID":"20231226020425-41dmooq","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231226020425-41dmooq","updated":"20231226020432"},"Children":[{"Type":"NodeText","Data":"模式区分"}]},{"ID":"20231226020433-i66ucdj","Type":"NodeList","ListData":{},"Properties":{"id":"20231226020433-i66ucdj","updated":"20231226020438"},"Children":[{"ID":"20231226020438-5rwgfee","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226020438-5rwgfee","updated":"20231226020438"},"Children":[{"ID":"20231226020438-x7x7kak","Type":"NodeParagraph","Properties":{"id":"20231226020438-x7x7kak","updated":"20231226020438"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"状态模式"},{"Type":"NodeText","Data":"：封装基于状态的行为，并将行为委托到当前状态"}]}]}]},{"ID":"20231226020433-tlbf52t","Type":"NodeList","ListData":{},"Properties":{"id":"20231226020433-tlbf52t","updated":"20231226020439"},"Children":[{"ID":"20231226020439-ne7ag10","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226020439-ne7ag10","updated":"20231226020439"},"Children":[{"ID":"20231226020439-wfpusnd","Type":"NodeParagraph","Properties":{"id":"20231226020439-wfpusnd","updated":"20231226020439"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"策略模式"},{"Type":"NodeText","Data":"：将可以互换的行为封装起来。然后使用委托的方法，觉得使用哪一个行为"}]}]}]},{"ID":"20231226020433-pvs1ygr","Type":"NodeList","ListData":{},"Properties":{"id":"20231226020433-pvs1ygr","updated":"20231226020440"},"Children":[{"ID":"20231226020440-u53fjvy","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231226020440-u53fjvy","updated":"20231226020440"},"Children":[{"ID":"20231226020440-rwtic8i","Type":"NodeParagraph","Properties":{"id":"20231226020440-rwtic8i","updated":"20231226020440"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"模板方法模式"},{"Type":"NodeText","Data":"：由子类决定如何实现算法中的某些步骤"}]}]}]}]}